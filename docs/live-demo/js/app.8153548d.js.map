{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/shader.js","webpack:///./src/App.vue?4124","webpack:///./src/components/controls.vue?bfc8","webpack:///./src/bus.js","webpack:///src/components/controls.vue","webpack:///./src/components/controls.vue?c575","webpack:///./src/components/controls.vue?1824","webpack:///./src/components/glviewer.vue?19e2","webpack:///src/components/glviewer.vue","webpack:///./src/components/glviewer.vue?6836","webpack:///./src/components/glviewer.vue?6c54","webpack:///src/App.vue","webpack:///./src/App.vue?1160","webpack:///./src/App.vue","webpack:///./src/plugins/vuetify.js","webpack:///./src/main.js","webpack:///./src/shader-srcs.js","webpack:///./src/niivue.js","webpack:///./src/components/controls.vue?aed2","webpack:///./src/components/glviewer.vue?31e9"],"names":["webpackJsonpCallback","data","moduleId","chunkId","chunkIds","moreModules","executeModules","i","resolves","length","Object","prototype","hasOwnProperty","call","installedChunks","push","modules","parentJsonpFunction","shift","deferredModules","apply","checkDeferredModules","result","deferredModule","fulfilled","j","depId","splice","__webpack_require__","s","installedModules","exports","module","l","m","c","d","name","getter","o","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","p","jsonpArray","window","oldJsonpFunction","slice","Shader","gl","vertexSrc","fragmentSrc","self","this","program","compileShader","regexUniform","matchUniformName","uniforms","vertexUnifs","match","fragUnifs","unif","forEach","getUniformLocation","use","useProgram","vert","frag","vs","createShader","VERTEX_SHADER","shaderSource","getShaderParameter","COMPILE_STATUS","alert","console","log","getShaderInfoLog","fs","FRAGMENT_SHADER","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","_vm","_h","$createElement","_c","_self","attrs","_v","staticStyle","urlOverlayList","staticClass","on","$event","setSliceType","viewShown2D","viewShown3D","onSliceSlider2D","model","callback","$$v","sliceScrollVal","expression","_e","onClipPlaneChange","clipValAz","clipValEl","clipValDepth","onResetClipPlane","_s","coordinateString","staticRenderFns","onAddOverlay","overlays","_l","overlay","stopPropagation","toggleVisibility","visibilityIcon","overlays_","visible","colorMaps","onColorChange","$set","intensityMax","intensityMin","scopedSlots","_u","fn","intensityRange","proxy","onOpacityChange","opacity","bus","Vue","props","Array","components","draggable","eyeIcon","overlayVisibilityState","methods","index","vis","$emit","val","component","VBtn","VCol","VExpansionPanel","VExpansionPanelContent","VExpansionPanelHeader","VExpansionPanels","VIcon","VRangeSlider","VRow","VSelect","VSlider","VSpacer","VTextField","dialog","onCrosshairColorChange","crosshairColor","discoMode","shader","String","created","niivue","selectedOverlay","last2DSliceVal","mouseDown","touchDown","zDown","discoModeColorMapTimer","discoModeCrosshairTimer","scale","selectedColorMap","watch","deep","handler","setNewPos","newMM","onWindowResize","bottomStatusBarHeight","canvas","document","querySelector","viewer","width","height","clientHeight","getBoundingClientRect","bottom","documentElement","style","drawScene","floatColor","setCrosshairColor","mounted","glEl","classList","add","id","clientWidth","appendChild","gc","set","addEventListener","e","preventDefault","rect","deltaY","clearInterval","loadVolumes","$on","sliceType","slicePosVal","sliceScroll2D","newPlanes","clipPlaneUpdate","updateGLVolume","VCard","VColorPicker","VDialog","controls","glviewer","tab","appTabs","overlayList","computed","undefined","$route","query","urls","vols","VApp","VAppBar","VFooter","VMain","VToolbar","Vuetify","icons","iconfont","Router","config","productionTip","router","routes","vuetify","render","h","App","$mount","vertRenderShader","fragRenderShader","vertSliceShader","fragSliceShader","fragLineShader","vertColorbarShader","fragColorbarShader","vertLineShader","vertFontShader","fragFontShader","vertOrientShader","fragOrientShaderU","fragOrientShaderI","fragOrientShaderF","fragOrientShader","fragPassThroughShader","Niivue","opts","prop","defaults","textHeight","colorbarHeight","crosshairWidth","backColor","colorBarMargin","colormapTexture","volumeTexture","overlayTexture","sliceShader","lineShader","renderShader","colorbarShader","fontShader","passThroughShader","orientShaderU","orientShaderI","orientShaderF","fontMets","sliceTypeAxial","sliceTypeCoronal","sliceTypeSagittal","sliceTypeMultiplanar","sliceTypeRender","scene","renderAzimuth","renderElevation","crosshairPos","clipPlane","back","volumes","backTexture","isRadiologicalConvention","volScaleMultiplier","mousePos","numScreenSlices","screenSlices","leftTopWidthHeight","axCorSag","backOpacity","intensityRaw2Scaled","hdr","raw","scl_slope","scl_inter","arrayEquals","a","b","isArray","every","x","y","mouseMove","sph2cartDeg","azimuth","elevation","Phi","Math","PI","Theta","ret","cos","sin","len","sqrt","azimuthElevationDepth","v","color","posChange","isDelta","mouseClick","st","setOpacity","volIdx","newOpacity","setScale","attachTo","getContext","init","overlayRGBA","volume","vox","dims","imgRGBA","Uint8ClampedArray","radius","min","halfX","halfY","halfZ","z","dx","abs","dy","dz","dist","vox2mm","XYZ","mtx","sform","mat","clone","transpose","pos","fromValues","transformMat4","pos3","nii2RAS","overlayItem","affine","absR","ixyz","perm","rotM","mm000","mm100","mm010","mm001","R","copy","flip","dimsRAS","pixDimsRAS","pixDims","toRAS","matRAS","identity","residualR","invert","multiply","volumeList","xhr","img","url","XMLHttpRequest","open","responseType","onerror","error","onload","dataBuffer","response","nii","selectColormap","colorMap","send","rgbaTex","texID","activeID","isInit","deleteTexture","createTexture","activeTexture","bindTexture","TEXTURE_3D","texParameteri","TEXTURE_MIN_FILTER","LINEAR","TEXTURE_MAG_FILTER","TEXTURE_WRAP_R","CLAMP_TO_EDGE","TEXTURE_WRAP_S","TEXTURE_WRAP_T","pixelStorei","UNPACK_ALIGNMENT","texStorage3D","RGBA8","img8","Uint8Array","texSubImage3D","RGBA","UNSIGNED_BYTE","loadPng","pngName","pngImage","Image","pngTexture","TEXTURE3","TEXTURE_2D","texImage2D","src","initText","fetchMetrics","fetch","json","metrics","xadv","uv_lbwh","lbwh","distanceRange","atlas","size","scaleW","scaleH","glyphs","glyph","unicode","advance","planeBounds","atlasBounds","left","top","w","right","debugInfo","getExtension","vendor","getParameter","UNMASKED_VENDOR_WEBGL","renderer","UNMASKED_RENDERER_WEBGL","enable","CULL_FACE","cullFace","FRONT","BLEND","blendFunc","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","TEXTURE0","TEXTURE2","cubeStrip","vao","createVertexArray","bindVertexArray","vbo","createBuffer","bindBuffer","ARRAY_BUFFER","bufferData","Float32Array","STATIC_DRAW","enableVertexAttribArray","vertexAttribPointer","FLOAT","uniform1i","concat","visibleLayers","refreshLayers","calMinMaxCore","imgRaw","percentileFrac","ignoreZeroVoxels","datatypeCode","Int16Array","Float64Array","Uint16Array","mn","mx","nZero","nNan","nVox","isNaN","max","mnScale","mxScale","n2pct","round","nBins","scl","hist","lo","hi","ok","pct2","pct98","cal_min","cal_max","calMinMax","minMax","global_min","global_max","layer","outTexture","f000","mm2frac","f100","f010","f001","subtract","fb","createFramebuffer","bindFramebuffer","FRAMEBUFFER","disable","viewport","tempTex3D","TEXTURE6","NEAREST","orientShader","R8UI","RED_INTEGER","R16I","SHORT","R32F","RED","img32f","from","R16UI","UNSIGNED_SHORT","tempTex2D","TEXTURE7","texStorage2D","passShader","uniform1f","uniformMatrix4fv","coordZ","framebufferTexture2D","COLOR_ATTACHMENT0","drawArrays","TRIANGLE_STRIP","framebufferTextureLayer","clear","DEPTH_BUFFER_BIT","deleteFramebuffer","lutName","lut","makeLut","TEXTURE1","texSubImage2D","Rs","Gs","Bs","As","Is","idxLo","idxHi","idxRng","k","f","sliceScale","longestAxis","volScale","posNow","posFuture","ltwh","isMirror","fracX","fracY","drawColorbar","uniform4fv","uniform2fv","uniform4f","textWidth","str","bytes","Buffer","drawChar","xy","char","drawText","uniform2f","screenPxRange","drawTextRight","drawTextBelow","draw2D","crossXYZ","isMirrorLR","xleft","xtop","draw3D","xCenter","yCenter","xPix","yPix","clearColor","fDistance","translate","rad","rotate","inv","rayDir4","rayDir","normalize","tiny","uniform3fv","posString","toFixed","mm","mm4","frac","vox2frac","frac2vox","frac2mm","dim","mul","shim","scaleSlice","scalePix","wPix","hPix","COLOR_BUFFER_BIT","wX","ltwh3x1","wX1","pixScale","hY1","hZ1","wY","hY","hZ","margin","finish"],"mappings":"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","file":"js/app.8153548d.js","sourcesContent":[" \t// install a JSONP callback for chunk loading\n \tfunction webpackJsonpCallback(data) {\n \t\tvar chunkIds = data[0];\n \t\tvar moreModules = data[1];\n \t\tvar executeModules = data[2];\n\n \t\t// add \"moreModules\" to the modules object,\n \t\t// then flag all \"chunkIds\" as loaded and fire callback\n \t\tvar moduleId, chunkId, i = 0, resolves = [];\n \t\tfor(;i < chunkIds.length; i++) {\n \t\t\tchunkId = chunkIds[i];\n \t\t\tif(Object.prototype.hasOwnProperty.call(installedChunks, chunkId) && installedChunks[chunkId]) {\n \t\t\t\tresolves.push(installedChunks[chunkId][0]);\n \t\t\t}\n \t\t\tinstalledChunks[chunkId] = 0;\n \t\t}\n \t\tfor(moduleId in moreModules) {\n \t\t\tif(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {\n \t\t\t\tmodules[moduleId] = moreModules[moduleId];\n \t\t\t}\n \t\t}\n \t\tif(parentJsonpFunction) parentJsonpFunction(data);\n\n \t\twhile(resolves.length) {\n \t\t\tresolves.shift()();\n \t\t}\n\n \t\t// add entry modules from loaded chunk to deferred list\n \t\tdeferredModules.push.apply(deferredModules, executeModules || []);\n\n \t\t// run deferred modules when all chunks ready\n \t\treturn checkDeferredModules();\n \t};\n \tfunction checkDeferredModules() {\n \t\tvar result;\n \t\tfor(var i = 0; i < deferredModules.length; i++) {\n \t\t\tvar deferredModule = deferredModules[i];\n \t\t\tvar fulfilled = true;\n \t\t\tfor(var j = 1; j < deferredModule.length; j++) {\n \t\t\t\tvar depId = deferredModule[j];\n \t\t\t\tif(installedChunks[depId] !== 0) fulfilled = false;\n \t\t\t}\n \t\t\tif(fulfilled) {\n \t\t\t\tdeferredModules.splice(i--, 1);\n \t\t\t\tresult = __webpack_require__(__webpack_require__.s = deferredModule[0]);\n \t\t\t}\n \t\t}\n\n \t\treturn result;\n \t}\n\n \t// The module cache\n \tvar installedModules = {};\n\n \t// object to store loaded and loading chunks\n \t// undefined = chunk not loaded, null = chunk preloaded/prefetched\n \t// Promise = chunk loading, 0 = chunk loaded\n \tvar installedChunks = {\n \t\t\"app\": 0\n \t};\n\n \tvar deferredModules = [];\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \tvar jsonpArray = window[\"webpackJsonp\"] = window[\"webpackJsonp\"] || [];\n \tvar oldJsonpFunction = jsonpArray.push.bind(jsonpArray);\n \tjsonpArray.push = webpackJsonpCallback;\n \tjsonpArray = jsonpArray.slice();\n \tfor(var i = 0; i < jsonpArray.length; i++) webpackJsonpCallback(jsonpArray[i]);\n \tvar parentJsonpFunction = oldJsonpFunction;\n\n\n \t// add entry module to deferred list\n \tdeferredModules.push([0,\"chunk-vendors\"]);\n \t// run deferred modules when ready\n \treturn checkDeferredModules();\n","// shader.js is taken from github user Twinklebear: https://github.com/Twinklebear/webgl-util\nexport var Shader = function(gl, vertexSrc, fragmentSrc) {\n    var self = this;\n    this.program = compileShader(gl, vertexSrc, fragmentSrc);\n\n    var regexUniform = /uniform[^;]+[ ](\\w+);/g\n    var matchUniformName = /uniform[^;]+[ ](\\w+);/\n\n    this.uniforms = {};\n\n    var vertexUnifs = vertexSrc.match(regexUniform);\n    var fragUnifs = fragmentSrc.match(regexUniform);\n\n    if (vertexUnifs) {\n        vertexUnifs.forEach(function(unif) {\n            var m = unif.match(matchUniformName);\n            self.uniforms[m[1]] = -1;\n        });\n    }\n    if (fragUnifs) {\n        fragUnifs.forEach(function(unif) {\n            var m = unif.match(matchUniformName);\n            self.uniforms[m[1]] = -1;\n        });\n    }\n\n    for (var unif in this.uniforms) {\n        this.uniforms[unif] = gl.getUniformLocation(this.program, unif);\n    }\n}\n\nShader.prototype.use = function(gl) {\n    gl.useProgram(this.program);\n}\n\n// Compile and link the shaders vert and frag. vert and frag should contain\n// the shader source code for the vertex and fragment shaders respectively\n// Returns the compiled and linked program, or null if compilation or linking failed\nexport var compileShader = function(gl, vert, frag){\n    var vs = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(vs, vert);\n    gl.compileShader(vs);\n    if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS)){\n        alert(\"Vertex shader failed to compile, see console for log\");\n        console.log(gl.getShaderInfoLog(vs));\n        return null;\n    }\n\n    var fs = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fs, frag);\n    gl.compileShader(fs);\n    if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS)){\n        alert(\"Fragment shader failed to compile, see console for log\");\n        console.log(gl.getShaderInfoLog(fs));\n        return null;\n    }\n\n    var program = gl.createProgram();\n    gl.attachShader(program, vs);\n    gl.attachShader(program, fs);\n    gl.linkProgram(program);\n    if (!gl.getProgramParameter(program, gl.LINK_STATUS)){\n        alert(\"Shader failed to link, see console for log\");\n        console.log(gl.getProgramInfoLog(program));\n        return null;\n    }\n    return program;\n}\n\nexport var getGLExtension = function(gl, ext) {\n    if (!gl.getExtension(ext)) {\n        alert(\"Missing \" + ext + \" WebGL extension\");\n        return false;\n    }\n    return true;\n}\n\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('v-app',[_c('v-app-bar',{attrs:{\"app\":\"\"}},[_c('h2',[_vm._v(\"Niivue\")]),_c('v-spacer')],1),_c('v-main',[_c('v-row',{staticStyle:{\"height\":\"100%\"}},[_c('v-col',{attrs:{\"sm\":\"12\",\"md\":\"12\",\"lg\":\"4\"}},[_c('controls',{attrs:{\"overlays\":_vm.urlOverlayList}})],1),_c('v-col',{attrs:{\"sm\":\"12\",\"md\":\"12\",\"lg\":\"8\"}},[_c('v-toolbar',{staticClass:\"pa-0 ma-0\",attrs:{\"elevation\":\"0\"}},[_c('v-btn',{on:{\"click\":function($event){return _vm.setSliceType(0)}}},[_vm._v(\"A\")]),_c('v-btn',{on:{\"click\":function($event){return _vm.setSliceType(2)}}},[_vm._v(\"S\")]),_c('v-btn',{on:{\"click\":function($event){return _vm.setSliceType(1)}}},[_vm._v(\"C\")]),_c('v-btn',{on:{\"click\":function($event){return _vm.setSliceType(4)}}},[_vm._v(\"R\")]),_c('v-btn',{on:{\"click\":function($event){return _vm.setSliceType(3)}}},[_vm._v(\"MP\")]),_c('v-spacer')],1),(_vm.viewShown2D == true || _vm.viewShown3D == true)?_c('v-expansion-panels',[_c('v-expansion-panel',[_c('v-expansion-panel-header',[_c('v-row',{staticClass:\"align-center\",attrs:{\"no-gutters\":\"\"}},[_vm._v(\" Controls \"),_c('v-icon',{staticClass:\"mx-2\"},[_vm._v(\" mdi-arrow-expand-vertical \")])],1)],1),_c('v-expansion-panel-content',[(_vm.viewShown2D == true)?_c('v-row',[_c('v-slider',{attrs:{\"step\":\"0.01\",\"max\":\"1\",\"min\":\"0\",\"thumb-label\":\"\",\"label\":\"slice\"},on:{\"input\":_vm.onSliceSlider2D},model:{value:(_vm.sliceScrollVal),callback:function ($$v) {_vm.sliceScrollVal=$$v},expression:\"sliceScrollVal\"}})],1):_vm._e(),(_vm.viewShown3D == true)?_c('v-row',[_c('v-slider',{attrs:{\"step\":\"1\",\"max\":\"360\",\"min\":\"0\",\"thumb-label\":\"\",\"label\":\"clip Azimu\"},on:{\"input\":_vm.onClipPlaneChange},model:{value:(_vm.clipValAz),callback:function ($$v) {_vm.clipValAz=$$v},expression:\"clipValAz\"}})],1):_vm._e(),(_vm.viewShown3D == true)?_c('v-row',[_c('v-slider',{attrs:{\"step\":\"1\",\"max\":\"90\",\"min\":\"-90\",\"thumb-label\":\"\",\"label\":\"clip Eleva\"},on:{\"input\":_vm.onClipPlaneChange},model:{value:(_vm.clipValEl),callback:function ($$v) {_vm.clipValEl=$$v},expression:\"clipValEl\"}})],1):_vm._e(),(_vm.viewShown3D == true)?_c('v-row',[_c('v-slider',{attrs:{\"step\":\"0.005\",\"max\":\"0.5\",\"min\":\"0\",\"thumb-label\":\"\",\"label\":\"clip Depth\"},on:{\"input\":_vm.onClipPlaneChange},model:{value:(_vm.clipValDepth),callback:function ($$v) {_vm.clipValDepth=$$v},expression:\"clipValDepth\"}})],1):_vm._e(),_c('v-row',[(_vm.viewShown3D)?_c('v-btn',{staticClass:\"mx-auto\",on:{\"click\":_vm.onResetClipPlane}},[_vm._v(\"reset\")]):_vm._e()],1)],1)],1)],1):_vm._e(),_c('glviewer',{attrs:{\"overlays\":_vm.urlOverlayList}})],1)],1)],1),_c('v-footer',{attrs:{\"app\":\"\"}},[_c('v-row',[_c('v-col',{attrs:{\"align\":\"center\",\"justify\":\"center\"}},[_c('span',{staticClass:\"text-caption\"},[_vm._v(_vm._s(_vm.coordinateString))])])],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"mt-5\",attrs:{\"id\":\"controls\"}},[_c('v-row',{staticClass:\"my-2 mx-2 align-center\"},[_c('h3',[_vm._v(\"Layers\")]),_c('v-spacer'),_c('v-btn',{staticClass:\"mx-2\",attrs:{\"small\":\"\"},on:{\"click\":_vm.onAddOverlay}},[_vm._v(\"Add overlay\")])],1),_c('v-row',{attrs:{\"no-gutters\":\"\"}},[_c('v-expansion-panels',[_c('draggable',{staticClass:\"row mx-2 my-2\",attrs:{\"handle\":\".drag-handle\"},model:{value:(_vm.overlays),callback:function ($$v) {_vm.overlays=$$v},expression:\"overlays\"}},_vm._l((_vm.overlays),function(overlay,i){return _c('v-expansion-panel',{key:i},[_c('v-expansion-panel-header',[_c('v-row',{staticClass:\"align-center\",attrs:{\"no-gutters\":\"\"}},[_c('v-icon',{staticClass:\"mx-2 drag-handle\"},[_vm._v(\" mdi-drag-horizontal-variant \")]),_c('v-icon',{staticClass:\"mx-2\",on:{\"click\":function($event){$event.stopPropagation();return _vm.toggleVisibility(i)}}},[_vm._v(_vm._s(_vm.visibilityIcon(_vm.overlays_[i].visible)))]),_vm._v(_vm._s(overlay.name)+\" \")],1)],1),_c('v-expansion-panel-content',[_c('v-row',[_c('v-select',{attrs:{\"items\":_vm.colorMaps,\"label\":\"Color map\"},on:{\"change\":function($event){return _vm.onColorChange(i)}},model:{value:(overlay.colorMap),callback:function ($$v) {_vm.$set(overlay, \"colorMap\", $$v)},expression:\"overlay.colorMap\"}})],1),_c('v-row',[_c('v-col',{staticClass:\"px-4\"},[_c('p',[_vm._v(\"Intensity range\")]),_c('v-range-slider',{staticClass:\"align-center\",attrs:{\"max\":overlay.intensityMax,\"min\":overlay.intensityMin,\"hide-details\":\"\"},scopedSlots:_vm._u([{key:\"prepend\",fn:function(){return [_c('v-text-field',{staticClass:\"mt-0 pt-0\",staticStyle:{\"width\":\"60px\"},attrs:{\"value\":overlay.intensityRange[0],\"hide-details\":\"\",\"single-line\":\"\",\"type\":\"number\"},on:{\"input\":function($event){return _vm.$set(overlay.intensityRange, 0, $event)}}})]},proxy:true},{key:\"append\",fn:function(){return [_c('v-text-field',{staticClass:\"mt-0 pt-0\",staticStyle:{\"width\":\"60px\"},attrs:{\"value\":overlay.intensityRange[1],\"hide-details\":\"\",\"single-line\":\"\",\"type\":\"number\"},on:{\"input\":function($event){return _vm.$set(overlay.intensityRange, 1, $event)}}})]},proxy:true}],null,true),model:{value:(overlay.intensityRange),callback:function ($$v) {_vm.$set(overlay, \"intensityRange\", $$v)},expression:\"overlay.intensityRange\"}})],1)],1),_c('v-row',[_c('v-col',[_c('p',[_vm._v(\"Opacity\")]),_c('v-slider',{attrs:{\"step\":\"0.01\",\"max\":\"1\",\"min\":\"0\",\"thumb-label\":\"\",\"ticks\":\"\"},on:{\"input\":function($event){return _vm.onOpacityChange(i, overlay.opacity)}},model:{value:(overlay.opacity),callback:function ($$v) {_vm.$set(overlay, \"opacity\", $$v)},expression:\"overlay.opacity\"}})],1)],1)],1)],1)}),1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import Vue from 'vue';\nexport const bus = new Vue();\n","<template>\n\n  <div class='mt-5' id=\"controls\" >\n    <v-row class=\"my-2 mx-2 align-center\">\n      <h3>Layers</h3>\n      <v-spacer></v-spacer>\n      <v-btn @click='onAddOverlay' class=\"mx-2\" small>Add overlay</v-btn>\n    </v-row>\n    <v-row no-gutters>\n      <v-expansion-panels>\n        <draggable handle='.drag-handle' class=\"row mx-2 my-2\" v-model=\"overlays\">\n          <v-expansion-panel\n          v-for=\"(overlay, i) in overlays\"\n          :key=\"i\">\n          <v-expansion-panel-header>\n            <v-row no-gutters class=\"align-center\">\n              <v-icon class=\"mx-2 drag-handle\"> mdi-drag-horizontal-variant </v-icon>\n              <v-icon class=\"mx-2\" @click.stop=\"toggleVisibility(i)\">{{ visibilityIcon(overlays_[i].visible) }}</v-icon>{{ overlay.name }}\n            </v-row>\n            \n          </v-expansion-panel-header>\n          <v-expansion-panel-content>\n            <v-row>\n              <v-select\n                :items=\"colorMaps\"\n                v-model=\"overlay.colorMap\"\n                @change=\"onColorChange(i)\"\n                label=\"Color map\">\n              </v-select>\n            </v-row>\n            <v-row>\n             <v-col class=\"px-4\">\n              <p>Intensity range</p>\n              <v-range-slider\n                v-model=\"overlay.intensityRange\"\n                :max=\"overlay.intensityMax\"\n                :min=\"overlay.intensityMin\"\n                hide-details\n                class=\"align-center\"\n\n              >\n                <template v-slot:prepend>\n                  <v-text-field\n                    :value=\"overlay.intensityRange[0]\"\n                    class=\"mt-0 pt-0\"\n                    hide-details\n                    single-line\n                    type=\"number\"\n                    style=\"width: 60px\"\n                    @input=\"$set(overlay.intensityRange, 0, $event)\"\n                  ></v-text-field>\n                </template>\n                <template v-slot:append>\n                  <v-text-field\n                    :value=\"overlay.intensityRange[1]\"\n                    class=\"mt-0 pt-0\"\n                    hide-details\n                    single-line\n                    type=\"number\"\n                    style=\"width: 60px\"\n                    @input=\"$set(overlay.intensityRange, 1, $event)\"\n                  ></v-text-field>\n                </template>\n              </v-range-slider>\n            </v-col> \n            </v-row>\n\n            <v-row>\n              <v-col>\n              <p>Opacity</p>\n                <v-slider\n                  v-model=\"overlay.opacity\"\n                  step=\"0.01\"\n                  max=\"1\"\n                  min=\"0\"\n                  thumb-label\n                  ticks\n                  @input=\"onOpacityChange(i, overlay.opacity)\"\n                >\n                </v-slider>\n              </v-col>\n            </v-row>\n          </v-expansion-panel-content>\n        </v-expansion-panel>\n        </draggable>\n      </v-expansion-panels>\n    </v-row>\n\n    \n  </div>\n\n</template>\n\n<script>\nimport draggable from \"vuedraggable\";\nimport {bus} from \"@/bus.js\"\n\nexport default {\n  props: {\n    overlays: Array,\n  },\n\n  name: 'controls',\n\n  components: {\n    draggable\n  },\n\n  data (){\n    return {\n      //colorSelected: 'gray',\n      colorMaps:['gray', 'Winter', 'Warm', 'Plasma', 'Viridis', 'Inferno'],\n      //selectedColorMap: 'gray',\n      eyeIcon: \"mdi-eye\",\n      overlays_: this.overlays,\n      draggable: true,\n      opacity: 1.0,\n      overlayVisibilityState: {},\n      \n    }\n  },\n\n  methods: {\n    toggleVisibility: function(index) {\n      // to trigger change detection: https://vuejs.org/v2/guide/reactivity.html#Change-Detection-Caveats\n      // https://stackoverflow.com/questions/53557086/vue-how-to-perform-reactive-object-change-detection-in-v-for\n      if (this.overlays_.length === 1) {\n        // disable eye toggle if only one overlay. Why remove the only visiable thing?\n        return\n      }\n      this.$set(this.overlays_[index], 'visible', !this.overlays_[index].visible);\n\n      let vis = this.overlays_[index].visible\n      if (vis){\n        bus.$emit('opacity-change', {volIdx:index, newOpacity:1});\n      } else {\n        bus.$emit('opacity-change', {volIdx:index, newOpacity:0});\n      }\n    },\n\n    visibilityIcon: function(val) {\n      return val ? 'mdi-eye' : 'mdi-eye-off';\n    },\n\n    onColorChange: function(i) {\n      console.log(i)\n      bus.$emit('colormap-change');\n\n    },\n\n    onOpacityChange: function(i, newOpacity) {\n      bus.$emit('opacity-change', {volIdx:i, newOpacity:newOpacity});\n\n    },\n\n    onAddOverlay: function () {\n      alert('adding overlays in this demo is not implemented yet! :)')\n    },\n\n  }\n\n};\n\n</script>\n\n<style scoped>\n\ndrag-handle {\n  color: black;\n}\n\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./controls.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./controls.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./controls.vue?vue&type=template&id=861f600c&scoped=true&\"\nimport script from \"./controls.vue?vue&type=script&lang=js&\"\nexport * from \"./controls.vue?vue&type=script&lang=js&\"\nimport style0 from \"./controls.vue?vue&type=style&index=0&id=861f600c&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"861f600c\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VExpansionPanel } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanelContent } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanelHeader } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanels } from 'vuetify/lib/components/VExpansionPanel';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VRangeSlider } from 'vuetify/lib/components/VRangeSlider';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSelect } from 'vuetify/lib/components/VSelect';\nimport { VSlider } from 'vuetify/lib/components/VSlider';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VTextField } from 'vuetify/lib/components/VTextField';\ninstallComponents(component, {VBtn,VCol,VExpansionPanel,VExpansionPanelContent,VExpansionPanelHeader,VExpansionPanels,VIcon,VRangeSlider,VRow,VSelect,VSlider,VSpacer,VTextField})\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"viewer\",attrs:{\"id\":\"viewer\"}},[_c('v-dialog',{attrs:{\"max-width\":\"400\"},model:{value:(_vm.dialog),callback:function ($$v) {_vm.dialog=$$v},expression:\"dialog\"}},[_c('v-color-picker',{attrs:{\"width\":\"400\",\"mode\":\"rgba\"},on:{\"input\":_vm.onCrosshairColorChange},model:{value:(_vm.crosshairColor),callback:function ($$v) {_vm.crosshairColor=$$v},expression:\"crosshairColor\"}})],1),_c('v-dialog',{attrs:{\"max-width\":\"400\"},model:{value:(_vm.discoMode),callback:function ($$v) {_vm.discoMode=$$v},expression:\"discoMode\"}},[_c('v-card',{attrs:{\"color\":\"rgba(0, 0, 0, 0.4)\"}},[_c('v-row',{attrs:{\"no-gutters\":\"\"}},[_c('v-spacer'),_c('h2',{staticStyle:{\"color\":\"white\"}},[_vm._v(\"Disco mode\")]),_c('v-spacer')],1)],1)],1)],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"viewer\" id=\"viewer\" >\n    <v-dialog\n      v-model=\"dialog\"\n      max-width=\"400\">\n      <v-color-picker width=400 mode='rgba' v-model=\"crosshairColor\" @input=\"onCrosshairColorChange\">\n      </v-color-picker>\n    </v-dialog>\n\n    <v-dialog\n      v-model=\"discoMode\"\n      max-width=\"400\">\n      <v-card color=\"rgba(0, 0, 0, 0.4)\">\n        <v-row no-gutters>  \n          <v-spacer></v-spacer>\n          <h2 style=\"color: white;\">Disco mode</h2>\n          <v-spacer></v-spacer>\n        </v-row>\n      </v-card>\n    </v-dialog>\n  </div>\n</template>\n<script>\nimport * as Hammer from 'hammerjs';\nimport {Niivue} from \"../niivue.js\";\nimport {bus} from \"@/bus.js\"\n\n\nexport default {\n  name: \"glviewer\",\n  /*\n  props are passed to the nii-vue component from it's parent\n  they can be used. Similar to passing variables to a function\n  */\n  props: {\n    overlays: Array,\n    shader: String,\n  },\n  created () {\n    \n\n\n  },\n  \n  data() {\n    return {\n      niivue: null,\n      selectedOverlay: 0,\n      last2DSliceVal: 0.5,\n      mouseDown: false,\n      touchDown: false,\n      zDown: false,\n      discoMode: false,\n      discoModeColorMapTimer: null,\n      discoModeCrosshairTimer: null,\n      scale: 1,\n      dialog: false,\n      crosshairColor: { r: 255, g: 0, b: 0, a: 1 },\n      colorMaps:['Winter', 'Warm', 'Plasma', 'Viridis', 'Inferno'],\n      selectedColorMap: 'Winter',\n\n    };\n  },\n  watch: {\n    // watch for changes to hdr property of volume object\n    // this detects changes from hdr=null to hdr=real_data\n    overlays: {\n      deep: true,\n      handler () {\n        //nv.selectColormap(this.gl, this.overlays[this.selectedOverlay].colorMap)\n        //nv.updateGLVolume(this.gl, this.overlays[this.selectedOverlay])\n    },\n\n    }\n    \n      },\n  methods: {\n    setNewPos: function(){\n      let newMM = this.niivue.frac2mm([this.niivue.scene.crosshairPos[0],this.niivue.scene.crosshairPos[1],this.niivue.scene.crosshairPos[2]]); \n      bus.$emit('mm-change', newMM);\n\n    },\n\n    onWindowResize: function() {\n      var bottomStatusBarHeight = 100 // this is an estimate\n      var canvas = document.querySelector(\"#gl\") \n      var viewer = document.querySelector(\"#viewer\")\n      canvas.width =  viewer.clientWidth\n      canvas.height = viewer.clientHeight\n      // there has to be a better way to handle this resizing. It seems odd to need the document (window) client\n      // height for this to work. \n      if (viewer.getBoundingClientRect().bottom > document.documentElement.clientHeight){\n        viewer.style.height = document.documentElement.clientHeight - bottomStatusBarHeight\n        canvas.height = document.documentElement.clientHeight - bottomStatusBarHeight\n      }\n      this.niivue.drawScene()\n    },\n\n    onCrosshairColorChange: function() {\n      var floatColor = [this.crosshairColor.r/255, this.crosshairColor.g/255, this.crosshairColor.b/255, this.crosshairColor.a]\n      this.niivue.setCrosshairColor(floatColor)\n    }\n\n  },\n  mounted() {\n    // get the gl context after the component has been mounted and initialized\n    const glEl = document.createElement('canvas')\n    glEl.classList.add('fillParent')\n    const viewer = document.querySelector(\"#viewer\")\n    glEl.id = \"gl\"\n    glEl.width = viewer.clientWidth//viewer.offsetWidth-1\n    glEl.height = viewer.clientHeight//viewer.offsetHeight-1\n    viewer.appendChild(glEl)\n    const canvas = document.querySelector(\"#gl\");\n    const gl = canvas.getContext(\"webgl2\");\n    if (!gl) {\n      if (typeof(WebGL2RenderingContext) !== 'undefined') {\n        alert('your browser appears to support WebGL2 but it might be disabled. Niivue might not work');\n      } else {\n        alert('your browser has no WebGL2 support, Niivue will not work! If you are using safari, you can enable the developer menu and activate the WebGL2 item under experimental features.');\n      }\n    } else {\n      console.log('webgl2 works!');\n    }\n\n    var gc = new Hammer(canvas); // gesture controller\n    gc.get('press').set({ time: 2000 });\n    gc.get('pinch').set({ enable: true });\n\n    gl.canvas.addEventListener('mousedown', (e) => {\n      e.preventDefault()\n      this.dialog = false\n      this.mouseDown = true\n      var rect = canvas.getBoundingClientRect()\n      this.niivue.mouseClick(e.clientX - rect.left, e.clientY - rect.top)\n      this.niivue.mouseDown(e.clientX - rect.left,e.clientY - rect.top)\n      this.setNewPos()\n    })\n    \n    gl.canvas.addEventListener('touchstart', (e) => {\n      e.preventDefault()\n      this.dialog = false\n      this.touchDown = true\n      var rect = canvas.getBoundingClientRect()\n      this.niivue.mouseClick(e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top)\n      this.niivue.mouseDown(e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top)\n      this.setNewPos()\n    })\n\n    \n    gl.canvas.addEventListener('mousemove', (e) => {\n      if (this.mouseDown) {\n        var rect = canvas.getBoundingClientRect()\n        // mouseClick if any 2D mode\n        this.niivue.mouseClick(e.clientX - rect.left, e.clientY - rect.top)\n        // mouseMove if 3D render mode\n        this.niivue.mouseMove(e.clientX - rect.left,e.clientY - rect.top)\n        this.setNewPos()\n      }\n    })\n\n    gl.canvas.addEventListener('touchmove', (e) => {\n      if (this.touchDown && e.touches.length < 2) {\n        var rect = canvas.getBoundingClientRect()\n        this.niivue.mouseClick(e.touches[0].clientX - rect.left, e.touches[0].clientY - rect.top)\n        this.niivue.mouseMove(e.touches[0].clientX - rect.left,e.touches[0].clientY - rect.top)\n        this.setNewPos()\n      }\n    })\n\n\n    gc.on('pinchin', () => {\n      // scroll 2D slices \n      this.niivue.sliceScroll2D(0.001, null, null)\n      this.setNewPos()\n    })\n\n    gc.on('pinchout', () => {\n      // scroll 2D slices \n      this.niivue.sliceScroll2D(-0.001, null, null)\n      this.setNewPos()\n    })\n\n    gl.canvas.addEventListener('wheel', (e) => {\n      if (this.zDown) {\n        e.preventDefault()\n        this.scale += e.deltaY * -0.01\n        this.niivue.setScale(this.scale)\n      } else {\n        // scroll 2D slices \n        e.preventDefault()\n        e.stopPropagation()\n        var rect = canvas.getBoundingClientRect()\n        if (e.deltaY < 0){\n          this.niivue.sliceScroll2D(-0.01, e.clientX - rect.left, e.clientY - rect.top)\n        } else {\n          this.niivue.sliceScroll2D(0.01, e.clientX - rect.left, e.clientY - rect.top)\n        }\n        this.setNewPos()\n        \n      }\n    })\n\n    gc.on('press', () => {\n      this.dialog = true\n    })\n\n    gl.canvas.addEventListener('mouseup', () => {\n      this.mouseDown = false\n    })\n\n    gl.canvas.addEventListener('tocuhend', () => {\n      this.touchDown = false\n    })\n\n\n    window.addEventListener('keypress', (e) => {\n      if (e.key === 'z') {\n        this.zDown = true\n      }\n      if (e.key === 'd') {\n        this.discoMode = this.discoMode == false ? true: false\n        clearInterval(this.discoModeColorMapTimer)\n        clearInterval(this.discoModeCrosshairTimer)\n        if (this.discoMode) {\n          this.discoModeColorMapTimer = setInterval(\n            () => {\n              bus.$emit('colormap-change', this.colorMaps[Math.floor(Math.random() * this.colorMaps.length)]);\n\n            }, 200)\n          this.discoModeCrosshairTimer = setInterval(\n            function () {\n              this.niivue.setCrosshairColor([Math.random(), Math.random(), Math.random(), 1])\n            }, 200)\n        } else {\n          bus.$emit('colormap-change', \"gray\");\n          this.niivue.setCrosshairColor([1, 0, 0, 1])\n\n        }\n      }\n\n    })\n\n    window.addEventListener('keyup', (e) => {\n      if (e.key === 'z') {\n        this.zDown = false\n      }\n    })\n\n    window.addEventListener('resize', this.onWindowResize)\n\n    this.niivue = new Niivue({}).attachTo('#gl')\n\n    this.gl = gl;\n    \n    this.niivue.loadVolumes(this.overlays); // pass in all overlays (an array)\n   \n    // opacity is an object with properties:\n    // int:   volIdx        The index of the volume being changed in the array of volumes\n    // float: newOpacity    This new Opacity to set for that volume\n    bus.$on('opacity-change', (opacity) => {\n      this.niivue.setOpacity(opacity.volIdx, opacity.newOpacity)\n    });\n\n    bus.$on('slice-type-change', function (sliceType) {\n      this.niivue.setSliceType(sliceType)\n    }.bind(this));\n\n    bus.$on('set-2D-slice', function (slicePosVal) {\n      this.niivue.sliceScroll2D(slicePosVal, null, null, false) // x,y = null\n    }.bind(this));\n\n    bus.$on('set-clip-planes', function (newPlanes) {\n      this.niivue.clipPlaneUpdate(newPlanes)\n    }.bind(this));\n\n    bus.$on('colormap-change', function () {\n      this.niivue.loadVolumes(this.overlays); \n    }.bind(this));\n\n    bus.$on('refresh', function () {\n      this.niivue.updateGLVolume(this.overlays); \n    }.bind(this));\n  },\n};\n\n</script>\n\n<style scoped>\n.viewer {\n  background-color: black;\n  width: 100%;\n  height:100%;\n  line-height:0;\n}\n\n.fillParent {\n  height: 100%;\n  width: 100%;\n}\n\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./glviewer.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./glviewer.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./glviewer.vue?vue&type=template&id=690d447c&scoped=true&\"\nimport script from \"./glviewer.vue?vue&type=script&lang=js&\"\nexport * from \"./glviewer.vue?vue&type=script&lang=js&\"\nimport style0 from \"./glviewer.vue?vue&type=style&index=0&id=690d447c&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"690d447c\",\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VCard } from 'vuetify/lib/components/VCard';\nimport { VColorPicker } from 'vuetify/lib/components/VColorPicker';\nimport { VDialog } from 'vuetify/lib/components/VDialog';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\ninstallComponents(component, {VCard,VColorPicker,VDialog,VRow,VSpacer})\n","<template>\n  <v-app>\n    <v-app-bar app>\n      <!-- make app bar scroll in horizontal direction -->\n      <!--\n      <v-tabs v-model='tab'>\n        <v-tabs-slider color='black'></v-tabs-slider>\n        <v-tab\n          v-for='item in appTabs'\n          :key='item'>\n          {{ item }}\n        </v-tab>\n      </v-tabs>\n      -->\n      <h2>Niivue</h2>\n      <v-spacer>\n      </v-spacer>\n    </v-app-bar>\n\n    <v-main>\n      <v-row style=\"height:100%\">\n      <!-- app uses a 12 column layout, so the controls take up 4 columns on the left of the screen -->\n      <v-col sm=12 md=12 lg=4>\n        <controls :overlays=\"urlOverlayList\">\n        </controls>\n      </v-col>\n\n      <v-col sm=12 md=12 lg=8>\n        <v-toolbar elevation=0 class=\"pa-0 ma-0\">\n          <v-btn @click='setSliceType(0)'>A</v-btn>\n          <v-btn @click='setSliceType(2)'>S</v-btn>\n          <v-btn @click='setSliceType(1)'>C</v-btn>\n          <v-btn @click='setSliceType(4)'>R</v-btn>\n          <v-btn @click='setSliceType(3)'>MP</v-btn>\n          <v-spacer></v-spacer>\n        </v-toolbar>\n      <v-expansion-panels v-if=\"viewShown2D == true || viewShown3D == true\">\n          <v-expansion-panel>\n          <v-expansion-panel-header>\n            <v-row no-gutters class=\"align-center\">\n              Controls\n              <v-icon class=\"mx-2\"> mdi-arrow-expand-vertical </v-icon>\n            </v-row>\n          </v-expansion-panel-header>\n          <v-expansion-panel-content>\n            <v-row v-if=\"viewShown2D == true\">\n            <v-slider\n              v-model=\"sliceScrollVal\"\n              step=\"0.01\"\n              max=\"1\"\n              min=\"0\"\n              thumb-label\n              @input=\"onSliceSlider2D\"\n              label=\"slice\"\n            >\n            </v-slider>\n          </v-row>\n          <v-row v-if=\"viewShown3D == true\">\n            <v-slider\n                v-model=\"clipValAz\"\n                step=\"1\"\n                max=\"360\"\n                min=\"0\"\n                thumb-label\n                @input=\"onClipPlaneChange\"\n                label=\"clip Azimu\"\n              >\n            </v-slider>\n          </v-row>\n          <v-row v-if=\"viewShown3D == true\">\n            <v-slider\n                v-model=\"clipValEl\"\n                step=\"1\"\n                max=\"90\"\n                min=\"-90\"\n                thumb-label\n                @input=\"onClipPlaneChange\"\n                label=\"clip Eleva\"\n              >\n            </v-slider>\n          </v-row>\n          <v-row v-if=\"viewShown3D == true\">\n            <v-slider\n                v-model=\"clipValDepth\"\n                step=\"0.005\"\n                max=\"0.5\"\n                min=\"0\"\n                thumb-label\n                @input=\"onClipPlaneChange\"\n                label=\"clip Depth\"\n              >\n            </v-slider>\n          </v-row>\n          <v-row>\n            <v-btn v-if=\"viewShown3D\" @click=\"onResetClipPlane\" class='mx-auto'>reset</v-btn>\n          </v-row>\n          </v-expansion-panel-content>\n        </v-expansion-panel>\n      </v-expansion-panels>\n\n        <glviewer :overlays=\"urlOverlayList\"></glviewer>\n      </v-col>\n    </v-row>\n    </v-main>\n    <v-footer app>\n      <v-row >\n        <v-col align=\"center\" justify=\"center\" >\n          <span class='text-caption'>{{ coordinateString }}</span> \n        </v-col>\n      </v-row>\n    </v-footer>\n  </v-app>\n</template>\n\n<script>\nimport controls from './components/controls.vue'\nimport glviewer from './components/glviewer.vue'\nimport {bus} from \"@/bus.js\"\n\nexport default {\n  name: 'App',\n\n  components: {\n    controls,\n    glviewer\n  },\n\n  created () {\n    bus.$on('mm-change', (pos) => {\n    this.coordinateString = pos[0].toFixed(2)+'×'+pos[1].toFixed(2)+'×'+pos[2].toFixed(2);\n    });\n\n  },\n  data (){\n    return {\n      tab: null,\n      viewShown2D: false,\n      viewShown3D: false,\n      clipValAz: 0,\n      clipValEl: 0,\n      clipValDepth: 0.5,\n      sliceScrollVal: 0.5,\n      appTabs: ['Menu', 'Draw', 'Edit', 'Scripting'],\n      coordinateString: '0x0x0',\n      overlayList: [\n      // first item is brackground image\n        {\n          url: \"./LAS.nii.gz\",//\"./RAS.nii.gz\", \"./spm152.nii.gz\",\n          volume: {hdr: null, img: null},\n          name: \"LAS.nii.gz\",\n          intensityMin: 0, // not used yet\n          intensityMax: 100, // not used yet\n          intensityRange:[0, 100], // not used yet\n          colorMap: \"gray\",\n          opacity: 100,\n          visible: true,\n        },\n        {\n          url: \"./hippo.nii.gz\",\n          volume: {hdr: null, img: null},\n          name: \"hippo.nii.gz\",\n          intensityMin: 0, // not used yet\n          intensityMax: 100, // not used yet\n          intensityRange:[0, 100], // not used yet\n          colorMap: \"Winter\",\n          opacity: 100,\n          visible: true,\n        },\n      ]\n    }\n  },\n  computed: {\n    urlOverlayList: function(){\n      let vols = []\n      if (this.$route.query.urls === undefined || this.$route.query.urls === null || this.$route.query.urls === ''){\n        return this.overlayList\n      }\n      let urls = this.$route.query.urls.split(\",\")\n      for (let i=0; i<urls.length; i++){\n        vols.push(\n          { \n            url: urls[i],\n            volume:{hdr:null, img:null},\n            name: urls[i].split('/').pop(),\n            intensityMin:0,\n            intensityMax:100,\n            intensityRange: [0,100],\n            colorMap: \"gray\",\n            opacity: 100,\n            visible: true,\n          }\n        )\n      }\n      if (vols.length > 0){\n        bus.$emit('refresh');\n        return vols\n      } else {\n        return this.overlayList // defaults\n      }\n    }\n  },\n\n  methods: {\n    setSliceType: function(sliceType) {\n      if (sliceType < 3 ){\n        this.viewShown2D = true\n        this.viewShown3D = false\n      } else if (sliceType == 4) {\n        this.viewShown2D = false\n        this.viewShown3D = true\n      } else {\n        this.viewShown2D = false\n        this.viewShown3D = false\n      }\n      bus.$emit('slice-type-change', sliceType);\n    },\n\n    onSliceSlider2D: function() {\n      if (this.viewShown2D){\n        bus.$emit('set-2D-slice', this.sliceScrollVal);\n      }           \n    },\n\n    onClipPlaneChange: function() {\n      if (this.viewShown3D){\n        bus.$emit('set-clip-planes', [this.clipValAz, this.clipValEl, this.clipValDepth]);\n\n      }           \n    },\n\n    onResetClipPlane: function() {\n      if (this.viewShown3D){\n        this.clipValAz = 0\n        this.clipValEl = 0\n        this.clipValDepth = 2\n        bus.$emit('set-clip-planes', [this.clipValAz, this.clipValEl, this.clipValDepth]);\n\n      }           \n    }\n\n\n  },\n};\n</script>\n\n<style>\n\n\n</style>\n","import mod from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../node_modules/cache-loader/dist/cjs.js??ref--12-0!../node_modules/thread-loader/dist/cjs.js!../node_modules/babel-loader/lib/index.js!../node_modules/cache-loader/dist/cjs.js??ref--0-0!../node_modules/vue-loader/lib/index.js??vue-loader-options!./App.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./App.vue?vue&type=template&id=81691dc4&\"\nimport script from \"./App.vue?vue&type=script&lang=js&\"\nexport * from \"./App.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports\n\n/* vuetify-loader */\nimport installComponents from \"!../node_modules/vuetify-loader/lib/runtime/installComponents.js\"\nimport { VApp } from 'vuetify/lib/components/VApp';\nimport { VAppBar } from 'vuetify/lib/components/VAppBar';\nimport { VBtn } from 'vuetify/lib/components/VBtn';\nimport { VCol } from 'vuetify/lib/components/VGrid';\nimport { VExpansionPanel } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanelContent } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanelHeader } from 'vuetify/lib/components/VExpansionPanel';\nimport { VExpansionPanels } from 'vuetify/lib/components/VExpansionPanel';\nimport { VFooter } from 'vuetify/lib/components/VFooter';\nimport { VIcon } from 'vuetify/lib/components/VIcon';\nimport { VMain } from 'vuetify/lib/components/VMain';\nimport { VRow } from 'vuetify/lib/components/VGrid';\nimport { VSlider } from 'vuetify/lib/components/VSlider';\nimport { VSpacer } from 'vuetify/lib/components/VGrid';\nimport { VToolbar } from 'vuetify/lib/components/VToolbar';\ninstallComponents(component, {VApp,VAppBar,VBtn,VCol,VExpansionPanel,VExpansionPanelContent,VExpansionPanelHeader,VExpansionPanels,VFooter,VIcon,VMain,VRow,VSlider,VSpacer,VToolbar})\n","import '@mdi/font/css/materialdesignicons.css'\nimport Vue from 'vue';\nimport Vuetify from 'vuetify/lib/framework';\nimport 'vuetify/dist/vuetify.min.css'\n\nVue.use(Vuetify);\n\nexport default new Vuetify({\n  icons: {\n    iconfont: \"mdi\"\n  }\n\n});\n","import 'material-design-icons-iconfont/dist/material-design-icons.css'\nimport 'typeface-roboto/index.css'\nimport Vue from 'vue'\nimport App from './App.vue'\nimport Router from \"vue-router\"\nimport vuetify from './plugins/vuetify';\n\nVue.use(Router)\n\nVue.config.productionTip = false\n\nconst router = new Router({\n   routes: [],\n   mode: 'history'\n })\n\nnew Vue({\n  vuetify,\n  router,\n  render: h => h(App)\n}).$mount('#app')\n","export var vertRenderShader =\n`#version 300 es\n#line 4\nlayout(location=0) in vec3 pos;\nuniform mat4 mvpMtx;\nout vec3 vColor;\nvoid main(void) {\n\tgl_Position = mvpMtx * vec4(2.0 * (pos.xyz - 0.5), 1.0);\n\tvColor = pos;\n}`;\n\nexport var fragRenderShader =\n`#version 300 es\n#line 15\nprecision highp int;\nprecision highp float;\nuniform vec3 rayDir;\nuniform vec3 texVox;\nuniform vec4 clipPlane;\nuniform highp sampler3D volume, overlay;\nuniform float overlays;\nuniform float backOpacity;\nin vec3 vColor;\nout vec4 fColor;\nvec3 GetBackPosition (vec3 startPosition) {\n vec3 invR = 1.0 / rayDir;\n vec3 tbot = invR * (vec3(0.0)-startPosition);\n vec3 ttop = invR * (vec3(1.0)-startPosition);\n vec3 tmax = max(ttop, tbot);\n vec2 t = min(tmax.xx, tmax.yz);\n return startPosition + (rayDir * min(t.x, t.y));\n}\nvec4 applyClip (vec3 dir, inout vec4 samplePos, inout float len) {\n\tfloat cdot = dot(dir,clipPlane.xyz);\n\tif  ((clipPlane.a > 1.0) || (cdot == 0.0)) return samplePos;\n    bool frontface = (cdot > 0.0);\n\tfloat clipThick = 2.0;\n    float dis = (-clipPlane.a - dot(clipPlane.xyz, samplePos.xyz-0.5)) / cdot;\n    float  disBackFace = (-(clipPlane.a-clipThick) - dot(clipPlane.xyz, samplePos.xyz-0.5)) / cdot;\n    if (((frontface) && (dis >= len)) || ((!frontface) && (dis <= 0.0))) {\n        samplePos.a = len + 1.0;\n        return samplePos;\n    }\n    if (frontface) {\n        dis = max(0.0, dis);\n        samplePos = vec4(samplePos.xyz+dir * dis, dis);\n        len = min(disBackFace, len);\n    }\n    if (!frontface) {\n        len = min(dis, len);\n        disBackFace = max(0.0, disBackFace);\n        samplePos = vec4(samplePos.xyz+dir * disBackFace, disBackFace);\n    }\n    return samplePos;\n}\nvoid main() {\n    fColor = vec4(0.0,0.0,0.0,0.0);\n\tvec3 start = vColor;\n\tvec3 backPosition = GetBackPosition(start);\n\t//fColor = vec4(backPosition, 1.0); return;\n    vec3 dir = backPosition - start;\n    float len = length(dir);\n\tfloat lenVox = length((texVox * start) - (texVox * backPosition));\n\tif (lenVox < 0.5) return;\n\tfloat sliceSize = len / lenVox; //e.g. if ray length is 1.0 and traverses 50 voxels, each voxel is 0.02 in unit cube\n\tfloat stepSize = sliceSize; //quality: larger step is faster traversal, but fewer samples\n\tfloat opacityCorrection = stepSize/sliceSize;\n    dir = normalize(dir);\n\tvec4 deltaDir = vec4(dir.xyz * stepSize, stepSize);\n\tvec4 samplePos = vec4(start.xyz, 0.0); //ray position\n\tfloat lenNoClip = len;\n\tvec4 clipPos = applyClip(dir, samplePos, len);\n\t//start: OPTIONAL fast pass: rapid traversal until first hit\n\tfloat stepSizeFast = sliceSize * 1.9;\n\tvec4 deltaDirFast = vec4(dir.xyz * stepSizeFast, stepSizeFast);\n\twhile (samplePos.a <= len) {\n\t\tfloat val = texture(volume, samplePos.xyz).r;\n\t\tif (val > 0.01) break;\n\t\tsamplePos += deltaDirFast; //advance ray position\n\t}\n\tif ((samplePos.a > len) && (overlays < 1.0)) return;\n\tsamplePos -= deltaDirFast;\n\tif (samplePos.a < 0.0)\n\t\tvec4 samplePos = vec4(start.xyz, 0.0); //ray position\n\t//end: fast pass\n\tvec4 colAcc = vec4(0.0,0.0,0.0,0.0);\n\tconst float earlyTermination = 0.95;\n\tfloat backNearest = len; //assume no hit\n    float ran = fract(sin(gl_FragCoord.x * 12.9898 + gl_FragCoord.y * 78.233) * 43758.5453);\n    samplePos += deltaDir * ran; //jitter ray\n\twhile (samplePos.a <= len) {\n\t\tvec4 colorSample = texture(volume, samplePos.xyz);\n\t\tsamplePos += deltaDir; //advance ray position\n\t\tif (colorSample.a < 0.01) continue;\n\t\tbackNearest = min(backNearest, samplePos.a);\n\t\tcolorSample.a = 1.0-pow((1.0 - colorSample.a), opacityCorrection);\n\t\tcolorSample.rgb *= colorSample.a;\n\t\tcolAcc= (1.0 - colAcc.a) * colorSample + colAcc;\n\t\tif ( colAcc.a > earlyTermination )\n\t\t\tbreak;\n\t}\n\tcolAcc.a = (colAcc.a / earlyTermination) * backOpacity;\n\tfColor = colAcc;\n\tif (overlays < 1.0) return;\n\t//overlay pass\n\tlen = lenNoClip;\n\tsamplePos = vec4(start.xyz, 0.0); //ray position\n    //start: OPTIONAL fast pass: rapid traversal until first hit\n\tstepSizeFast = sliceSize * 1.9;\n\tdeltaDirFast = vec4(dir.xyz * stepSizeFast, stepSizeFast);\n\twhile (samplePos.a <= len) {\n\t\tfloat val = texture(overlay, samplePos.xyz).a;\n\t\tif (val > 0.01) break;\n\t\tsamplePos += deltaDirFast; //advance ray position\n\t}\n\tif (samplePos.a > len) return;\n\tsamplePos -= deltaDirFast;\n\tif (samplePos.a < 0.0)\n\t\tvec4 samplePos = vec4(start.xyz, 0.0); //ray position\n\t//end: fast pass\n\tfloat overFarthest = len;\n\tcolAcc = vec4(0.0, 0.0, 0.0, 0.0);\n\tsamplePos += deltaDir * ran; //jitter ray\n\twhile (samplePos.a <= len) {\n\t\tvec4 colorSample = texture(overlay, samplePos.xyz);\n\t\tsamplePos += deltaDir; //advance ray position\n\t\tif (colorSample.a < 0.01) continue;\n\t\tcolorSample.a = 1.0-pow((1.0 - colorSample.a), opacityCorrection);\n\t\tcolorSample.rgb *= colorSample.a;\n\t\tcolAcc= (1.0 - colAcc.a) * colorSample + colAcc;\n\t\toverFarthest = samplePos.a;\n\t\tif ( colAcc.a > earlyTermination )\n\t\t\tbreak;\n\t}\n\tfloat overMix = colAcc.a;\n\tfloat overlayDepth = 0.3;\n\tif (fColor.a <= 0.0)\n\t\t\toverMix = 1.0;\n\telse if (((overFarthest) > backNearest)) {\n\t\tfloat dx = (overFarthest - backNearest)/1.73;\n\t\tdx = fColor.a * pow(dx, overlayDepth);\n\t\toverMix *= 1.0 - dx;\n\t}\n\tfColor.rgb = mix(fColor.rgb, colAcc.rgb, overMix);\n\tfColor.a = max(fColor.a, colAcc.a);\n}`;\n\nexport var vertSliceShader =\n`#version 300 es\n#line 150\nlayout(location=0) in vec3 pos;\nuniform int axCorSag;\nuniform float slice;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nout vec3 texPos;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n\tif (axCorSag == 1)\n\t\ttexPos = vec3(pos.x, slice, pos.y);\n\telse if (axCorSag == 2)\n\t\ttexPos = vec3(slice, pos.x, pos.y);\n\telse\n\t\ttexPos = vec3(pos.xy, slice);\n}`;\n\nexport var fragSliceShader =\n`#version 300 es\n#line 173\nprecision highp int;\nprecision highp float;\nuniform highp sampler3D volume, overlay;\nuniform float opacity;\nin vec3 texPos;\nout vec4 color;\nvoid main() {\n\tcolor = vec4(texture(volume, texPos).rgb, opacity);\n\tvec4 ocolor = texture(overlay, texPos);\n\tcolor.rgb = mix(color.rgb, ocolor.rgb, ocolor.a);\n\tcolor.a = color.a + (ocolor.a * (1.0 - color.a));\n}`;\n\nexport var fragLineShader =\n`#version 300 es\n#line 189\nprecision highp int;\nprecision highp float;\nuniform vec4 lineColor;\nout vec4 color;\nvoid main() {\n\tcolor = lineColor;\n}`;\n\nexport var vertColorbarShader =\n`#version 300 es\n#line 200\nlayout(location=0) in vec3 pos;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nout float vColor;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n\tvColor = pos.x;\n}`;\n\nexport var fragColorbarShader =\n`#version 300 es\n#line 217\nprecision highp int;\nprecision highp float;\nuniform highp sampler2D colormap;\nin float vColor;\nout vec4 color;\nvoid main() {\n\tcolor = vec4(texture(colormap, vec2(vColor, 0.5)).rgb, 1.0);\n}`;\n\nexport var vertLineShader =\n`#version 300 es\n#line 229\nlayout(location=0) in vec3 pos;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n}`;\n\nexport var vertFontShader =\n`#version 300 es\n#line 244\nlayout(location=0) in vec3 pos;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nuniform vec4 uvLeftTopWidthHeight;\nout vec2 vUV;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n\tvUV = vec2(uvLeftTopWidthHeight.x + (pos.x * uvLeftTopWidthHeight.z), uvLeftTopWidthHeight.y  + ((1.0 - pos.y) * uvLeftTopWidthHeight.w) );\n}`;\n\nexport var fragFontShader =\n`#version 300 es\n#line 262\nprecision highp int;\nprecision highp float;\nuniform highp sampler2D fontTexture;\nuniform vec4 fontColor;\nuniform float screenPxRange;\nin vec2 vUV;\nout vec4 color;\nfloat median(float r, float g, float b) {\n    return max(min(r, g), min(max(r, g), b));\n}\nvoid main() {\n\tvec3 msd = texture(fontTexture, vUV).rgb;\n\tfloat sd = median(msd.r, msd.g, msd.b);\n    float screenPxDistance = screenPxRange*(sd - 0.5);\n    float opacity = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n\tcolor = vec4(fontColor.rgb , fontColor.a * opacity);\n}`;\n\nexport var vertOrientShader =\n`#version 300 es\n#line 283\nprecision highp int;\nprecision highp float;\nin vec3 vPos;\nout vec2 TexCoord;\nvoid main() {\n    TexCoord = vPos.xy;\n    gl_Position = vec4( (vPos.xy-vec2(0.5,0.5))* 2.0, 0.0, 1.0);\n}`;\n\nexport var fragOrientShaderU =\n`#version 300 es\nuniform highp usampler3D intensityVol;\n`;\n\nexport var fragOrientShaderI =\n`#version 300 es\nuniform highp isampler3D intensityVol;\n`;\n\nexport var fragOrientShaderF =\n`#version 300 es\nuniform highp sampler3D intensityVol;\n`;\n\nexport var fragOrientShader =\n`#line 309\nprecision highp int;\nprecision highp float;\nin vec2 TexCoord;\nout vec4 FragColor;\nuniform float coordZ;\nuniform float layer;\nuniform float scl_slope;\nuniform float scl_inter;\nuniform float cal_max;\nuniform float cal_min;\nuniform highp sampler2D colormap;\nuniform highp sampler2D in2D;\nuniform float opacity;\nuniform mat4 mtx;\nvoid main(void) {\n vec4 vx = vec4(TexCoord.xy, coordZ, 1.0) * mtx;\n float f = (scl_slope * float(texture(intensityVol, vx.xyz).r)) + scl_inter;\n float r = max(0.00001, abs(cal_max - cal_min));\n float mn = min(cal_min, cal_max);\n f = mix(0.0, 1.0, (f - mn) / r);\n FragColor = texture(colormap, vec2(f, 0.5)).rgba;\n FragColor.a *= opacity;\n if (layer < 2.0) return;\n vec4 prevColor = texture(in2D, TexCoord);\n FragColor.rgb = mix(FragColor.rgb, prevColor.rgb, FragColor.a);\n FragColor.a += ((1.0 - FragColor.a) * prevColor.a);\n}`; \n\nexport var fragPassThroughShader =\n`#version 300 es\nprecision highp int;\nprecision highp float;\nin vec2 TexCoord;\nout vec4 FragColor;\nuniform float coordZ;\nuniform highp sampler3D in3D;\nvoid main(void) {\n //FragColor = texture(in3D, vec3(TexCoord.xy, coordZ));\n FragColor = vec4(TexCoord.x, TexCoord.y, 1.0, 0.9);\n}`; \n\n","import * as nii from \"nifti-reader-js\"\nimport { Shader } from \"./shader.js\";\nimport * as mat from \"gl-matrix\";\nimport { vertSliceShader, fragSliceShader } from \"./shader-srcs.js\";\nimport { vertLineShader, fragLineShader } from \"./shader-srcs.js\";\nimport { vertRenderShader, fragRenderShader } from \"./shader-srcs.js\";\nimport { vertColorbarShader, fragColorbarShader } from \"./shader-srcs.js\";\nimport { vertFontShader, fragFontShader } from \"./shader-srcs.js\";\nimport { vertOrientShader, fragPassThroughShader, fragOrientShaderU, fragOrientShaderI, fragOrientShaderF, fragOrientShader} from \"./shader-srcs.js\";\n\n/**\n * @class Niivue\n * @description\n * Documentation is a work in progress\n * @constructor\n * @param {object} [opts] options object to set modifiable properties of the canvas\n * @example\n * // All available properties are listed in the example.\n * // All properties are optional. If omitted, a default will be used from Niivue.defaults\n * opts = {\n    textHeight: 0.03,             // 0 for no text, fraction of canvas height\n    colorbarHeight: 0.05,         // 0 for no colorbars, fraction of Nifti j dimension\n    crosshairWidth: 1,            // 0 for no crosshairs\n    backColor: [0, 0, 0, 1],      // [R, G, B, A] range 0..1\n    crosshairColor: [1, 0, 0 ,1], // [R, G, B, A] range 0..1\n    colorBarMargin: 0.05          // x axis margin arount color bar, fraction of canvas width\n  }\n\n  let myNiivue = new Niivue(opts)\n */\nexport let Niivue = function(opts={}){\n\n  this.opts = {} // will be populate with opts or defaults when a new Niivue object instance is created\n\n  /**\n   * @memberof Niivue\n   * @property {object} defaults - the default values for all options a user might supply in an opts object\n   * @example\n   * // The example shows all available use configurable properties.\n   * this.defaults = {\n    textHeight: 0.03,             // 0 for no text, fraction of canvas height\n    colorbarHeight: 0.05,         // 0 for no colorbars, fraction of Nifti j dimension\n    crosshairWidth: 1,            // 0 for no crosshairs\n    backColor: [0, 0, 0, 1],      // [R, G, B, A] range 0..1\n    crosshairColor: [1, 0, 0 ,1], // [R, G, B, A] range 0..1\n    colorBarMargin: 0.05          // x axis margin arount color bar, fraction of canvas width\n  }\n\n   *\n   */\n  this.defaults = {\n    textHeight: 0.03,  // 0 for no text, fraction of canvas height\n    colorbarHeight: 0.05, // 0 for no colorbars, fraction of Nifti j dimension\n    crosshairWidth: 1, // 0 for no crosshairs\n    backColor: [0, 0, 0, 1],\n    crosshairColor: [1, 0, 0 ,1],\n    colorBarMargin: 0.05 // x axis margin arount color bar, clip space coordinates\n  }\n  this.gl = null\n  this.colormapTexture = null\n  this.volumeTexture = null\n  this.overlayTexture = null\n  this.sliceShader = null\n  this.lineShader = null\n  this.renderShader = null\n  this.colorbarShader = null\n  this.fontShader = null\n  this.passThroughShader = null\n  this.orientShaderU = null\n  this.orientShaderI = null\n  this.orientShaderF = null\n  this.fontMets = null\n\n  this.sliceTypeAxial = 0\n  this.sliceTypeCoronal = 1\n  this.sliceTypeSagittal = 2\n  this.sliceTypeMultiplanar = 3\n  this.sliceTypeRender = 4\n  this.sliceType = this.sliceTypeMultiplanar // sets current view in webgl canvas\n  this.scene = {}\n  this.scene.renderAzimuth = 120\n  this.scene.renderElevation = 15\n  this.scene.crosshairPos = [0.5, 0.5, 0.5]\n  this.scene.clipPlane = [0, 0, 0, 0]\n  this.back = {} // base layer; defines image space to work in. Defined as this.volumes[0] in Niivue.loadVolumes\n  this.overlays = [] // layers added on top of base image (e.g. masks or stat maps). Essentially everything after this.volumes[0] is an overlay. So is this necessary?\n  this.volumes = [] // all loaded images. Can add in the ability to push or slice as needed\n  this.backTexture = [];\n  this.isRadiologicalConvention = false\n  this.volScaleMultiplier = 1\n  this.mousePos = [0, 0]\n  this.numScreenSlices = 0 // e.g. for multiplanar view, 3 simultaneous slices: axial, coronal, sagittal\n  this.screenSlices = [ //location and type of each 2D slice on screen, allows clicking to detect position\n  {leftTopWidthHeight: [1, 0, 0, 1], axCorSag: this.sliceTypeAxial},\n  {leftTopWidthHeight: [1, 0, 0, 1], axCorSag: this.sliceTypeAxial},\n  {leftTopWidthHeight: [1, 0, 0, 1], axCorSag: this.sliceTypeAxial},\n  {leftTopWidthHeight: [1, 0, 0, 1], axCorSag: this.sliceTypeAxial}\n];\n  this.backOpacity = 1.0\n  // loop through known Niivue properties\n  // if the user supplied opts object has a\n  // property listed in the known properties, then set\n  // Niivue.opts.<prop> to that value, else apply defaults.\n  for (let prop in this.defaults) {\n    this.opts[prop] = (opts[prop] === undefined) ? this.defaults[prop] : opts[prop]\n  }\n}\n\n/**\n * test if two arrays have equal values for each element\n * @param {Array} a the first array\n * @param {Array} b the second array\n * @example Niivue.arrayEquals(a, b)\n */\nNiivue.prototype.arrayEquals = function(a, b) {\n  return Array.isArray(a) &&\n    Array.isArray(b) &&\n    a.length === b.length &&\n    a.every((val, index) => val === b[index]);\n}\n\n// update mouse position from new mouse down coordinates\nNiivue.prototype.mouseDown = function mouseDown(x, y) {\n  if (this.sliceType != this.sliceTypeRender) return;\n\tthis.mousePos = [x,y];\n} // mouseDown()\n\nNiivue.prototype.mouseMove = function mouseMove(x, y) {\n\tif (this.sliceType != this.sliceTypeRender) return;\n\tthis.scene.renderAzimuth += x - this.mousePos[0];\n\tthis.scene.renderElevation += y - this.mousePos[1];\n\tthis.mousePos = [x,y];\n\tthis.drawScene()\n} // mouseMove()\n\nNiivue.prototype.sph2cartDeg = function sph2cartDeg(azimuth, elevation) {\n//convert spherical AZIMUTH,ELEVATION,RANGE to Cartesion\n//see Matlab's [x,y,z] = sph2cart(THETA,PHI,R)\n// reverse with cart2sph\n let Phi = -elevation * (Math.PI/180);\n let Theta = ((azimuth-90) % 360) * (Math.PI/180);\n let ret = [Math.cos(Phi)* Math.cos(Theta), Math.cos(Phi) * Math.sin(Theta), Math.sin(Phi) ];\n let len = Math.sqrt(ret[0] * ret[0] + ret[1] * ret[1] + ret[2] * ret[2] );\n if (len <= 0.0) return ret;\n ret[0] /= len;\n ret[1] /= len;\n ret[2] /= len;\n return ret;\n} // sph2cartDeg()\n\nNiivue.prototype.clipPlaneUpdate = function (azimuthElevationDepth) {\n\t// azimuthElevationDepth is 3 component vector [a, e, d]\n\t//  azimuth: camera position in degrees around object, typically 0..360 (or -180..+180)\n\t//  elevation: camera height in degrees, range -90..90\n\t//  depth: distance of clip plane from center of volume, range 0..~1.73 (e.g. 2.0 for no clip plane)\n\tif (this.sliceType != this.sliceTypeRender) return;\n\tlet v = this.sph2cartDeg(azimuthElevationDepth[0], azimuthElevationDepth[1]);\n\tthis.scene.clipPlane = [v[0], v[1], v[2], azimuthElevationDepth[2]];\n\tthis.drawScene()\n} // clipPlaneUpdate()\n\nNiivue.prototype.setCrosshairColor = function (color) {\n  this.opts.crosshairColor = color\n  this.drawScene()\n} // setCrosshairColor()\n\nNiivue.prototype.sliceScroll2D = function (posChange, x, y, isDelta=true) {\n  this.mouseClick(x, y, posChange, isDelta);\n} // sliceScroll2D()\n\nNiivue.prototype.setSliceType = function(st) {\n  this.sliceType = st\n  this.drawScene()\n} // setSliceType()\n\nNiivue.prototype.setOpacity = function (volIdx, newOpacity) {\n  this.volumes[volIdx].opacity = newOpacity\n  if (volIdx === 0){ //background layer opacity set dynamically with shader\n    this.backOpacity = newOpacity\n    this.drawScene()\n    return\n  }\n  //all overlays are combined as a single texture, so changing opacity to one requires us to refresh textures\n  this.updateGLVolume()\n  //\n} // setOpacity()\n\nNiivue.prototype.setScale = function (scale) {\n  this.volScaleMultiplier = scale\n  this.drawScene()\n} // setScale()\n\n// attach the Niivue instance to the webgl2 canvas by element id\n// @example niivue = new Niivue().attachTo('#gl')\nNiivue.prototype.attachTo = function (id) {\n\tthis.gl = document.querySelector(id).getContext(\"webgl2\");\n\tif (!this.gl){\n    alert(\"unable to get webgl2 context. Perhaps this browser does not support webgl2\")\n    console.log(\"unable to get webgl2 context. Perhaps this browser does not support webgl2\")\n\n  }\n  this.init()\n  return this\n} // attachTo\n\nNiivue.prototype.overlayRGBA = function (volume) {\n\tlet hdr = volume.hdr;\n\tlet vox = hdr.dims[1] * hdr.dims[2] * hdr.dims[3];\n\tlet imgRGBA = new Uint8ClampedArray(vox * 4);\n\tlet radius = 0.2 * Math.min(Math.min(hdr.dims[1], hdr.dims[2]), hdr.dims[3]);\n\tlet halfX = 0.5 * hdr.dims[1];\n\tlet halfY = 0.5 * hdr.dims[2];\n\tlet halfZ = 0.5 * hdr.dims[3];\n\tlet j = 0;\n\tfor (let z = 0; z < hdr.dims[3]; z++) {\n\t\tfor (let y = 0; y < hdr.dims[2]; y++) {\n\t\t\tfor (let x = 0; x < hdr.dims[1]; x++) {\n\t\t\t\tlet dx = (Math.abs(x - halfX));\n\t\t\t\tlet dy = (Math.abs(y - halfY));\n\t\t\t\tlet dz = (Math.abs(z - halfZ));\n\t\t\t\tlet dist = Math.sqrt(dx*dx + dy*dy + dz * dz);\n\t\t\t\tlet v = 0;\n\t\t\t\tif (dist < radius) v = 255;\n\t\t\t\timgRGBA[j++] = 0; //Red\n\t\t\t\timgRGBA[j++] = v; //Green\n\t\t\t\timgRGBA[j++] = 0; //Blue\n\t\t\t\timgRGBA[j++] = v * 0.5; //Alpha\n\t\t\t}\n\t\t}\n\t}\n\treturn imgRGBA;\n} // overlayRGBA()\n\nNiivue.prototype.vox2mm = function (XYZ, mtx ) {\n\tlet sform = mat.mat4.clone(mtx);\n\tmat.mat4.transpose(sform, sform);\n\tlet pos = mat.vec4.fromValues(XYZ[0], XYZ[1], XYZ[2], 1);\n\tmat.vec4.transformMat4(pos, pos, sform);\n\tlet pos3 = mat.vec3.fromValues(pos[0], pos[1], pos[2]);\n\treturn pos3;\n} // vox2mm()\n\nNiivue.prototype.nii2RAS = function (overlayItem) {\n  //Transform to orient NIfTI image to Left->Right,Posterior->Anterior,Inferior->Superior (48 possible permutations)\n// port of Matlab reorient() https://github.com/xiangruili/dicm2nii/blob/master/nii_viewer.m\n// not elegant, as JavaScript arrays are always 1D\nlet hdr = overlayItem.volume.hdr;\n\tlet a = hdr.affine;\n\tlet absR = mat.mat3.fromValues(Math.abs(a[0][0]),Math.abs(a[0][1]),Math.abs(a[0][2]), Math.abs(a[1][0]),Math.abs(a[1][1]),Math.abs(a[1][2]), Math.abs(a[2][0]),Math.abs(a[2][1]),Math.abs(a[2][2]));\n\t//1st column = x\n\tlet ixyz = [1, 1, 1];\n    if (absR[3] > absR[0]) ixyz[0] = 2;//(absR[1][0] > absR[0][0]) ixyz[0] = 2;\n    if ((absR[6] > absR[0]) && (absR[6]> absR[3])) ixyz[0] = 3;//((absR[2][0] > absR[0][0]) && (absR[2][0]> absR[1][0])) ixyz[0] = 3;\n\t//2nd column = y\n\tixyz[1] = 1;\n    if (ixyz[0] === 1) {\n\t\tif (absR[4] > absR[7]) //(absR[1][1] > absR[2][1])\n\t\t\tixyz[1] = 2\n\t\telse\n\t\t\tixyz[1] = 3;\n\t} else if (ixyz[0] === 2) {\n       if  (absR[1] > absR[7])//(absR[0][1] > absR[2][1])\n          ixyz[1] = 1\n       else\n           ixyz[1] = 3;\n    } else {\n       if (absR[1] > absR[4])//(absR[0][1] > absR[1][1])\n          ixyz[1] = 1\n       else\n           ixyz[1] = 2;\n    }\n    //3rd column = z: constrained as x+y+z = 1+2+3 = 6\n    ixyz[2] = 6 - ixyz[1] - ixyz[0];\n\tlet perm = [1,2,3];\n    perm[ixyz[0]-1] = 1;\n    perm[ixyz[1]-1] = 2;\n    perm[ixyz[2]-1] = 3;\n\tlet rotM = mat.mat4.fromValues(a[0][0],a[0][1],a[0][2],a[0][3], a[1][0],a[1][1],a[1][2],a[1][3], a[2][0],a[2][1],a[2][2],a[2][3], 0,0,0,1);\n\t//n.b. 0.5 in these values to account for voxel centers, e.g. a 3-pixel wide bitmap in unit space has voxel centers at 0.25, 0.5 and 0.75\n\toverlayItem.mm000 = this.vox2mm([-0.5, -0.5, -0.5], rotM);\n\toverlayItem.mm100 = this.vox2mm([hdr.dims[1]-0.5, -0.5, -0.5], rotM);\n\toverlayItem.mm010 = this.vox2mm([-0.5, hdr.dims[2]-0.5, -0.5], rotM);\n\toverlayItem.mm001 = this.vox2mm([-0.5, -0.5, hdr.dims[3]-0.5], rotM);\n\tlet R = mat.mat4.create();\n\tmat.mat4.copy(R, rotM);\n\tfor (let i = 0; i < 3; i++)\n\t\tfor (let j = 0; j < 3; j++)\n\t\t\tR[(i*4)+j] =  rotM[(i*4)+perm[j]-1] ;//rotM[i+(4*(perm[j]-1))];//rotM[i],[perm[j]-1];\n\tlet flip = [0, 0, 0];\n    if (R[0] < 0) flip[0] = 1; //R[0][0]\n    if (R[5] < 0) flip[1] = 1; //R[1][1]\n    if (R[10] < 0) flip[2] = 1; //R[2][2]\n\toverlayItem.dimsRAS = [hdr.dims[0], hdr.dims[perm[0]], hdr.dims[perm[1]], hdr.dims[perm[2]]];\n\toverlayItem.pixDimsRAS = [hdr.pixDims[0], hdr.pixDims[perm[0]], hdr.pixDims[perm[1]], hdr.pixDims[perm[2]]];\n\tif (this.arrayEquals(perm, [1,2,3]) && this.arrayEquals(flip, [0,0,0])) {\n\t\toverlayItem.toRAS = mat.mat4.create(); //aka fromValues(1,0,0,0, 0,1,0,0, 0,0,1,0, 0,0,0,1);\n\t\toverlayItem.matRAS = mat.mat4.clone(rotM);\n\t\treturn; //no rotation required!\n\t}\n\tmat.mat4.identity(rotM);\n    rotM[0+(0 * 4)] = 1-flip[0]*2;\n    rotM[1+(1 * 4)] = 1-flip[1]*2;\n    rotM[2+(2 * 4)] = 1-flip[2]*2;\n    rotM[3+(0*4)] = ((hdr.dims[perm[0]])-1) * flip[0];\n    rotM[3+(1*4)] = ((hdr.dims[perm[1]])-1) * flip[1];\n\trotM[3+(2*4)] = ((hdr.dims[perm[2]])-1) * flip[2];\n\tlet residualR = mat.mat4.create();\n\tmat.mat4.invert(residualR, rotM);\n\tmat.mat4.multiply(residualR, residualR, R);\n\toverlayItem.matRAS = mat.mat4.clone(residualR);\n    rotM = mat.mat4.fromValues(0,0,0,0, 0,0,0,0, 0,0,0,0, 0,0,0,1);\n    rotM[perm[0]-1+(0*4)] = (-flip[0]*2)+1;\n    rotM[perm[1]-1+(1*4)] = (-flip[1]*2)+1;\n    rotM[perm[2]-1+(2*4)] = (-flip[2]*2)+1;\n\trotM[3+(0*4)] = flip[0];\n    rotM[3+(1*4)] = flip[1];\n\trotM[3+(2*4)] = flip[2];\n\toverlayItem.toRAS = mat.mat4.clone(rotM);\n} // nii2RAS()\n\n// currently: volumeList is an array if objects, each object is a volume that can be loaded\nNiivue.prototype.loadVolumes  = function(volumeList) {\n  this.volumes = volumeList\n  this.back = this.volumes[0] // load first volume as back layer\n  this.overlays = this.volumes.slice(1) // remove first element (that is now this.back, all other imgaes are overlays)\n  let xhr = []\n  let hdr = null\n  let img = null\n  // for loop to load all volumes in volumeList\n  for (let i=0; i<volumeList.length; i++){\n    console.log(\"loading \", volumeList[i].url)\n    let url = this.volumes[i].url\n    xhr.push(new XMLHttpRequest());\n    xhr[i].open(\"GET\", url, true);\n    xhr[i].responseType = \"arraybuffer\";\n    xhr[i].onerror = function () {\n      console.error(\"error loading volume \", this.volumes[i].url)\n      alert(\"error loading \" + this.volumes[i].url)\n    }\n    xhr[i].onload = function () {\n      let dataBuffer = xhr[i].response;\n      hdr = null\n      img = null\n      if (dataBuffer) {\n        hdr = nii.readHeader(dataBuffer);\n        if (nii.isCompressed(dataBuffer)) {\n          img = nii.readImage(hdr, nii.decompress(dataBuffer));\n        } else {\n          img = nii.readImage(hdr, dataBuffer);\n        }\n      } else {\n        alert(\"Unable to load buffer properly from volume?\");\n        console.log(\"no buffer?\");\n      }\n      this.volumes[i].volume = {}\n      this.volumes[i].volume.hdr = hdr\n      this.volumes[i].volume.img = img\n      this.volumes[i].opacity = 1;\n      this.nii2RAS(this.volumes[i])\n      //_overlayItem = overlayItem\n      this.selectColormap(this.volumes[0].colorMap) //only base image for now\n      this.updateGLVolume()\n    }.bind(this) // bind \"this\" niivue instance context\n    xhr[i].send();\n  } // for\n\t\treturn this\n} // loadVolume()\n\n\nNiivue.prototype.rgbaTex = function(texID, activeID, dims, isInit=false) {\n\tif (texID)\n\t\tthis.gl.deleteTexture(texID);\n\ttexID = this.gl.createTexture();\n\tthis.gl.activeTexture(activeID);\n\tthis.gl.bindTexture(this.gl.TEXTURE_3D, texID);\n\tthis.gl.texParameteri(this.gl.TEXTURE_3D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR);\n\tthis.gl.texParameteri(this.gl.TEXTURE_3D, this.gl.TEXTURE_MAG_FILTER, this.gl.LINEAR);\n\tthis.gl.texParameteri(this.gl.TEXTURE_3D, this.gl.TEXTURE_WRAP_R, this.gl.CLAMP_TO_EDGE);\n\tthis.gl.texParameteri(this.gl.TEXTURE_3D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\n\tthis.gl.texParameteri(this.gl.TEXTURE_3D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);\n\tthis.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT, 1)\n\tthis.gl.texStorage3D(this.gl.TEXTURE_3D, 1, this.gl.RGBA8, dims[1], dims[2], dims[3]); //output background dimensions\n\tif (isInit) {\n\t\tlet img8 = new Uint8Array(dims[1] * dims[2] * dims[3] * 4);\n\t\tthis.gl.texSubImage3D(this.gl.TEXTURE_3D, 0, 0, 0, 0, dims[1], dims[2], dims[3], this.gl.RGBA, this.gl.UNSIGNED_BYTE, img8);\n\t}\n\treturn texID;\n} // rgbaTex()\n\nNiivue.prototype.loadPng = function(pngName) {\n\tvar pngImage = null;\n\tpngImage = new Image();\n\tpngImage.onload = function() {\n\t\t//console.log(\"PNG resolution \", pngImage.width, \",\", pngImage.height);\n\t\tvar pngTexture = this.gl.createTexture();\n\t\tthis.gl.activeTexture(this.gl.TEXTURE3);\n\t\tthis.gl.bindTexture(this.gl.TEXTURE_2D, pngTexture);\n\t\t// Set the parameters so we can render any size image.\n\t\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\n\t\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);\n\t\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR);\n\t\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MAG_FILTER, this.gl.LINEAR);\n\t\t// Upload the image into the texture.\n\t\tthis.gl.texImage2D(this.gl.TEXTURE_2D, 0, this.gl.RGBA, this.gl.RGBA, this.gl.UNSIGNED_BYTE, pngImage);\n\t}.bind(this) // bind \"this\" context to niivue instance\n\tpngImage.src = pngName;  // MUST BE SAME DOMAIN!!!\n\t//console.log(\"loading PNG \", pngName);\n} // loadPng()\n\nNiivue.prototype.initText = async function () {\n\t//load bitmap\n\tawait this.loadPng('fnt.png');\n\t//create font metrics\n\tthis.fontMets = [];\n\tfor (let id = 0; id < 256; id++) { //clear ASCII codes 0..256\n\t\tthis.fontMets[id] = {};\n\t\tthis.fontMets[id].xadv = 0;\n\t\tthis.fontMets[id].uv_lbwh = [0, 0, 0, 0];\n\t\tthis.fontMets[id].lbwh = [0, 0, 0, 0];\n\t}\n\t//load metrics values: may only sparsely describe range 0..255\n\tvar metrics = [];\n\tasync function fetchMetrics() {\n\t\tconst response = await fetch('./fnt.json');\n\t\tmetrics = await response.json();\n\t}\n\tawait fetchMetrics();\n\tthis.fontMets.distanceRange = metrics.atlas.distanceRange;\n\tthis.fontMets.size = metrics.atlas.size;\n\tlet scaleW = metrics.atlas.width;\n\tlet scaleH = metrics.atlas.height;\n\tfor (let i = 0; i < metrics.glyphs.length; i++) {\n\t\tlet glyph = metrics.glyphs[i];\n\t\tlet id = glyph.unicode;\n\t\tthis.fontMets[id].xadv = glyph.advance;\n\t\tif (glyph.planeBounds  === undefined) continue;\n\t\tlet l = glyph.atlasBounds.left / scaleW;\n\t\tlet b = ((scaleH - glyph.atlasBounds.top) / scaleH);\n\t\tlet w = (glyph.atlasBounds.right - glyph.atlasBounds.left) / scaleW;\n\t\tlet h = (glyph.atlasBounds.top - glyph.atlasBounds.bottom) / scaleH;\n\t\tthis.fontMets[id].uv_lbwh = [l, b, w, h];\n\t\tl = glyph.planeBounds.left;\n\t\tb = glyph.planeBounds.bottom;\n\t\tw = glyph.planeBounds.right - glyph.planeBounds.left;\n\t\th = glyph.planeBounds.top - glyph.planeBounds.bottom;\n\t\tthis.fontMets[id].lbwh = [l, b, w, h];\n\t}\n} // initText()\n\nNiivue.prototype.init = async function () {\n\t//initial setup: only at the startup of the component\n  // print debug info (gpu vendor and renderer)\n  let debugInfo = this.gl.getExtension('WEBGL_debug_renderer_info');\n  let vendor = this.gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL);\n  let renderer = this.gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);\n  console.log(\"gpu vendor: \", vendor)\n  console.log(\"gpu renderer: \", renderer)\n  this.gl.enable(this.gl.CULL_FACE);\n  this.gl.cullFace(this.gl.FRONT);\n  this.gl.enable(this.gl.BLEND);\n  this.gl.blendFunc(this.gl.SRC_ALPHA, this.gl.ONE_MINUS_SRC_ALPHA);\n\n  // register volume and overlay textures\n  this.rgbaTex(this.volumeTexture, this.gl.TEXTURE0, [2,2,2,2], true);\n  this.rgbaTex(this.overlayTexture, this.gl.TEXTURE2, [2,2,2,2], true);\n\n  let cubeStrip = [0, 1, 0, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 0, 0, 1, 0, 0];\n\tlet vao = this.gl.createVertexArray();\n\tthis.gl.bindVertexArray(vao);\n\tlet vbo = this.gl.createBuffer();\n\tthis.gl.bindBuffer(this.gl.ARRAY_BUFFER, vbo);\n\tthis.gl.bufferData(this.gl.ARRAY_BUFFER, new Float32Array(cubeStrip), this.gl.STATIC_DRAW);\n\tthis.gl.enableVertexAttribArray(0);\n\tthis.gl.vertexAttribPointer(0, 3, this.gl.FLOAT, false, 0, 0);\n\n  // slice shader\n\tthis.sliceShader = new Shader(this.gl, vertSliceShader, fragSliceShader);\n\tthis.sliceShader.use(this.gl);\n\tthis.gl.uniform1i(this.sliceShader.uniforms[\"volume\"], 0);\n\tthis.gl.uniform1i(this.sliceShader.uniforms[\"colormap\"], 1);\n\tthis.gl.uniform1i(this.sliceShader.uniforms[\"overlay\"], 2);\n\n  // line shader (crosshair)\n\tthis.lineShader = new Shader(this.gl, vertLineShader, fragLineShader);\n\n  // render shader (3D)\n\tthis.renderShader = new Shader(this.gl, vertRenderShader, fragRenderShader);\n\tthis.renderShader.use(this.gl);\n\tthis.gl.uniform1i(this.renderShader.uniforms[\"volume\"], 0);\n\tthis.gl.uniform1i(this.renderShader.uniforms[\"colormap\"], 1);\n\tthis.gl.uniform1i(this.renderShader.uniforms[\"overlay\"], 2);\n\n  // colorbar shader\n\tthis.colorbarShader = new Shader(this.gl, vertColorbarShader, fragColorbarShader);\n\tthis.colorbarShader.use(this.gl);\n\tthis.gl.uniform1i(this.colorbarShader.uniforms[\"colormap\"], 1);\n\n  // font shader\n\t//multi-channel signed distance font https://github.com/Chlumsky/msdfgen\n\tthis.fontShader = new Shader(this.gl, vertFontShader, fragFontShader);\n\tthis.fontShader.use(this.gl);\n\tthis.gl.uniform1i(this.fontShader.uniforms[\"fontTexture\"], 3);\n\n  // orientation shaders\n  this.passThroughShader  = new Shader(this.gl, vertOrientShader, fragPassThroughShader);\n  \n  //this.passThroughShader  = new Shader(this.gl, vertOrientShader,fragPassThroughShader);\n  this.orientShaderU = new Shader(this.gl, vertOrientShader, fragOrientShaderU.concat(fragOrientShader));\n  this.orientShaderI = new Shader(this.gl, vertOrientShader, fragOrientShaderI.concat(fragOrientShader));\n  this.orientShaderF = new Shader(this.gl, vertOrientShader, fragOrientShaderF.concat(fragOrientShader));\n  await this.initText();\n  return this\n} // init()\n\nNiivue.prototype.updateGLVolume = function() { //load volume or change contrast\n  let visibleLayers = 0;\n  // loop through loading volumes in this.volume\n  for (let i=0; i<this.volumes.length; i++){\n    // avoid trying to refresh a volume that isn't ready\n    if(!this.volumes[i].toRAS) {\n      continue;\n    }\n    this.refreshLayers(this.volumes[i], visibleLayers);\n    visibleLayers++;\n  }\n\tthis.drawScene();\n} // updateVolume()\n\nfunction intensityRaw2Scaled(hdr, raw) {\n  if (hdr.scl_slope === 0) hdr.scl_slope = 1.0;\n  return (raw * hdr.scl_slope) + hdr.scl_inter\n}\n\n// given an overlayItem and its img TypedArray, calculate 2% and 98% display range if needed\n//clone FSL robust_range estimates https://github.com/rordenlab/niimath/blob/331758459140db59290a794350d0ff3ad4c37b67/src/core32.c#L1215\n//ToDo: convert to web assembly, this is slow in JavaScript\nNiivue.prototype.calMinMaxCore = function(overlayItem, img, percentileFrac=0.02, ignoreZeroVoxels = false){\n  let imgRaw\n  let hdr = overlayItem.volume.hdr\n  if (hdr.datatypeCode === 2)\n    imgRaw = new Uint8Array(img)\n  else if (hdr.datatypeCode === 4)\n    imgRaw = new Int16Array(img)\n  else if (hdr.datatypeCode === 16)\n    imgRaw = new Float32Array(img)\n  else if (hdr.datatypeCode === 64)\n    imgRaw = new Float64Array(img)\n  else if (hdr.datatypeCode === 512)\n    imgRaw = new Uint16Array(img)\n  //determine full range: min..max\n  let mn=img[0]\n  let mx=img[0]\n  let nZero = 0\n  let nNan = 0\n  let nVox = imgRaw.length\n  for (let i=0; i < nVox; i++){\n    if (isNaN(imgRaw[i])) {\n      nNan++\n      continue\n    }\n    if (imgRaw[i] === 0) {\n      nZero++\n      continue\n    }\n    mn = Math.min(imgRaw[i],mn)\n    mx = Math.max(imgRaw[i],mx)\n  }\n  var mnScale = intensityRaw2Scaled(hdr, mn)\n  var mxScale = intensityRaw2Scaled(hdr, mx)\n  if (!ignoreZeroVoxels)\n    nZero = 0\n  nZero += nNan\n  let n2pct = Math.round((nVox - nZero) * percentileFrac)\n  if ((n2pct < 1) || (mn === mx)) {\n    console.log(\"no variability in image intensity?\")\n\treturn [ mnScale, mxScale, mnScale, mxScale ]\n  }\n  let nBins = 1001\n  let scl = (nBins-1)/(mx-mn)\n  let hist = new Array(nBins)\n  for (let i = 0; i < nBins; i++)\n    hist[i] = 0\n  if (ignoreZeroVoxels) {\n    for (let i = 0; i <= nVox; i++) {\n      if (imgRaw[i] === 0)\n        continue\n      if (isNaN(imgRaw[i]))\n        continue\n      hist[ (imgRaw[i]-mn) * scl] ++\n    }\n  } else {\n    for (let i = 0; i <= nVox; i++) {\n      if (isNaN(imgRaw[i]))\n        continue\n      hist[ (imgRaw[i]-mn) * scl] ++\n    }\n  }\n  let n = 0\n  let lo = 0\n  while (n < n2pct) {\n    n += hist[lo]\n    lo++\n  }\n  lo -- //remove final increment\n  n = 0\n  let hi = nBins\n  while (n < n2pct) {\n    hi--\n    n += hist[hi]\n  }\n  if (lo == hi) { //MAJORITY are not black or white\n    let ok = -1\n    while (ok !== 0) {\n      if (lo > 0) {\n        lo--\n        if (hist[lo] > 0) ok = 0\n      }\n      if ((ok != 0) && (hi < (nBins-1))) {\n        hi++\n        if (hist[hi] > 0) ok = 0\n      }\n      if ((lo == 0) && (hi == (nBins-1))) ok = 0\n    } //while not ok\n  } //if lo == hi\n  var pct2 = intensityRaw2Scaled(hdr, (lo)/scl + mn)\n  var pct98 = intensityRaw2Scaled(hdr, (hi)/scl + mn)\n  console.log(\"full range %f..%f  (voxels 0 or NaN = %i) robust range %f..%f\", mnScale, mxScale, nZero, pct2, pct98)\n  if ((overlayItem.volume.hdr.cal_min < overlayItem.volume.hdr.cal_max) && (overlayItem.volume.hdr.cal_min >= mnScale) && (overlayItem.volume.hdr.cal_max <= mxScale)){\n    console.log(\"ignoring robust range: using header cal_min and cal_max\")\n    pct2 = overlayItem.volume.hdr.cal_min;\n    pct98 = overlayItem.volume.hdr.cal_max;\n  }\n  return [ pct2, pct98, mnScale, mxScale ]\n} //sliceScale\n\nNiivue.prototype.calMinMax = function(overlayItem, img, percentileFrac=0.02, ignoreZeroVoxels = false){\n\tlet minMax = this.calMinMaxCore(overlayItem, img, percentileFrac, ignoreZeroVoxels)\n\tconsole.log(\"cal_min, cal_max, global_min, global_max\", minMax[0], minMax[1], minMax[2], minMax[3])\n\toverlayItem.cal_min = minMax[0]\n\toverlayItem.cal_max = minMax[1]\n\toverlayItem.global_min = minMax[2]\n\toverlayItem.global_max = minMax[3]\n} // calMinMax()\n\nNiivue.prototype.refreshLayers = function(overlayItem, layer) {\n\tlet hdr = overlayItem.volume.hdr\n\tlet img = overlayItem.volume.img\n\tlet opacity = overlayItem.opacity\n\tlet imgRaw\n\tlet outTexture = null;\n\tlet mtx = [];\n\tif (layer === 0) {\n\t\tthis.back = {};\n\t\tmtx = overlayItem.toRAS;\n\t\topacity = 1.0;\n\t\tthis.back.matRAS = overlayItem.matRAS;\n\t\tthis.back.dims = overlayItem.dimsRAS;\n\t\tthis.back.pixDims = overlayItem.pixDimsRAS;\n\t\toutTexture = this.rgbaTex(this.volumeTexture, this.gl.TEXTURE0, overlayItem.dimsRAS); //this.back.dims)\n\t} else {\n\t\tif (this.back.dims === undefined)\n\t\t\tconsole.log('Fatal error: Unable to render overlay: background dimensions not defined!');\n\t\tlet f000 = this.mm2frac(overlayItem.mm000); //origin in output space\n\t\tlet f100 = this.mm2frac(overlayItem.mm100);\n\t\tlet f010 = this.mm2frac(overlayItem.mm010);\n\t\tlet f001 = this.mm2frac(overlayItem.mm001);\n\t\tf100 = mat.vec3.subtract(f100, f100, f000); // direction of i dimension from origin\n\t\tf010 = mat.vec3.subtract(f010, f010, f000); // direction of j dimension from origin\n\t\tf001 = mat.vec3.subtract(f001, f001, f000); // direction of k dimension from origin\n\n\t\tmtx = mat.mat4.fromValues(\n\t\t\tf100[0],f100[1],f100[2],f000[0],\n\t\t\tf010[0],f010[1],f010[2],f000[1],\n\t\t\tf001[0],f001[1],f001[2],f000[2],\n\t\t\t0,0,0,1);\n\t\tmat.mat4.invert(mtx, mtx);\n\t\t//console.log('v2', mtx);\n\t\tif (layer === 1) {\n\t\t\toutTexture = this.rgbaTex(this.overlayTexture, this.gl.TEXTURE2, this.back.dims);\n\t\t\tthis.backTexture = outTexture;\n\t\t} else\n\t\t\toutTexture = this.backTexture;\n\t}\n\tlet fb = this.gl.createFramebuffer();\n\tthis.gl.bindFramebuffer(this.gl.FRAMEBUFFER, fb);\n\tthis.gl.disable(this.gl.CULL_FACE);\n\tthis.gl.viewport(0, 0, this.back.dims[1], this.back.dims[2]); //output in background dimensions\n\tthis.gl.disable(this.gl.BLEND);\n\tlet tempTex3D = this.gl.createTexture();\n\tthis.gl.activeTexture(this.gl.TEXTURE6); //Temporary 3D Texture\n\tthis.gl.bindTexture(this.gl.TEXTURE_3D, tempTex3D);\n\tthis.gl.texParameteri(this.gl.TEXTURE_3D, this.gl.TEXTURE_MIN_FILTER, this.gl.NEAREST);\n\tthis.gl.texParameteri(this.gl.TEXTURE_3D, this.gl.TEXTURE_MAG_FILTER, this.gl.NEAREST);\n\tthis.gl.texParameteri(this.gl.TEXTURE_3D, this.gl.TEXTURE_WRAP_R, this.gl.CLAMP_TO_EDGE);\n\tthis.gl.texParameteri(this.gl.TEXTURE_3D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\n\tthis.gl.texParameteri(this.gl.TEXTURE_3D, this.gl.TEXTURE_WRAP_T, this.gl.CLAMP_TO_EDGE);\n\tthis.gl.pixelStorei( this.gl.UNPACK_ALIGNMENT, 1 )\n\t//https://webgl2fundamentals.org/webgl/lessons/webgl-data-textures.html\n\t//https://www.khronos.org/registry/OpenGL-Refpages/es3.0/html/glTexStorage3D.xhtml\n\tlet orientShader = this.orientShaderU;\n\tif (hdr.datatypeCode === 2) { // raw input data\n\t\timgRaw = new Uint8Array(img);\n\t\tthis.gl.texStorage3D(this.gl.TEXTURE_3D, 6, this.gl.R8UI, hdr.dims[1], hdr.dims[2], hdr.dims[3]);\n\t\tthis.gl.texSubImage3D(this.gl.TEXTURE_3D, 0, 0, 0, 0, hdr.dims[1], hdr.dims[2], hdr.dims[3], this.gl.RED_INTEGER, this.gl.UNSIGNED_BYTE, imgRaw);\n\t} else if (hdr.datatypeCode === 4) {\n\t\timgRaw = new Int16Array(img);\n\t\tthis.gl.texStorage3D(this.gl.TEXTURE_3D, 6, this.gl.R16I, hdr.dims[1], hdr.dims[2], hdr.dims[3]);\n\t\tthis.gl.texSubImage3D(this.gl.TEXTURE_3D, 0, 0, 0, 0, hdr.dims[1], hdr.dims[2], hdr.dims[3], this.gl.RED_INTEGER, this.gl.SHORT, imgRaw);\n\t\torientShader = this.orientShaderI;\n\t} else if (hdr.datatypeCode === 16) {\n\t\timgRaw = new Float32Array(img);\n\t\tthis.gl.texStorage3D(this.gl.TEXTURE_3D, 6, this.gl.R32F, hdr.dims[1], hdr.dims[2], hdr.dims[3]);\n\t\tthis.gl.texSubImage3D(this.gl.TEXTURE_3D, 0, 0, 0, 0, hdr.dims[1], hdr.dims[2], hdr.dims[3], this.gl.RED, this.gl.FLOAT, imgRaw);\n\t\torientShader = this.orientShaderF;\n\t} else if (hdr.datatypeCode === 64) {\n\t\timgRaw = new Float64Array(img)\n\t\tlet img32f = new Float32Array;\n\t\timg32f = Float32Array.from(imgRaw);\n\t\tthis.gl.texStorage3D(this.gl.TEXTURE_3D, 6, this.gl.R32F, hdr.dims[1], hdr.dims[2], hdr.dims[3]);\n\t\tthis.gl.texSubImage3D(this.gl.TEXTURE_3D, 0, 0, 0, 0, hdr.dims[1], hdr.dims[2], hdr.dims[3], this.gl.RED, this.gl.FLOAT, img32f);\n\t\torientShader = this.orientShaderF;\n\t} else if (hdr.datatypeCode === 512) {\n\t\timgRaw = new Uint16Array(img);\n\t\tthis.gl.texStorage3D(this.gl.TEXTURE_3D, 6, this.gl.R16UI, hdr.dims[1], hdr.dims[2], hdr.dims[3]);\n\t\tthis.gl.texSubImage3D(this.gl.TEXTURE_3D, 0, 0, 0, 0, hdr.dims[1], hdr.dims[2], hdr.dims[3], this.gl.RED_INTEGER, this.gl.UNSIGNED_SHORT, imgRaw);\n\t}\n\tif (overlayItem.global_min === undefined) //only once, first time volume is loaded\n\t\tthis.calMinMax(overlayItem, imgRaw)\n\t//pass through shader setup\n\tlet tempTex2D = this.gl.createTexture()\n\tthis.gl.activeTexture(this.gl.TEXTURE7) //Temporary 2D Texture\n\tthis.gl.bindTexture(this.gl.TEXTURE_2D, tempTex2D)\n\tthis.gl.texStorage2D(this.gl.TEXTURE_2D, 1, this.gl.RGBA8,  hdr.dims[1], hdr.dims[2])\n\tthis.gl.texParameteri(this.gl.TEXTURE_3D, this.gl.TEXTURE_MIN_FILTER, this.gl.NEAREST)\n\tthis.gl.texParameteri(this.gl.TEXTURE_3D, this.gl.TEXTURE_MAG_FILTER, this.gl.NEAREST)\n\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_R, this.gl.CLAMP_TO_EDGE)\n\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE)\n\t//this.gl.texSubImage2D(this.gl.TEXTURE_2D, 0, 0, 0, 256, 1, this.gl.RGBA, this.gl.UNSIGNED_BYTE, lut);\n\tthis.gl.pixelStorei( this.gl.UNPACK_ALIGNMENT, 1 )\n\tlet passShader = this.passThroughShader\n\tpassShader.use(this.gl)\n\tthis.gl.uniform1i(passShader.uniforms[\"in3D\"], 2) //overlay volume\n\t//let img2D = new Uint8ClampedArray(hdr.dims[1] * hdr.dims[2] * 4);\n\t//console.log(img2D[0])\n\t//this.gl.texSubImage2D(this.gl.TEXTURE_2D, 0, 0, 0, hdr.dims[1], hdr.dims[2], this.gl.RGBA, this.gl.UNSIGNED_BYTE, img2D);\n\n\t\n\torientShader.use(this.gl);\n\n\tthis.selectColormap(overlayItem.colorMap)\n\tthis.gl.uniform1f(orientShader.uniforms[\"cal_min\"], overlayItem.cal_min);\n\tthis.gl.uniform1f(orientShader.uniforms[\"cal_max\"], overlayItem.cal_max);\n\tthis.gl.bindTexture(this.gl.TEXTURE_3D, tempTex3D);\n\tthis.gl.uniform1i(orientShader.uniforms[\"intensityVol\"], 6);\n\tthis.gl.uniform1i(orientShader.uniforms[\"in2D\"], 7);\n\t\n\tthis.gl.uniform1i(orientShader.uniforms[\"colormap\"], 1);\n\tthis.gl.uniform1f(orientShader.uniforms[\"layer\"], layer);\n\tthis.gl.uniform1f(orientShader.uniforms[\"scl_inter\"], hdr.scl_inter);\n\tthis.gl.uniform1f(orientShader.uniforms[\"scl_slope\"],hdr.scl_slope);\n\tthis.gl.uniform1f(orientShader.uniforms[\"opacity\"], opacity);\n\tthis.gl.uniformMatrix4fv(orientShader.uniforms[\"mtx\"], false, mtx)\n\tfor (let i = 0; i < (this.back.dims[3]); i++) { //output slices\n\t\t//if ((layer > 1) && (((i+layer) % 2) === 0)) continue;\n\t\tvar coordZ = 1/this.back.dims[3] * (i + 0.5);\n\t\tif (layer > 1) { //use pass-through shader to copy previous color to temporary 2D texture\n\t\t\tpassShader.use(this.gl)\n\t\t\tthis.gl.uniform1f(passShader.uniforms[\"coordZ\"], coordZ)\n\t\t\tthis.gl.framebufferTexture2D(this.gl.FRAMEBUFFER, this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D, tempTex2D, 0)\n\t\t\tthis.gl.drawArrays(this.gl.TRIANGLE_STRIP, 5, 4);\n\t\t\torientShader.use(this.gl);\n\t\t}\n\t\tthis.gl.uniform1f(orientShader.uniforms[\"coordZ\"], coordZ);\n\t\tthis.gl.framebufferTextureLayer(this.gl.FRAMEBUFFER, this.gl.COLOR_ATTACHMENT0, outTexture, 0, i);\n\t\tif (layer <= 1) //layer 0 (background) and leyer 1 (1st overlay) only!\n\t\t\tthis.gl.clear(this.gl.DEPTH_BUFFER_BIT); //only for background and first overlay!\n\t\tthis.gl.drawArrays(this.gl.TRIANGLE_STRIP, 5, 4);\n\t}\n\tthis.gl.deleteTexture(tempTex3D);\n\tthis.gl.deleteTexture(tempTex2D);\n\tthis.gl.viewport(0, 0, this.gl.canvas.width, this.gl.canvas.height);\n\tthis.gl.deleteFramebuffer(fb);\n} // refreshLayers()\n\nNiivue.prototype.selectColormap = function(lutName = \"\") {\n\tvar lut = this.makeLut([0, 255], [0, 255], [0, 255], [0, 128], [0, 255]); //gray\n\tif (lutName === \"Winter\")\n\t\tlut = this.makeLut([0, 0, 0], [0, 128, 255], [255, 196, 128], [0, 64, 128], [0, 128, 255]); //winter\n\tif (lutName === \"Warm\")\n\t\tlut = this.makeLut([255, 255, 255], [127, 196, 254], [0, 0, 0], [0, 64, 128], [0, 128, 255]); //warm\n\tif (lutName === \"Plasma\")\n\t\tlut = this.makeLut([13, 156, 237, 240], [8, 23, 121, 249], [135, 158, 83, 33], [0, 56, 80, 88], [0, 64, 192, 255]); //plasma\n\tif (lutName === \"Viridis\")\n\t\tlut = this.makeLut([68, 49, 53, 253], [1, 104, 183, 231], [84, 142, 121, 37], [0, 56, 80, 88], [0, 65, 192, 255]);//viridis\n\tif (lutName === \"Inferno\")\n\t\tlut = this.makeLut([0, 120, 237, 240], [0, 28, 105, 249], [4, 109, 37, 33], [0, 56, 80, 88], [0, 64, 192, 255]);//inferno\n\tif (this.colormapTexture !== null)\n\t\tthis.gl.deleteTexture(this.colormapTexture);\n\tthis.colormapTexture = this.gl.createTexture();\n\tthis.gl.activeTexture(this.gl.TEXTURE1);\n\tthis.gl.bindTexture(this.gl.TEXTURE_2D, this.colormapTexture);\n\tthis.gl.texStorage2D(this.gl.TEXTURE_2D, 1, this.gl.RGBA8, 256, 1);\n\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_MIN_FILTER, this.gl.LINEAR);\n\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_R, this.gl.CLAMP_TO_EDGE);\n\tthis.gl.texParameteri(this.gl.TEXTURE_2D, this.gl.TEXTURE_WRAP_S, this.gl.CLAMP_TO_EDGE);\n\tthis.gl.pixelStorei( this.gl.UNPACK_ALIGNMENT, 1 )\n\tthis.gl.texSubImage2D(this.gl.TEXTURE_2D, 0, 0, 0, 256, 1, this.gl.RGBA, this.gl.UNSIGNED_BYTE, lut);\n  return this\n} // selectColormap()\n\nNiivue.prototype.makeLut = function(Rs, Gs, Bs, As, Is) {\n\t//create color lookup table provided arrays of reds, greens, blues, alphas and intensity indices\n\t//intensity indices should be in increasing order with the first value 0 and the last 255.\n\t// this.makeLut([0, 255], [0, 0], [0,0], [0,128],[0,255]); //red gradient\n\tvar lut = new Uint8ClampedArray(256 * 4);\n\tfor (var i = 0; i < (Is.length - 1); i++) {\n\t\t//return a + f * (b - a);\n\t\tvar idxLo = Is[i];\n\t\tvar idxHi = Is[i + 1];\n\t\tvar idxRng = idxHi - idxLo;\n\t\tvar k = idxLo * 4;\n\t\tfor (var j = idxLo; j <= idxHi; j++) {\n\t\t\tvar f = (j - idxLo) / idxRng;\n      lut[k++] = Rs[i] + f * (Rs[i + 1] - Rs[i]); //Red\n\t\t\tlut[k++] = Gs[i] + f * (Gs[i + 1] - Gs[i]); //Green\n\t\t\tlut[k++] = Bs[i] + f * (Bs[i + 1] - Bs[i]); //Blue\n\t\t\tlut[k++] = As[i] + f * (As[i + 1] - As[i]); //Alpha\n\t\t}\n\t}\n\treturn lut;\n} // makeLut()\n\nNiivue.prototype.sliceScale = function() {\n  var dims = [1.0, this.back.dims[1] * this.back.pixDims[1], this.back.dims[2] * this.back.pixDims[2], this.back.dims[3] * this.back.pixDims[3]];\n\tvar longestAxis = Math.max(dims[1], Math.max(dims[2], dims[3]));\n\tvar volScale = [dims[1] / longestAxis, dims[2] / longestAxis, dims[3] / longestAxis];\n\tvar vox = [this.back.dims[1], this.back.dims[2], this.back.dims[3]];\n\treturn { volScale, vox }\n} // sliceScale()\n\nNiivue.prototype.mouseClick = function(x, y, posChange=0, isDelta=true) {\n  var posNow\n\tvar posFuture\n  if (this.sliceType === this.sliceTypeRender) {\n    if (posChange === 0) return;\n    if (posChange > 0) this.volScaleMultiplier = Math.min(2.0, this.volScaleMultiplier *  1.1)\n    if (posChange < 0) this.volScaleMultiplier = Math.max(0.5, this.volScaleMultiplier *  0.9)\n    this.drawScene()\n    return\n  }\n\tif ((this.numScreenSlices < 1) || (this.gl.canvas.height < 1) || (this.gl.canvas.width < 1))\n\t\treturn;\n\t//mouse click X,Y in screen coordinates, origin at top left\n\t// webGL clip space L,R,T,B = [-1, 1, 1, 1]\n\t// n.b. webGL Y polarity reversed\n\t// https://webglfundamentals.org/webgl/lessons/webgl-fundamentals.html\n\tfor (let i = 0; i < this.numScreenSlices; i++) {\n\t\tvar axCorSag = this.screenSlices[i].axCorSag;\n\t\tif (axCorSag > this.sliceTypeSagittal) continue;\n\t\tvar ltwh = this.screenSlices[i].leftTopWidthHeight;\n\t\tlet isMirror = false;\n\t\tif (ltwh[2] < 0) {\n\t\t\tisMirror = true;\n\t\t\tltwh[0] += ltwh[2];\n\t\t\tltwh[2] = - ltwh[2];\n\t\t}\n\t\tvar fracX = (x - ltwh[0]) / ltwh[2];\n\t\tif (isMirror) fracX = 1.0 - fracX;\n\t\tvar fracY = 1.0 - ((y - ltwh[1]) / ltwh[3]);\n\t\tif ((fracX >= 0.0) && (fracX < 1.0) && (fracY >= 0.0) && (fracY < 1.0)) { //user clicked on slice i\n\t\t\tif ( !isDelta ) {\n\t\t\t\tthis.scene.crosshairPos[2 - axCorSag] = posChange;\n\t\t\t\tthis.drawScene();\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif ( posChange !== 0) {\n\t\t\t\tposNow = this.scene.crosshairPos[2 - axCorSag]\n\t\t\t\tposFuture = posNow + posChange\n\t\t\t\tif (posFuture > 1) posFuture = 1;\n\t\t\t\tif (posFuture < 0) posFuture = 0;\n\t\t\t\t//console.log(scrollVal,':',axCorSag, '>>', posFuture);\n\t\t\t\tthis.scene.crosshairPos[2 - axCorSag] = posFuture;\n\t\t\t\tthis.drawScene()\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (axCorSag === this.sliceTypeAxial) {\n\t\t\t\tthis.scene.crosshairPos[0] = fracX;\n\t\t\t\tthis.scene.crosshairPos[1] = fracY;\n\t\t\t}\n\t\t\tif (axCorSag === this.sliceTypeCoronal) {\n\t\t\t\tthis.scene.crosshairPos[0] = fracX;\n\t\t\t\tthis.scene.crosshairPos[2] = fracY;\n\t\t\t}\n\t\t\tif (axCorSag === this.sliceTypeSagittal) {\n\t\t\t\tthis.scene.crosshairPos[1] = fracX;\n\t\t\t\tthis.scene.crosshairPos[2] = fracY;\n\t\t\t}\n\t\t\tthis.drawScene()\n\t\t\treturn;\n\t\t} else {//if click in slice i\n      // if x and y are null, likely due to a slider widget sending the posChange (no mouse info in that case)\n      if (x === null && y === null){\n        this.scene.crosshairPos[2-axCorSag] = posChange\n        this.drawScene()\n        return\n      }\n    }\n  } //for i: each slice on screen\n} // mouseClick()\n\nNiivue.prototype.drawColorbar = function(leftTopWidthHeight) {\n\tif ((leftTopWidthHeight[2] <= 0) || (leftTopWidthHeight[3] <= 0))\n\t\treturn;\n\t//console.log(\"bar:\", leftTopWidthHeight[0], leftTopWidthHeight[1], leftTopWidthHeight[2], leftTopWidthHeight[3]);\n\tif (this.opts.crosshairWidth > 0) {\n\t\t//gl.disable(gl.DEPTH_TEST);\n\t\tthis.lineShader.use(this.gl)\n\t\tthis.gl.uniform4fv(this.lineShader.uniforms[\"lineColor\"], this.opts.crosshairColor);\n\t\tthis.gl.uniform2fv(this.lineShader.uniforms[\"canvasWidthHeight\"], [this.gl.canvas.width, this.gl.canvas.height]);\n\t\tlet ltwh = [leftTopWidthHeight[0]-1, leftTopWidthHeight[1]-1, leftTopWidthHeight[2]+2, leftTopWidthHeight[3]+2];\n\t\tthis.gl.uniform4f(this.lineShader.uniforms[\"leftTopWidthHeight\"], ltwh[0], ltwh[1], ltwh[2], ltwh[3]);\n\t\tthis.gl.drawArrays(this.gl.TRIANGLE_STRIP, 5, 4);\n\t}\n\tthis.colorbarShader.use(this.gl);\n\tthis.gl.uniform2fv(this.colorbarShader.uniforms[\"canvasWidthHeight\"], [this.gl.canvas.width, this.gl.canvas.height]);\n\tthis.gl.uniform4f(this.colorbarShader.uniforms[\"leftTopWidthHeight\"], leftTopWidthHeight[0], leftTopWidthHeight[1], leftTopWidthHeight[2], leftTopWidthHeight[3]);\n\tthis.gl.drawArrays(this.gl.TRIANGLE_STRIP, 5, 4);\n\t//gl.enable(gl.DEPTH_TEST);\n} // drawColorbar()\n\nNiivue.prototype.textWidth = function(scale, str) {\n\tlet w = 0;\n\tvar bytes = new Buffer(str);\n\tfor (let i = 0; i < str.length; i++)\n\t\tw += scale * this.fontMets[bytes[i]].xadv;\n\treturn w;\n} // textWidth()\n\nNiivue.prototype.drawChar = function(xy, scale, char) { //draw single character, never call directly: ALWAYS call from drawText()\n\tlet metrics = this.fontMets[char];\n\tlet l = xy[0] + (scale * metrics.lbwh[0]);\n\tlet b = -(scale * metrics.lbwh[1]);\n\tlet w = (scale * metrics.lbwh[2]);\n\tlet h = (scale * metrics.lbwh[3]);\n\tlet t = xy[1] + (b - h) + scale;\n\tthis.gl.uniform4f(this.fontShader.uniforms[\"leftTopWidthHeight\"], l, t, w, h);\n\tthis.gl.uniform4fv(this.fontShader.uniforms[\"uvLeftTopWidthHeight\"], metrics.uv_lbwh);\n\tthis.gl.drawArrays(this.gl.TRIANGLE_STRIP, 5, 4);\n\treturn scale * metrics.xadv;\n} // drawChar()\n\nNiivue.prototype.drawText = function(xy, str) { //to right of x, vertically centered on y\n\tif (this.opts.textHeight <= 0) return;\n\tthis.fontShader.use(this.gl);\n\tlet scale = (this.opts.textHeight * this.gl.canvas.height);\n\tthis.gl.enable(this.gl.BLEND)\n\tthis.gl.uniform2f(this.fontShader.uniforms[\"canvasWidthHeight\"], this.gl.canvas.width, this.gl.canvas.height);\n\tthis.gl.uniform4fv(this.fontShader.uniforms[\"fontColor\"], this.opts.crosshairColor);\n\tlet screenPxRange = scale / this.fontMets.size * this.fontMets.distanceRange;\n\tscreenPxRange = Math.max(screenPxRange, 1.0) //screenPxRange() must never be lower than 1\n\tthis.gl.uniform1f(this.fontShader.uniforms[\"screenPxRange\"], screenPxRange);\n\tvar bytes = new Buffer(str);\n\tfor (let i = 0; i < str.length; i++)\n\t\txy[0] += this.drawChar(xy, scale, bytes[i]);\n} // drawText()\n\nNiivue.prototype.drawTextRight = function(xy, str) { //to right of x, vertically centered on y\n\tif (this.opts.textHeight <= 0) return;\n\tthis.fontShader.use(this.gl)\n\txy[1] -= (0.5 * this.opts.textHeight * this.gl.canvas.height);\n\tthis.drawText(xy, str)\n} // drawTextRight()\n\nNiivue.prototype.drawTextBelow = function(xy, str) { //horizontally centered on x, below y\n\tif (this.opts.textHeight <= 0) return;\n\tthis.fontShader.use(this.gl)\n\tlet scale = (this.opts.textHeight * this.gl.canvas.height);\n\txy[0] -= 0.5 * this.textWidth(scale, str);\n\tthis.drawText(xy, str)\n} // drawTextBelow()\n\nNiivue.prototype.draw2D = function(leftTopWidthHeight, axCorSag) {\n\tvar crossXYZ = [this.scene.crosshairPos[0], this.scene.crosshairPos[1],this.scene.crosshairPos[2]]; //axial: width=i, height=j, slice=k\n\tif (axCorSag === this.sliceTypeCoronal)\n\t\tcrossXYZ = [this.scene.crosshairPos[0], this.scene.crosshairPos[2],this.scene.crosshairPos[1]]; //coronal: width=i, height=k, slice=j\n\tif (axCorSag === this.sliceTypeSagittal)\n\t\tcrossXYZ = [this.scene.crosshairPos[1], this.scene.crosshairPos[2],this.scene.crosshairPos[0]]; //sagittal: width=j, height=k, slice=i\n\tlet isMirrorLR = ((this.isRadiologicalConvention) && (axCorSag < this.sliceTypeSagittal))\n\tthis.sliceShader.use(this.gl);\n\tthis.gl.uniform1f(this.sliceShader.uniforms[\"opacity\"], this.backOpacity);\n\tthis.gl.uniform1i(this.sliceShader.uniforms[\"axCorSag\"], axCorSag);\n\tthis.gl.uniform1f(this.sliceShader.uniforms[\"slice\"], crossXYZ[2]);\n\tthis.gl.uniform2fv(this.sliceShader.uniforms[\"canvasWidthHeight\"], [this.gl.canvas.width, this.gl.canvas.height]);\n\tif (isMirrorLR) {\n\t\tthis.gl.disable(this.gl.CULL_FACE);\n\t\tleftTopWidthHeight[2] = - leftTopWidthHeight[2];\n\t\tleftTopWidthHeight[0] = leftTopWidthHeight[0] - leftTopWidthHeight[2];\n\t}\n\tthis.gl.uniform4f(this.sliceShader.uniforms[\"leftTopWidthHeight\"], leftTopWidthHeight[0], leftTopWidthHeight[1], leftTopWidthHeight[2], leftTopWidthHeight[3]);\n\t//console.log(leftTopWidthHeight);\n\t//gl.uniform4f(sliceShader.uniforms[\"leftTopWidthHeight\"], leftTopWidthHeight[0], leftTopWidthHeight[1], leftTopWidthHeight[2], leftTopWidthHeight[3]);\n\t//gl.drawArrays(gl.TRIANGLE_STRIP, 5, 4);\n\tthis.gl.drawArrays(this.gl.TRIANGLE_STRIP, 5, 4);\n\t//record screenSlices to detect mouse click positions\n\tthis.screenSlices[this.numScreenSlices].leftTopWidthHeight = leftTopWidthHeight;\n\tthis.screenSlices[this.numScreenSlices].axCorSag = axCorSag;\n\tthis.numScreenSlices += 1;\n\tif (this.opts.crosshairWidth <= 0.0) return;\n\tthis.lineShader.use(this.gl)\n\tthis.gl.uniform4fv(this.lineShader.uniforms[\"lineColor\"], this.opts.crosshairColor);\n\tthis.gl.uniform2fv(this.lineShader.uniforms[\"canvasWidthHeight\"], [this.gl.canvas.width, this.gl.canvas.height]);\n\t//vertical line of crosshair:\n\tvar xleft = leftTopWidthHeight[0] + (leftTopWidthHeight[2] * crossXYZ[0]);\n\tthis.gl.uniform4f(this.lineShader.uniforms[\"leftTopWidthHeight\"], xleft - (0.5*this.opts.crosshairWidth), leftTopWidthHeight[1],  this.opts.crosshairWidth, leftTopWidthHeight[3]);\n\tthis.gl.drawArrays(this.gl.TRIANGLE_STRIP, 5, 4);\n\t//horizontal line of crosshair:\n\tvar xtop = leftTopWidthHeight[1] + (leftTopWidthHeight[3] * (1.0 - crossXYZ[1]));\n\tthis.gl.uniform4f(this.lineShader.uniforms[\"leftTopWidthHeight\"], leftTopWidthHeight[0], xtop - (0.5*this.opts.crosshairWidth), leftTopWidthHeight[2],  this.opts.crosshairWidth);\n\tthis.gl.drawArrays(this.gl.TRIANGLE_STRIP, 5, 4);\n\tthis.gl.enable(this.gl.CULL_FACE);\n\tif (isMirrorLR)\n\t\tthis.drawTextRight([leftTopWidthHeight[0] +leftTopWidthHeight[2] + 1, leftTopWidthHeight[1] + (0.5 * leftTopWidthHeight[3]) ], \"R\");\n\telse if (axCorSag < this.sliceTypeSagittal)\n\t\tthis.drawTextRight([leftTopWidthHeight[0] + 1, leftTopWidthHeight[1] + (0.5 * leftTopWidthHeight[3]) ], \"L\");\n\tif ( axCorSag === this.sliceTypeAxial)\n\t\tthis.drawTextBelow([leftTopWidthHeight[0] + (0.5 * leftTopWidthHeight[2]), leftTopWidthHeight[1] + 1 ], \"A\");\n\tif ( axCorSag > this.sliceTypeAxial)\n\t\tthis.drawTextBelow([leftTopWidthHeight[0] + (0.5 * leftTopWidthHeight[2]), leftTopWidthHeight[1] + 1 ], \"S\");\n} // draw2D()\n\nNiivue.prototype.draw3D = function() {\n\tlet {volScale, vox} = this.sliceScale(); // slice scale determined by this.back --> the base image layer\n\tthis.renderShader.use(this.gl);\n\tlet mn = Math.min(this.gl.canvas.width, this.gl.canvas.height)\n\tif (mn <= 0) return;\n\tmn *= this.volScaleMultiplier\n\tlet xCenter = this.gl.canvas.width / 2;\n\tlet yCenter = this.gl.canvas.height / 2;\n\tlet xPix = mn\n\tlet yPix = mn\n\tthis.gl.viewport(xCenter-(xPix * 0.5), yCenter - (yPix * 0.5) , xPix, yPix);\n\tthis.gl.clearColor(0.2, 0, 0, 1);\n\tvar m = mat.mat4.create();\n\tvar fDistance = -0.54;\n\t//https://developer.mozilla.org/en-US/docs/Web/API/WebGLRenderingContext/depthRange\n\t// default is 0..1\n\t// unit cube with corner aligned \n\t//this.gl.depthRange(0.1, -fDistance * 3.0); //xerxes\n\t//modelMatrix *= TMat4.Translate(0, 0, -fDistance);\n\tmat.mat4.translate(m,m, [0, 0, fDistance]);\n\t// https://glmatrix.net/docs/module-mat4.html  https://glmatrix.net/docs/mat4.js.html\n\tvar rad = (90-this.scene.renderElevation-volScale[0]) * Math.PI / 180;\n\tmat.mat4.rotate(m,m, rad, [-1, 0, 0]);\n\trad = (this.scene.renderAzimuth) * Math.PI / 180;\n\tmat.mat4.rotate(m,m, rad, [0, 0, 1]);\n\tmat.mat4.scale(m, m, volScale); // volume aspect ratio\n\tmat.mat4.scale(m, m, [0.57, 0.57, 0.57]); //unit cube has maximum 1.73\n\t\n\t//compute ray direction\n\tvar inv = mat.mat4.create();\n\tmat.mat4.invert(inv, m);\n\tvar rayDir4 = mat.vec4.fromValues(0,0,-1,1);\n\tmat.vec4.transformMat4(rayDir4, rayDir4, inv);\n\tvar rayDir = mat.vec3.fromValues(rayDir4[0],rayDir4[1],rayDir4[2]);\n\tmat.vec3.normalize(rayDir, rayDir);\n\t//defuzz, avoid divide by zero\n\tconst tiny = 0.00001;\n\tif (Math.abs(rayDir[0]) < tiny) rayDir[0] = tiny;\n\tif (Math.abs(rayDir[1]) < tiny) rayDir[1] = tiny;\n\tif (Math.abs(rayDir[2]) < tiny) rayDir[2] = tiny;\n\t//console.log( \">>\", renderAzimuth, \" : \", renderElevation, \">>>> \", rayDir);\n\t//this.gl.disable(this.gl.DEPTH_TEST);\n\t//gl.enable(gl.CULL_FACE);\n\t//gl.cullFace(gl.FRONT);\n\tthis.gl.enable(this.gl.CULL_FACE);\n\tthis.gl.uniformMatrix4fv(this.renderShader.uniforms[\"mvpMtx\"], false, m);\n\tthis.gl.uniform1f(this.renderShader.uniforms[\"overlays\"], this.overlays);\n  this.gl.uniform1f(this.renderShader.uniforms[\"backOpacity\"], this.volumes[0].opacity);\n\tthis.gl.uniform4fv(this.renderShader.uniforms[\"clipPlane\"], this.scene.clipPlane);\n\tthis.gl.uniform3fv(this.renderShader.uniforms[\"rayDir\"], rayDir);\n\tthis.gl.uniform3fv(this.renderShader.uniforms[\"texVox\"], vox);\n\tthis.gl.drawArrays(this.gl.TRIANGLE_STRIP, 0, 14); //cube is 12 triangles, triangle-strip creates n-2 triangles\n\tlet posString = 'azimuth: ' + this.scene.renderAzimuth.toFixed(0)+' elevation: '+this.scene.renderElevation.toFixed(0);\n\t//bus.$emit('crosshair-pos-change', posString);\n\treturn posString;\n} // draw3D()\n\nNiivue.prototype.mm2frac = function(mm ) {\n  //given mm, return volume fraction\n\t//convert from object space in millimeters to normalized texture space XYZ= [0..1, 0..1 ,0..1]\n\tlet mm4 = mat.vec4.fromValues( mm[0], mm[1], mm[2],1);\n\tlet d = this.back.dims;\n\tlet frac = [0, 0, 0];\n\tif ((d[1] < 1) || (d[2] < 1) || (d[3] < 1))\n\t\treturn frac;\n\tlet sform = mat.mat4.clone(this.back.matRAS);\n\tmat.mat4.transpose(sform, sform);\n\tmat.mat4.invert(sform, sform);\n\tmat.vec4.transformMat4(mm4, mm4, sform);\n\tfrac[0] = (mm4[0] + 0.5) / d[1];\n\tfrac[1] = (mm4[1] + 0.5) / d[2];\n\tfrac[2] = (mm4[2] + 0.5) / d[3];\n\t//console.log(\"mm\", mm, \" -> frac\", frac);\n\treturn frac;\n} // mm2frac()\n\nNiivue.prototype.vox2frac = function(vox) {\n\t//convert from  0-index voxel space [0..dim[1]-1, 0..dim[2]-1, 0..dim[3]-1] to normalized texture space XYZ= [0..1, 0..1 ,0..1]\n\t//consider dimension with 3 voxels, the voxel centers are at 0.25, 0.5, 0.75 corresponding to 0,1,2\n\tlet frac = [ (vox[0]+0.5)/this.back.dims[1], (vox[1]+0.5)/this.back.dims[2], (vox[2]+0.5)/this.back.dims[3] ]\n\treturn frac\n} // vox2frac()\n\nNiivue.prototype.frac2vox = function(frac) {\n\t//convert from normalized texture space XYZ= [0..1, 0..1 ,0..1] to 0-index voxel space [0..dim[1]-1, 0..dim[2]-1, 0..dim[3]-1]\n\t//consider dimension with 3 voxels, the voxel centers are at 0.25, 0.5, 0.75 corresponding to 0,1,2\n\tlet vox = [ (frac[0]*this.back.dims[1])-0.5, (frac[1]*this.back.dims[2])-0.5, (frac[2]*this.back.dims[3])-0.5 ]\n\treturn vox\n} // frac2vox()\n\nNiivue.prototype.frac2mm = function(frac) {\n  //convert from normalized texture space XYZ= [0..1, 0..1 ,0..1] to object space in millimeters\n\tlet pos = mat.vec4.fromValues(frac[0], frac[1], frac[2], 1);\n\t//let d = overlayItem.volume.hdr.dims;\n\tlet dim = mat.vec4.fromValues(this.back.dims[1], this.back.dims[2],this. back.dims[3], 1);\n\tlet sform = mat.mat4.clone(this.back.matRAS);\n\tmat.mat4.transpose(sform, sform);\n\tmat.vec4.mul(pos, pos, dim);\n\tlet shim = mat.vec4.fromValues(-0.5, -0.5, -0.5, 0); //bitmap with 5 voxels scaled 0..1, voxel centers are 0.1,0.3,0.5,0.7,0.9\n\tmat.vec4.add(pos, pos, shim);\n\tmat.vec4.transformMat4(pos, pos, sform);\n\tthis.mm2frac(pos);\n\treturn pos;\n} // frac2mm()\n\nNiivue.prototype.scaleSlice = function(w, h) {\n\tlet scalePix = this.gl.canvas.clientWidth / w;\n\tif ((h * scalePix) > this.gl.canvas.clientHeight)\n\t\tscalePix = this.gl.canvas.clientHeight / h;\n\t//canvas space is 0,0...w,h with origin at upper left\n\tlet wPix = w * scalePix;\n\tlet hPix = h * scalePix;\n\tlet leftTopWidthHeight = [(this.gl.canvas.clientWidth-wPix) * 0.5, ((this.gl.canvas.clientHeight-hPix) * 0.5), wPix, hPix];\n\t//let leftTopWidthHeight = [(gl.canvas.clientWidth-wPix) * 0.5, 80, wPix, hPix];\n\treturn leftTopWidthHeight;\n} // scaleSlice()\n\n\nNiivue.prototype.drawScene = function() {\n\tthis.gl.clearColor(this.opts.backColor[0], this.opts.backColor[1], this.opts.backColor[2], this.opts.backColor[3]);\n\tthis.gl.clear(this.gl.COLOR_BUFFER_BIT);\n\tlet posString = '';\n\tif(!this.back.dims) // exit if we have nothing to draw\n\t\treturn\n\tif (this.sliceType === this.sliceTypeRender) //draw rendering\n\t\treturn this.draw3D();\n\tlet {volScale} = this.sliceScale();\n\tthis.gl.viewport(0, 0, this.gl.canvas.width, this.gl.canvas.height);\n\tthis.numScreenSlices = 0;\n\tif (this.sliceType === this.sliceTypeAxial) { //draw axial\n\t\tlet leftTopWidthHeight = this.scaleSlice(volScale[0], volScale[1]);\n\t\tthis.draw2D(leftTopWidthHeight, 0);\n\t} else if (this.sliceType === this.sliceTypeCoronal) { //draw coronal\n\t\tlet leftTopWidthHeight = this.scaleSlice(volScale[0], volScale[2]);\n\t\tthis.draw2D(leftTopWidthHeight, 1);\n\t} else if (this.sliceType === this.sliceTypeSagittal) { //draw sagittal\n\t\tlet leftTopWidthHeight = this.scaleSlice(volScale[1], volScale[2]);\n\t\tthis.draw2D(leftTopWidthHeight, 2);\n\t} else { //sliceTypeMultiplanar\n\t\tlet ltwh = this.scaleSlice(volScale[0]+volScale[1], volScale[1]+volScale[2]);\n\t\tlet wX = ltwh[2] * volScale[0]/(volScale[0]+volScale[1]);\n\t\tlet ltwh3x1 = this.scaleSlice(volScale[0]+volScale[0]+volScale[1], Math.max(volScale[1],volScale[2]));\n\t\tlet wX1 = ltwh3x1[2] * volScale[0]/(volScale[0]+volScale[0]+volScale[1]);\n\t\tif (wX1 > wX) {\n\t\t\tlet pixScale = (wX1 / volScale[0]);\n\t\t\tlet hY1 = volScale[1] * pixScale;\n\t\t\tlet hZ1 = volScale[2] * pixScale;\n\t\t\t//draw axial\n\t\t\tthis.draw2D([ltwh3x1[0],ltwh3x1[1], wX1, hY1], 0);\n\t\t\t//draw coronal\n\t\t\tthis.draw2D([ltwh3x1[0] + wX1,ltwh3x1[1], wX1, hZ1], 1);\n\t\t\t//draw sagittal\n\t\t\tthis.draw2D([ltwh3x1[0] + wX1 + wX1,ltwh3x1[1], hY1, hZ1], 2);\n\n\t\t} else {\n\t\t\tlet wY = ltwh[2] - wX;\n\t\t\tlet hY = ltwh[3] * volScale[1]/(volScale[1]+volScale[2]);\n\t\t\tlet hZ = ltwh[3] - hY;\n\t\t\t//draw axial\n\t\t\tthis.draw2D([ltwh[0],ltwh[1]+hZ, wX, hY], 0);\n\t\t\t//draw coronal\n\t\t\tthis.draw2D([ltwh[0],ltwh[1], wX, hZ], 1);\n\t\t\t//draw sagittal\n\t\t\tthis.draw2D([ltwh[0]+wX,ltwh[1], wY, hZ], 2);\n\t\t\t//draw colorbar (optional) // TODO currently only drawing one colorbar, there may be one per overlay + one for the background\n\t\t\tvar margin = this.opts.colorBarMargin * hY;\n\t\t\tthis.drawColorbar([ltwh[0]+wX+margin, ltwh[1] + hZ + margin, wY - margin - margin, hY * this.opts.colorbarHeight]);\n\t\t\t// drawTextBelow(gl, [ltwh[0]+ wX + (wY * 0.5), ltwh[1] + hZ + margin + hY * colorbarHeight], \"Syzygy\"); //DEMO\n\t\t}\n\t}\n\tconst pos = this.frac2mm([this.scene.crosshairPos[0],this.scene.crosshairPos[1],this.scene.crosshairPos[2]]);\n\tposString = pos[0].toFixed(2)+'×'+pos[1].toFixed(2)+'×'+pos[2].toFixed(2);\n\tthis.gl.finish();\n\t// temporary event bus mechanism. It uses Vue, but it would be ideal to divorce vue from this gl code.\n\t//bus.$emit('crosshair-pos-change', posString);\n\treturn posString\n} // drawScene()\n\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./controls.vue?vue&type=style&index=0&id=861f600c&scoped=true&lang=css&\"","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./glviewer.vue?vue&type=style&index=0&id=690d447c&scoped=true&lang=css&\""],"sourceRoot":""}