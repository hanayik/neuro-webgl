(function(e){function t(t){for(var a,r,l=t[0],s=t[1],c=t[2],f=0,d=[];f<l.length;f++)r=l[f],Object.prototype.hasOwnProperty.call(i,r)&&i[r]&&d.push(i[r][0]),i[r]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a]);u&&u(t);while(d.length)d.shift()();return o.push.apply(o,c||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],a=!0,l=1;l<n.length;l++){var s=n[l];0!==i[s]&&(a=!1)}a&&(o.splice(t--,1),e=r(r.s=n[0]))}return e}var a={},i={app:0},o=[];function r(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=a,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var u=s;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"2c88":function(e,t,n){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-app-bar",{attrs:{app:""}},[n("h2",[e._v("Niivue")]),n("v-spacer")],1),n("v-main",[n("v-row",{staticStyle:{height:"100%"}},[n("v-col",{attrs:{sm:"12",md:"12",lg:"4"}},[n("controls",{attrs:{overlays:e.overlayList}})],1),n("v-col",{attrs:{sm:"12",md:"12",lg:"8"}},[n("v-toolbar",{staticClass:"pa-0 ma-0",attrs:{elevation:"0"}},[n("v-btn",{on:{click:function(t){return e.setSliceType(0)}}},[e._v("A")]),n("v-btn",{on:{click:function(t){return e.setSliceType(2)}}},[e._v("S")]),n("v-btn",{on:{click:function(t){return e.setSliceType(1)}}},[e._v("C")]),n("v-btn",{on:{click:function(t){return e.setSliceType(4)}}},[e._v("R")]),n("v-btn",{on:{click:function(t){return e.setSliceType(3)}}},[e._v("MP")]),n("v-spacer")],1),1==e.viewShown2D||1==e.viewShown3D?n("v-expansion-panels",[n("v-expansion-panel",[n("v-expansion-panel-header",[n("v-row",{staticClass:"align-center",attrs:{"no-gutters":""}},[e._v(" Controls "),n("v-icon",{staticClass:"mx-2"},[e._v(" mdi-arrow-expand-vertical ")])],1)],1),n("v-expansion-panel-content",[1==e.viewShown2D?n("v-row",[n("v-slider",{attrs:{step:"0.01",max:"1",min:"0","thumb-label":"",label:"slice"},on:{input:e.onSliceSlider2D},model:{value:e.sliceScrollVal,callback:function(t){e.sliceScrollVal=t},expression:"sliceScrollVal"}})],1):e._e(),1==e.viewShown3D?n("v-row",[n("v-slider",{attrs:{step:"0.005",max:"1",min:"-1","thumb-label":"",label:"clip x"},on:{input:e.onClipPlaneChange},model:{value:e.clipValX,callback:function(t){e.clipValX=t},expression:"clipValX"}})],1):e._e(),1==e.viewShown3D?n("v-row",[n("v-slider",{attrs:{step:"0.005",max:"1",min:"-1","thumb-label":"",label:"clip y"},on:{input:e.onClipPlaneChange},model:{value:e.clipValY,callback:function(t){e.clipValY=t},expression:"clipValY"}})],1):e._e(),1==e.viewShown3D?n("v-row",[n("v-slider",{attrs:{step:"0.005",max:"1",min:"-1","thumb-label":"",label:"clip z"},on:{input:e.onClipPlaneChange},model:{value:e.clipValZ,callback:function(t){e.clipValZ=t},expression:"clipValZ"}})],1):e._e(),1==e.viewShown3D?n("v-row",[n("v-slider",{attrs:{step:"0.005",max:"0.5",min:"-0.5","thumb-label":"",label:"clip w"},on:{input:e.onClipPlaneChange},model:{value:e.clipValW,callback:function(t){e.clipValW=t},expression:"clipValW"}})],1):e._e(),n("v-row",[e.viewShown3D?n("v-btn",{staticClass:"mx-auto",on:{click:e.onResetClipPlane}},[e._v("reset")]):e._e()],1)],1)],1)],1):e._e(),n("glviewer",{attrs:{overlays:e.overlayList}})],1)],1)],1),n("v-footer",{attrs:{app:""}},[n("v-row",[n("v-col",{attrs:{align:"center",justify:"center"}},[n("span",{staticClass:"text-caption"},[e._v(e._s(e.coordinateString))])])],1)],1)],1)},o=[],r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mt-5",attrs:{id:"controls"}},[n("v-row",{staticClass:"my-2 mx-2 align-center"},[n("h3",[e._v("Layers")]),n("v-spacer"),n("v-btn",{staticClass:"mx-2",attrs:{small:""},on:{click:e.onAddOverlay}},[e._v("Add overlay")])],1),n("v-row",{attrs:{"no-gutters":""}},[n("v-expansion-panels",[n("draggable",{staticClass:"row mx-2 my-2",attrs:{handle:".drag-handle"},model:{value:e.overlays,callback:function(t){e.overlays=t},expression:"overlays"}},e._l(e.overlays,(function(t,a){return n("v-expansion-panel",{key:a},[n("v-expansion-panel-header",[n("v-row",{staticClass:"align-center",attrs:{"no-gutters":""}},[n("v-icon",{staticClass:"mx-2 drag-handle"},[e._v(" mdi-drag-horizontal-variant ")]),n("v-icon",{staticClass:"mx-2",on:{click:function(t){return t.stopPropagation(),e.toggleEye(t)}}},[e._v(" "+e._s(e.eyeIcon)+" ")]),e._v(e._s(t.name)+" ")],1)],1),n("v-expansion-panel-content",[n("v-row",[n("v-select",{attrs:{items:e.colorMaps,label:"Color map"},on:{change:e.onColorChange},model:{value:e.selectedColorMap,callback:function(t){e.selectedColorMap=t},expression:"selectedColorMap"}})],1),n("v-row",[n("v-col",{staticClass:"px-4"},[n("p",[e._v("Intensity range")]),n("v-range-slider",{staticClass:"align-center",attrs:{max:t.intensityMax,min:t.intensityMin,"hide-details":""},scopedSlots:e._u([{key:"prepend",fn:function(){return[n("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{value:t.intensityRange[0],"hide-details":"","single-line":"",type:"number"},on:{input:function(n){return e.$set(t.intensityRange,0,n)}}})]},proxy:!0},{key:"append",fn:function(){return[n("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{value:t.intensityRange[1],"hide-details":"","single-line":"",type:"number"},on:{input:function(n){return e.$set(t.intensityRange,1,n)}}})]},proxy:!0}],null,!0),model:{value:t.intensityRange,callback:function(n){e.$set(t,"intensityRange",n)},expression:"overlay.intensityRange"}})],1)],1),n("v-row",[n("v-col",[n("p",[e._v("Opacity")]),n("v-slider",{attrs:{step:"0.01",max:"1",min:"0","thumb-label":"",ticks:""},on:{input:e.onOpacityChange},model:{value:e.opacity,callback:function(t){e.opacity=t},expression:"opacity"}})],1)],1)],1)],1)})),1)],1)],1)],1)},l=[],s=n("b76a"),c=n.n(s),u=n("f5ef"),f={props:{overlays:Array},name:"controls",components:{draggable:c.a},data:function(){return{colorSelected:"gray",colorMaps:["gray","Winter","Warm","Plasma","Viridis","Inferno"],selectedColorMap:"gray",eyeIcon:"mdi-eye",overlays_:this.overlays,draggable:!0,opacity:1}},methods:{toggleEye:function(){this.eyeIcon="mdi-eye"==this.eyeIcon?"mdi-eye-off":"mdi-eye"},onColorChange:function(){u["a"].$emit("colormap-change",this.selectedColorMap)},onOpacityChange:function(){u["a"].$emit("opacity-change",this.opacity)},onAddOverlay:function(){alert("adding overlays in this demo is not implemented yet! :)")}}},d=f,v=(n("d72e"),n("2877")),p=n("6544"),h=n.n(p),m=n("8336"),g=n("62ad"),x=n("cd55"),y=n("49e2"),T=n("c865"),b=n("0393"),E=n("132d"),w=n("5963"),_=n("0fd9"),P=n("b974"),R=n("ba0d"),C=n("2fa4"),S=n("8654"),D=Object(v["a"])(d,r,l,!1,null,"4b65bab5",null),A=D.exports;h()(D,{VBtn:m["a"],VCol:g["a"],VExpansionPanel:x["a"],VExpansionPanelContent:y["a"],VExpansionPanelHeader:T["a"],VExpansionPanels:b["a"],VIcon:E["a"],VRangeSlider:w["a"],VRow:_["a"],VSelect:P["a"],VSlider:R["a"],VSpacer:C["a"],VTextField:S["a"]});var M=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"viewer",attrs:{id:"viewer"}},[n("v-dialog",{attrs:{"max-width":"400"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[n("v-color-picker",{attrs:{width:"400",mode:"rgba"},on:{input:e.onCrosshairColorChange},model:{value:e.crosshairColor,callback:function(t){e.crosshairColor=t},expression:"crosshairColor"}})],1),n("v-dialog",{attrs:{"max-width":"400"},model:{value:e.discoMode,callback:function(t){e.discoMode=t},expression:"discoMode"}},[n("v-card",{attrs:{color:"rgba(0, 0, 0, 0.4)"}},[n("v-row",{attrs:{"no-gutters":""}},[n("v-spacer"),n("h2",{staticStyle:{color:"white"}},[e._v("Disco mode")]),n("v-spacer")],1)],1)],1)],1)},W=[],V=n("c8b5"),L=n("8f10"),U={name:"glviewer",props:{overlays:Array,shader:String},created:function(){u["a"].$on("slice-type-change",(function(e){L["k"](e)})),u["a"].$on("set-2D-slice",(function(e){L["l"](e,null,null,!1)})),u["a"].$on("set-clip-planes",(function(e){L["a"](e)}))},data:function(){return{selectedOverlay:0,last2DSliceVal:.5,mouseDown:!1,touchDown:!1,zDown:!1,discoMode:!1,discoModeColorMapTimer:null,discoModeCrosshairTimer:null,scale:1,dialog:!1,crosshairColor:{r:255,g:0,b:0,a:1},colorMaps:["Winter","Warm","Plasma","Viridis","Inferno"],selectedColorMap:"Winter"}},watch:{overlays:{deep:!0,handler:function(){}}},methods:{onWindowResize:function(){var e=100,t=document.querySelector("#gl"),n=document.querySelector("#viewer");t.width=n.clientWidth,t.height=n.clientHeight,n.getBoundingClientRect().bottom>document.documentElement.clientHeight&&(n.style.height=document.documentElement.clientHeight-e,t.height=document.documentElement.clientHeight-e),L["b"](this.gl,this.overlays[this.selectedOverlay])},onCrosshairColorChange:function(){var e=[this.crosshairColor.r/255,this.crosshairColor.g/255,this.crosshairColor.b/255,this.crosshairColor.a];L["h"](e)}},mounted:function(){var e=this,t=document.createElement("canvas");t.classList.add("fillParent");var n=document.querySelector("#viewer");t.id="gl",t.width=n.clientWidth,t.height=n.clientHeight,n.appendChild(t);var a=document.querySelector("#gl"),i=a.getContext("webgl2"),o=new V(a);o.get("press").set({time:2e3}),o.get("pinch").set({enable:!0}),i.canvas.addEventListener("mousedown",(function(t){t.preventDefault(),e.dialog=!1,e.mouseDown=!0;var n=a.getBoundingClientRect();L["e"](e.gl,e.overlays[0],t.clientX-n.left,t.clientY-n.top),L["f"](t.clientX-n.left,t.clientY-n.top)})),i.canvas.addEventListener("touchstart",(function(t){t.preventDefault(),e.dialog=!1,e.touchDown=!0;var n=a.getBoundingClientRect();L["e"](e.gl,e.overlays[0],t.touches[0].clientX-n.left,t.touches[0].clientY-n.top),L["f"](t.touches[0].clientX-n.left,t.touches[0].clientY-n.top)})),i.canvas.addEventListener("mousemove",(function(t){if(e.mouseDown){var n=a.getBoundingClientRect();L["e"](e.gl,e.overlays[0],t.clientX-n.left,t.clientY-n.top),L["g"](t.clientX-n.left,t.clientY-n.top)}})),i.canvas.addEventListener("touchmove",(function(t){if(e.touchDown&&t.touches.length<2){var n=a.getBoundingClientRect();L["e"](e.gl,e.overlays[0],t.touches[0].clientX-n.left,t.touches[0].clientY-n.top),L["g"](t.touches[0].clientX-n.left,t.touches[0].clientY-n.top)}})),o.on("pinchin",(function(){L["l"](.001,null,null)})),o.on("pinchout",(function(){L["l"](-.001,null,null)})),i.canvas.addEventListener("wheel",(function(t){if(e.zDown)t.preventDefault(),e.scale+=-.01*t.deltaY,L["i"](e.scale);else{t.preventDefault(),t.stopPropagation();var n=a.getBoundingClientRect();t.deltaY<0?L["l"](-.01,t.clientX-n.left,t.clientY-n.top):L["l"](.01,t.clientX-n.left,t.clientY-n.top)}})),o.on("press",(function(){e.dialog=!0})),i.canvas.addEventListener("mouseup",(function(){e.mouseDown=!1})),i.canvas.addEventListener("tocuhend",(function(){e.touchDown=!1})),window.addEventListener("keypress",(function(t){"z"===t.key&&(e.zDown=!0),"d"===t.key&&(e.discoMode=0==e.discoMode,clearInterval(e.discoModeColorMapTimer),clearInterval(e.discoModeCrosshairTimer),e.discoMode?(e.discoModeColorMapTimer=setInterval((function(){u["a"].$emit("colormap-change",e.colorMaps[Math.floor(Math.random()*e.colorMaps.length)])}),200),e.discoModeCrosshairTimer=setInterval((function(){L["h"]([Math.random(),Math.random(),Math.random(),1])}),200)):(u["a"].$emit("colormap-change","gray"),L["h"]([1,0,0,1])))})),window.addEventListener("keyup",(function(t){"z"===t.key&&(e.zDown=!1)})),window.addEventListener("resize",this.onWindowResize),this.gl=i,this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.FRONT),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),L["c"](this.gl),L["d"](this.overlays[this.selectedOverlay]),u["a"].$on("opacity-change",(function(e){L["j"](e)}))}},H=U,I=(n("7207"),n("b0af")),X=n("03a4"),k=n("169a"),F=Object(v["a"])(H,M,W,!1,null,"5ce1200a",null),z=F.exports;h()(F,{VCard:I["a"],VColorPicker:X["a"],VDialog:k["a"],VRow:_["a"],VSpacer:C["a"]});var B={name:"App",components:{controls:A,glviewer:z},created:function(){var e=this;u["a"].$on("crosshair-pos-change",(function(t){e.coordinateString=t}))},data:function(){return{tab:null,viewShown2D:!1,viewShown3D:!1,clipValX:0,clipValY:0,clipValZ:0,clipValW:0,sliceScrollVal:.5,appTabs:["Menu","Draw","Edit","Scripting"],coordinateString:"0x0x0",overlayList:[{volumeURL:"./spm152.nii.gz",volume:{hdr:null,img:null},name:"standard",intensityMin:0,intensityMax:100,intensityRange:[0,100],colorMap:"gray",opacity:100},{volumeURL:"./motor.nii.gz",volume:{hdr:null,img:null},name:"motor",intensityMin:0,intensityMax:100,intensityRange:[0,100],colorMap:"Warm",opacity:100}]}},methods:{setSliceType:function(e){e<3?(this.viewShown2D=!0,this.viewShown3D=!1):4==e?(this.viewShown2D=!1,this.viewShown3D=!0):(this.viewShown2D=!1,this.viewShown3D=!1),u["a"].$emit("slice-type-change",e)},onSliceSlider2D:function(){this.viewShown2D&&u["a"].$emit("set-2D-slice",this.sliceScrollVal)},onClipPlaneChange:function(){this.viewShown3D&&u["a"].$emit("set-clip-planes",[this.clipValX,this.clipValY,this.clipValZ,this.clipValW])},onResetClipPlane:function(){this.viewShown3D&&(this.clipValX=0,this.clipValY=0,this.clipValZ=0,this.clipValW=0,u["a"].$emit("set-clip-planes",[this.clipValX,this.clipValY,this.clipValZ,this.clipValW]))}}},N=B,O=n("7496"),G=n("40dc"),j=n("553a"),Y=n("f6c4"),$=n("71d9"),q=Object(v["a"])(N,i,o,!1,null,null,null),Z=q.exports;h()(q,{VApp:O["a"],VAppBar:G["a"],VBtn:m["a"],VCol:g["a"],VExpansionPanel:x["a"],VExpansionPanelContent:y["a"],VExpansionPanelHeader:T["a"],VExpansionPanels:b["a"],VFooter:j["a"],VIcon:E["a"],VMain:Y["a"],VRow:_["a"],VSlider:R["a"],VSpacer:C["a"],VToolbar:$["a"]});var K=n("f309");n("bf40");a["a"].use(K["a"]);var J=new K["a"]({});a["a"].config.productionTip=!1,new a["a"]({vuetify:J,render:function(e){return e(Z)}}).$mount("#app")},6704:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n("466d"),n("ac1f"),n("159b");var a=function(e,t,n){var a=this;this.program=i(e,t,n);var o=/uniform[^;]+[ ](\w+);/g,r=/uniform[^;]+[ ](\w+);/;this.uniforms={};var l=t.match(o),s=n.match(o);for(var c in l&&l.forEach((function(e){var t=e.match(r);a.uniforms[t[1]]=-1})),s&&s.forEach((function(e){var t=e.match(r);a.uniforms[t[1]]=-1})),this.uniforms)this.uniforms[c]=e.getUniformLocation(this.program,c)};a.prototype.use=function(e){e.useProgram(this.program)};var i=function(e,t,n){var a=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(a,t),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS))return alert("Vertex shader failed to compile, see console for log"),console.log(e.getShaderInfoLog(a)),null;var i=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(i,n),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))return alert("Fragment shader failed to compile, see console for log"),console.log(e.getShaderInfoLog(i)),null;var o=e.createProgram();return e.attachShader(o,a),e.attachShader(o,i),e.linkProgram(o),e.getProgramParameter(o,e.LINK_STATUS)?o:(alert("Shader failed to link, see console for log"),console.log(e.getProgramInfoLog(o)),null)}},7207:function(e,t,n){"use strict";n("b42f")},"8bb8":function(e,t,n){"use strict";n.d(t,"i",(function(){return a})),n.d(t,"d",(function(){return i})),n.d(t,"j",(function(){return o})),n.d(t,"e",(function(){return r})),n.d(t,"c",(function(){return l})),n.d(t,"f",(function(){return s})),n.d(t,"a",(function(){return c})),n.d(t,"h",(function(){return u})),n.d(t,"g",(function(){return f})),n.d(t,"b",(function(){return d}));var a="#version 300 es\n#line 4\nlayout(location=0) in vec3 pos;\nuniform mat4 mvpMtx;\nout vec3 vColor;\nvoid main(void) {\n\tgl_Position = mvpMtx * vec4(2.0 * (pos.xyz - 0.5), 1.0);\n\tvColor = pos;\n}",i="#version 300 es\n#line 15\nprecision highp int;\nprecision highp float;\nuniform vec3 rayDir;\nuniform vec3 texVox;\nuniform vec4 clipPlane;\nuniform highp sampler3D volume, overlay;\nuniform highp sampler2D colormap;\nuniform float overlays;\nin vec3 vColor;\nout vec4 fColor;\nvec3 GetBackPosition (vec3 startPosition) {\n vec3 invR = 1.0 / rayDir;\n vec3 tbot = invR * (vec3(0.0)-startPosition);\n vec3 ttop = invR * (vec3(1.0)-startPosition);\n vec3 tmax = max(ttop, tbot);\n vec2 t = min(tmax.xx, tmax.yz);\n return startPosition + (rayDir * min(t.x, t.y));\n}\nvec4 applyClip (vec3 dir, inout vec4 samplePos, inout float len) {\n\tfloat cdot = dot(dir,clipPlane.xyz);\n\tif  ((clipPlane.a > 1.0) || (cdot == 0.0)) return samplePos;\n    bool frontface = (cdot > 0.0);\n\tfloat clipThick = 2.0;\n    float dis = (-clipPlane.a - dot(clipPlane.xyz, samplePos.xyz-0.5)) / cdot;\n    float  disBackFace = (-(clipPlane.a-clipThick) - dot(clipPlane.xyz, samplePos.xyz-0.5)) / cdot;\n    if (((frontface) && (dis >= len)) || ((!frontface) && (dis <= 0.0))) {\n        samplePos.a = len + 1.0;\n        return samplePos;\n    }\n    if (frontface) {\n        dis = max(0.0, dis);\n        samplePos = vec4(samplePos.xyz+dir * dis, dis);\n        len = min(disBackFace, len);\n    }\n    if (!frontface) {\n        len = min(dis, len);\n        disBackFace = max(0.0, disBackFace);\n        samplePos = vec4(samplePos.xyz+dir * disBackFace, disBackFace);\n    }\n    return samplePos;\n}\nvoid main() {\n    fColor = vec4(0.0,0.0,0.0,0.0);\n\tvec3 start = vColor;\n\t//fColor = vec4(start, 1.0); return;\n\tvec3 backPosition = GetBackPosition(start);\n\t//fColor = vec4(backPosition, 1.0); return;\n    vec3 dir = backPosition - start;\n    float len = length(dir);\n\tfloat lenVox = length((texVox * start) - (texVox * backPosition));\n\tfloat sliceSize = len / lenVox; //e.g. if ray length is 1.0 and traverses 50 voxels, each voxel is 0.02 in unit cube\n\tfloat stepSize = sliceSize; //quality: larger step is faster traversal, but fewer samples\n\tfloat opacityCorrection = stepSize/sliceSize;\n    dir = normalize(dir);\n\tvec4 deltaDir = vec4(dir.xyz * stepSize, stepSize);\n\tvec4 samplePos = vec4(start.xyz, 0.0); //ray position\n\tfloat lenNoClip = len;\n\tvec4 clipPos = applyClip(dir, samplePos, len);\n\t//start: OPTIONAL fast pass: rapid traversal until first hit\n\tfloat stepSizeFast = sliceSize * 1.9;\n\tvec4 deltaDirFast = vec4(dir.xyz * stepSizeFast, stepSizeFast);\n\twhile (samplePos.a <= len) {\n\t\tfloat val = texture(volume, samplePos.xyz).r;\n\t\tif (val > 0.01) break;\n\t\tsamplePos += deltaDirFast; //advance ray position\n\t}\n\tif ((samplePos.a > len) && (overlays < 1.0)) return;\n\tsamplePos -= deltaDirFast;\n\tif (samplePos.a < 0.0)\n\t\tvec4 samplePos = vec4(start.xyz, 0.0); //ray position\n\t//end: fast pass\n\tvec4 colAcc = vec4(0.0,0.0,0.0,0.0);\n\tconst float earlyTermination = 0.95;\n\tfloat backNearest = len; //assume no hit\n    float ran = fract(sin(gl_FragCoord.x * 12.9898 + gl_FragCoord.y * 78.233) * 43758.5453);\n    samplePos += deltaDir * ran; //jitter ray\n\twhile (samplePos.a <= len) {\n\t\tfloat val = texture(volume, samplePos.xyz).r;\n\t\tsamplePos += deltaDir; //advance ray position\n\t\tif (val < 0.01) continue;\n\t\tbackNearest = min(backNearest, samplePos.a); \n\t\tvec4 colorSample = texture(colormap, vec2(val, 0.5)).rgba;\n\t\tcolorSample.a = 1.0-pow((1.0 - colorSample.a), opacityCorrection);\n\t\tcolorSample.rgb *= colorSample.a;\n\t\tcolAcc= (1.0 - colAcc.a) * colorSample + colAcc;\n\t\tif ( colAcc.a > earlyTermination )\n\t\t\tbreak;\n\t}\n\tcolAcc.a = colAcc.a / earlyTermination;\n\tfColor = colAcc;\n\tif (overlays < 1.0) return;\n\t//overlay pass\n\tlen = lenNoClip;\n\tsamplePos = vec4(start.xyz, 0.0); //ray position\n    //start: OPTIONAL fast pass: rapid traversal until first hit\n\tstepSizeFast = sliceSize * 1.9;\n\tdeltaDirFast = vec4(dir.xyz * stepSizeFast, stepSizeFast);\n\twhile (samplePos.a <= len) {\n\t\tfloat val = texture(overlay, samplePos.xyz).a;\n\t\tif (val > 0.01) break;\n\t\tsamplePos += deltaDirFast; //advance ray position\n\t}\n\tif (samplePos.a > len) return;\n\tsamplePos -= deltaDirFast;\n\tif (samplePos.a < 0.0)\n\t\tvec4 samplePos = vec4(start.xyz, 0.0); //ray position\n\t//end: fast pass\n\t\t\n\tfloat overFarthest = len;\n\tcolAcc = vec4(0.0, 0.0, 0.0, 0.0);\n\tsamplePos += deltaDir * ran; //jitter ray\n\twhile (samplePos.a <= len) {\n\t\tvec4 colorSample = texture(overlay, samplePos.xyz);\n\t\tsamplePos += deltaDir; //advance ray position\n\t\tif (colorSample.a < 0.01) continue;\n\t\tcolorSample.a = 1.0-pow((1.0 - colorSample.a), opacityCorrection);\n\t\tcolorSample.rgb *= colorSample.a;\n\t\tcolAcc= (1.0 - colAcc.a) * colorSample + colAcc;\n\t\toverFarthest = samplePos.a;\n\t\tif ( colAcc.a > earlyTermination )\n\t\t\tbreak;\n\t}\n\tfloat overMix = colAcc.a;\n\tfloat overlayDepth = 0.3;\n\tif (fColor.a <= 0.0) \n\t\t\toverMix = 1.0;\n\telse if (((overFarthest) > backNearest)) {\n\t\tfloat dx = (overFarthest - backNearest)/1.73;\n\t\tdx = fColor.a * pow(dx, overlayDepth);\n\t\toverMix *= 1.0 - dx;\n\t}\n\tfColor.rgb = mix(fColor.rgb, colAcc.rgb, overMix);\n\tfColor.a = max(fColor.a, colAcc.a);\n}",o="#version 300 es\n#line 81\nlayout(location=0) in vec3 pos;\nuniform int axCorSag;\nuniform float slice;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nout vec3 texPos;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n\tif (axCorSag == 1)\n\t\ttexPos = vec3(pos.x, slice, pos.y);\n\telse if (axCorSag == 2)\n\t\ttexPos = vec3(slice, pos.x, pos.y);\n\telse\n\t\ttexPos = vec3(pos.xy, slice);\n}",r="#version 300 es\n#line 105\nprecision highp int;\nprecision highp float;\nuniform highp sampler3D volume, overlay;\nuniform highp sampler2D colormap;\nuniform float opacity;\nin vec3 texPos;\nout vec4 color;\nvoid main() {\n\tcolor = vec4(texture(colormap, vec2(texture(volume, texPos).r, 0.5)).rgb, opacity);\n\tvec4 ocolor = texture(overlay, texPos);\n\tcolor.rgb = mix(color.rgb, ocolor.rgb, ocolor.a);\n}",l="#version 300 es\n#line 119\nprecision highp int;\nprecision highp float;\nuniform vec4 lineColor;\nout vec4 color;\nvoid main() {\n\tcolor = lineColor;\n}",s="#version 300 es\n#line 130\nlayout(location=0) in vec3 pos;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nout float vColor;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n\tvColor = pos.x;\n}",c="#version 300 es\n#line 147\nprecision highp int;\nprecision highp float;\nuniform highp sampler2D colormap;\nin float vColor;\nout vec4 color;\nvoid main() {\n\tcolor = vec4(texture(colormap, vec2(vColor, 0.5)).rgb, 1.0);\n}",u="#version 300 es\n#line 159\nlayout(location=0) in vec3 pos;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n}",f="#version 300 es\n#line 174\nlayout(location=0) in vec3 pos;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftTopWidthHeight;\nuniform vec4 uvLeftTopWidthHeight;\nout vec2 vUV;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftTopWidthHeight.x + (pos.x * leftTopWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftTopWidthHeight.y + ((1.0 - pos.y) * leftTopWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n\tvUV = vec2(uvLeftTopWidthHeight.x + (pos.x * uvLeftTopWidthHeight.z), uvLeftTopWidthHeight.y  + ((1.0 - pos.y) * uvLeftTopWidthHeight.w) );\n}",d="#version 300 es\n#line 192\nprecision highp int;\nprecision highp float;\nuniform highp sampler2D fontTexture;\nuniform vec4 fontColor;\nuniform float screenPxRange;\nin vec2 vUV;\nout vec4 color;\nfloat median(float r, float g, float b) {\n    return max(min(r, g), min(max(r, g), b));\n}\nvoid main() {\n\tvec3 msd = texture(fontTexture, vUV).rgb;\n\t//color = vec4(msd, 1.0); return;\n    float sd = median(msd.r, msd.g, msd.b);\n    float screenPxDistance = screenPxRange*(sd - 0.5);\n    float opacity = clamp(screenPxDistance + 0.5, 0.0, 1.0);\n\tcolor = vec4(fontColor.rgb , fontColor.a * opacity);\n}"},"8f10":function(e,t,n){"use strict";(function(e){n.d(t,"f",(function(){return O})),n.d(t,"g",(function(){return G})),n.d(t,"a",(function(){return j})),n.d(t,"h",(function(){return Y})),n.d(t,"l",(function(){return $})),n.d(t,"k",(function(){return q})),n.d(t,"j",(function(){return Z})),n.d(t,"i",(function(){return K})),n.d(t,"d",(function(){return ie})),n.d(t,"c",(function(){return se})),n.d(t,"e",(function(){return pe})),n.d(t,"b",(function(){return Pe}));var a=n("1da1"),i=n("2909"),o=(n("96cf"),n("8a59"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("d3b7"),n("5cc6"),n("8b09"),n("cfc3"),n("84c3"),n("d81d"),n("fb6a"),n("b680"),n("0037")),r=n("6704"),l=n("20e7"),s=n("8bb8"),c=n("f5ef"),u=.03,f=.05,d=1,v=[0,0,0,1],p=0,h=1,m=2,g=3,x=4,y=g,T=120,b=15,E=[.5,.5,.5],w=1,_=[0,0,0,0],P=!1,R=[1,0,0,1],C=1,S=null,D=.05,A=null,M=null,W=null,V=null,L=null,U=null,H=null,I=null,X=null,k=[0,0],F=0,z=[{leftTopWidthHeight:[1,0,0,1],axCorSag:p},{leftTopWidthHeight:[1,0,0,1],axCorSag:p},{leftTopWidthHeight:[1,0,0,1],axCorSag:p},{leftTopWidthHeight:[1,0,0,1],axCorSag:p}],B=1;function N(e,t){return Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((function(e,n){return e===t[n]}))}function O(e,t){y==x&&(k=[e,t])}function G(e,t){y==x&&(T+=e-k[0],b+=t-k[1],k=[e,t],Pe(J(),S))}function j(e){y==x&&(_=e,Pe(J(),S))}function Y(e){R=e,Pe(J(),S)}function $(e,t,n){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];if(y!==g){var i;if(y==p&&(i=2),y==m&&(i=0),y==h&&(i=1),a){var o=E[i],r=o+e;r>1&&(r=1),r<0&&(r=0),E[i]=r}else E[i]=e;Pe(J(),S)}}function q(e){y=e,Pe(J(),S)}function Z(e){B=e,Pe(J(),S)}function K(e){C=e,Pe(J(),S)}function J(){var e=document.querySelector("#gl").getContext("webgl2");return e||null}function Q(e,t){var n,a=t.volume,i=a.hdr.cal_min,o=a.hdr.cal_max,r=e.length,l=new Uint8ClampedArray(r),s=1;for(o>i&&(s=255/(o-i)),n=0;n<r-1;n++){var c=e[n];c=c*a.hdr.scl_slope+a.hdr.scl_inter,l[n]=(c-i)*s}return l}function ee(e){for(var t=e.volume.hdr,n=t.dims[1]*t.dims[2]*t.dims[3],a=new Uint8ClampedArray(4*n),i=.2*Math.min(Math.min(t.dims[1],t.dims[2]),t.dims[3]),o=.5*t.dims[1],r=.5*t.dims[2],l=.5*t.dims[3],s=0,c=0;c<t.dims[3];c++)for(var u=0;u<t.dims[2];u++)for(var f=0;f<t.dims[1];f++){var d=Math.abs(f-o),v=Math.abs(u-r),p=Math.abs(c-l),h=Math.sqrt(d*d+v*v+p*p),m=0;h<i&&(m=255),a[s]=0,s++,a[s]=m,s++,a[s]=0,s++,a[s]=.5*m,s++}return a}function te(e,t){var n,a=t.volume,i=e.length,o=1/0,r=-1/0;for(n=0;n<i-1;n++)isFinite(e[n])&&(e[n]<o&&(o=e[n]),e[n]>r&&(r=e[n]));isFinite(a.hdr.scl_slope)&&isFinite(a.hdr.scl_inter)&&0!==a.hdr.scl_slope?(o=o*a.hdr.scl_slope+a.hdr.scl_inter,r=r*a.hdr.scl_slope+a.hdr.scl_inter):(a.hdr.scl_slope=1,a.hdr.scl_inter=0),a.hdr.global_min=o,a.hdr.global_max=r,(!isFinite(a.hdr.cal_min)||!isFinite(a.hdr.cal_max)||a.hdr.cal_min>=a.hdr.cal_max)&&(a.hdr.cal_min=o,a.hdr.cal_max=r)}function ne(e){var t=e.affine,n=l["a"].fromValues(Math.abs(t[0][0]),Math.abs(t[0][1]),Math.abs(t[0][2]),Math.abs(t[1][0]),Math.abs(t[1][1]),Math.abs(t[1][2]),Math.abs(t[2][0]),Math.abs(t[2][1]),Math.abs(t[2][2])),a=[1,1,1];n[3]>n[0]&&(a[0]=2),n[6]>n[0]&&n[6]>n[3]&&(a[0]=3),a[1]=1,1===a[0]?n[4]>n[7]?a[1]=2:a[1]=3:2===a[0]?n[1]>n[7]?a[1]=1:a[1]=3:n[1]>n[4]?a[1]=1:a[1]=2,a[2]=6-a[1]-a[0];var i=[1,2,3];i[a[0]-1]=1,i[a[1]-1]=2,i[a[2]-1]=3;var o=l["b"].fromValues(t[0][0],t[0][1],t[0][2],t[0][3],t[1][0],t[1][1],t[1][2],t[1][3],t[2][0],t[2][1],t[2][2],t[2][3],0,0,0,1),r=l["b"].create();l["b"].copy(r,o);for(var s=0;s<3;s++)for(var c=0;c<3;c++)r[4*s+c]=o[4*s+i[c]-1];var u=[0,0,0];r[0]<0&&(u[0]=1),r[5]<0&&(u[1]=1),r[10]<0&&(u[2]=1);var f=!1;if(N(i,[1,2,3])&&N(u,[0,0,0]))return{perm:i,R:r,requiresRot:f};f=!0,l["b"].identity(o),o[0]=1-2*u[0],o[5]=1-2*u[1],o[10]=1-2*u[2],o[3]=(e.dims[i[0]]-1)*u[0],o[7]=(e.dims[i[1]]-1)*u[1],o[11]=(e.dims[i[2]]-1)*u[2];var d=l["b"].create();l["b"].invert(d,o),l["b"].multiply(d,d,r);for(var v=0;v<3;v++)0!==u[v]&&(i[v]=-i[v]);return{perm:i,residualR:d,requiresRot:f}}function ae(e,t){var n=ne(e),a=n.perm,o=n.residualR,r=n.requiresRot;if(r){console.log("FLIP!");var l=null;2===e.datatypeCode?l=new Uint8Array(t):4===e.datatypeCode?l=new Int16Array(t):16===e.datatypeCode?l=new Float32Array(t):512===e.datatypeCode&&(l=new Uint16Array(t));for(var s=[Math.abs(a[0]),Math.abs(a[1]),Math.abs(a[2])],c=[e.dims[s[0]],e.dims[s[1]],e.dims[s[2]]],u=Object(i["a"])(l),f=[1,e.dims[1],e.dims[1]*e.dims[2]],d=[f[s[0]-1],f[s[1]-1],f[s[2]-1]],v=[0,0,0],p=0;p<3;p++)a[p]<0&&(v[p]=d[p]*(c[p]-1),d[p]=-d[p]);for(var h=0,m=0;m<c[2];m++)for(var g=v[2]+m*d[2],x=0;x<c[1];x++)for(var y=v[1]+x*d[1],T=0;T<c[0];T++){var b=v[0]+T*d[0];l[h]=u[b+y+g],h++}e.dims[1]=c[0],e.dims[2]=c[1],e.dims[3]=c[2];var E=[e.pixDims[s[0]],e.pixDims[s[1]],e.pixDims[s[2]]];e.pixDims[1]=E[0],e.pixDims[2]=E[1],e.pixDims[3]=E[2],e.affine[0]=[o[0],o[1],o[2],o[3]],e.affine[1]=[o[4],o[5],o[6],o[7]],e.affine[2]=[o[8],o[9],o[10],o[11]]}}function ie(e){var t=null,n=null,a=e.volumeURL,i=new XMLHttpRequest;i.open("GET",a,!0),i.responseType="arraybuffer",i.onerror=function(){console.log="Error Loading Volume"},i.onload=function(){var a=i.response;a?(t=o["readHeader"](a),n=o["isCompressed"](a)?o["readImage"](t,o["decompress"](a)):o["readImage"](t,a),ae(t,n)):(alert("Unable to load buffer properly from volume?"),console.log("no buffer?")),e.volume.hdr=t,e.volume.img=n,S=e,fe(J(),e.colorMap),ue(J(),e)},i.send()}c["a"].$on("colormap-change",(function(e){fe(J(),e),Pe(J(),S)}));var oe=function(e,t){var n=null;n=new Image,n.onload=function(){var t=e.createTexture();e.activeTexture(e.TEXTURE3),e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)},n.src=t};function re(e){return le.apply(this,arguments)}function le(){return le=Object(a["a"])(regeneratorRuntime.mark((function e(t){var n,i,o,r,l,s,c,u,f,d,v,p,h;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=function(){return r=Object(a["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,fetch("./fnt.json");case 2:return t=e.sent,e.next=5,t.json();case 5:i=e.sent;case 6:case"end":return e.stop()}}),e)}))),r.apply(this,arguments)},o=function(){return r.apply(this,arguments)},e.next=4,oe(t,"fnt.png");case 4:for(X=[],n=0;n<256;n++)X[n]={},X[n].xadv=0,X[n].uv_lbwh=[0,0,0,0],X[n].lbwh=[0,0,0,0];return i=[],e.next=9,o();case 9:X.distanceRange=i.atlas.distanceRange,X.size=i.atlas.size,l=i.atlas.width,s=i.atlas.height,c=0;case 14:if(!(c<i.glyphs.length)){e.next=33;break}if(u=i.glyphs[c],f=u.unicode,X[f].xadv=u.advance,void 0!==u.planeBounds){e.next=20;break}return e.abrupt("continue",30);case 20:d=u.atlasBounds.left/l,v=(s-u.atlasBounds.top)/s,p=(u.atlasBounds.right-u.atlasBounds.left)/l,h=(u.atlasBounds.top-u.atlasBounds.bottom)/s,X[f].uv_lbwh=[d,v,p,h],d=u.planeBounds.left,v=u.planeBounds.bottom,p=u.planeBounds.right-u.planeBounds.left,h=u.planeBounds.top-u.planeBounds.bottom,X[f].lbwh=[d,v,p,h];case 30:c++,e.next=14;break;case 33:case"end":return e.stop()}}),e)}))),le.apply(this,arguments)}function se(e){return ce.apply(this,arguments)}function ce(){return ce=Object(a["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return V=new r["a"](t,s["j"],s["e"]),V.use(t),t.uniform1i(V.uniforms["volume"],0),t.uniform1i(V.uniforms["colormap"],1),t.uniform1i(V.uniforms["overlay"],2),L=new r["a"](t,s["h"],s["c"]),U=new r["a"](t,s["i"],s["d"]),U.use(t),t.uniform1i(U.uniforms["volume"],0),t.uniform1i(U.uniforms["colormap"],1),t.uniform1i(U.uniforms["overlay"],2),H=new r["a"](t,s["f"],s["a"]),H.use(t),t.uniform1i(H.uniforms["colormap"],1),I=new r["a"](t,s["g"],s["b"]),I.use(t),t.uniform1i(I.uniforms["fontTexture"],3),e.next=19,re(t);case 19:case"end":return e.stop()}}),e)}))),ce.apply(this,arguments)}function ue(e,t){var n=[0,1,0,1,1,0,0,1,1,1,1,1,1,0,1,1,1,0,1,0,0,0,1,0,0,0,0,0,1,1,0,0,1,1,0,1,0,0,0,1,0,0],a=e.createVertexArray();e.bindVertexArray(a);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,3,e.FLOAT,!1,0,0);var o=t.volume.hdr,r=t.volume.img,l=null;2===o.datatypeCode?l=new Uint8Array(r):4===o.datatypeCode?l=new Int16Array(r):16===o.datatypeCode?l=new Float32Array(r):512===o.datatypeCode&&(l=new Uint16Array(r)),te(l,t);var s=Q(l,t);M&&e.deleteTexture(M),M=e.createTexture(),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_3D,M),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texStorage3D(e.TEXTURE_3D,1,e.R8,o.dims[1],o.dims[2],o.dims[3]),e.texSubImage3D(e.TEXTURE_3D,0,0,0,0,o.dims[1],o.dims[2],o.dims[3],e.RED,e.UNSIGNED_BYTE,s);var c=ee(t);W&&e.deleteTexture(W),W=e.createTexture(),e.activeTexture(e.TEXTURE2),e.bindTexture(e.TEXTURE_3D,W),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texStorage3D(e.TEXTURE_3D,4,e.RGBA8,o.dims[1],o.dims[2],o.dims[3]),e.texSubImage3D(e.TEXTURE_3D,0,0,0,0,o.dims[1],o.dims[2],o.dims[3],e.RGBA,e.UNSIGNED_BYTE,c),Pe(e,t)}function fe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=de([0,255],[0,255],[0,255],[0,128],[0,255]);"Winter"===t&&(n=de([0,0,0],[0,128,255],[255,196,128],[0,64,128],[0,128,255])),"Warm"===t&&(n=de([255,255,255],[127,196,254],[0,0,0],[0,64,128],[0,128,255])),"Plasma"===t&&(n=de([13,156,237,240],[8,23,121,249],[135,158,83,33],[0,56,80,88],[0,64,192,255])),"Viridis"===t&&(n=de([68,49,53,253],[1,104,183,231],[84,142,121,37],[0,56,80,88],[0,65,192,255])),"Inferno"===t&&(n=de([0,120,237,240],[0,28,105,249],[4,109,37,33],[0,56,80,88],[0,64,192,255])),null!==A&&e.deleteTexture(A),A=e.createTexture(),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,A),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8,256,1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,256,1,e.RGBA,e.UNSIGNED_BYTE,n),console.log("set colormap",t)}function de(e,t,n,a,i){for(var o=new Uint8ClampedArray(1024),r=0;r<i.length-1;r++)for(var l=i[r],s=i[r+1],c=s-l,u=4*l,f=l;f<=s;f++){var d=(f-l)/c;o[u]=e[r]+d*(e[r+1]-e[r]),u++,o[u]=t[r]+d*(t[r+1]-t[r]),u++,o[u]=n[r]+d*(n[r+1]-n[r]),u++,o[u]=a[r]+d*(a[r+1]-a[r]),u++}return o}function ve(e,t){var n=t.volume.hdr,a=[1,n.dims[1]*n.pixDims[1],n.dims[2]*n.pixDims[2],n.dims[3]*n.pixDims[3]],i=Math.max(a[1],Math.max(a[2],a[3])),o=[a[1]/i,a[2]/i,a[3]/i];o=o.map((function(e){return e*C}));var r=[n.dims[1],n.dims[2],n.dims[3]];return{volScale:o,vox:r}}function pe(e,t,n,a){if(y!==x&&!(F<1||e.canvas.height<1||e.canvas.width<1))for(var i=0;i<F;i++){var o=z[i].axCorSag;if(!(o>m)){var r=z[i].leftTopWidthHeight,l=!1;r[2]<0&&(l=!0,r[0]+=r[2],r[2]=-r[2]);var s=(n-r[0])/r[2];l&&(s=1-s);var c=1-(a-r[1])/r[3];if(s>=0&&s<1&&c>=0&&c<1)return o===p&&(E[0]=s,E[1]=c),o===h&&(E[0]=s,E[2]=c),o===m&&(E[1]=s,E[2]=c),void Pe(e,t)}}}function he(e,t){if(!(t[2]<=0||t[3]<=0)){if(d>0){L.use(e),e.uniform4fv(L.uniforms["lineColor"],R),e.uniform2fv(L.uniforms["canvasWidthHeight"],[e.canvas.width,e.canvas.height]);var n=[t[0]-1,t[1]-1,t[2]+2,t[3]+2];e.uniform4f(L.uniforms["leftTopWidthHeight"],n[0],n[1],n[2],n[3]),e.drawArrays(e.TRIANGLE_STRIP,5,4)}H.use(e),e.uniform2fv(H.uniforms["canvasWidthHeight"],[e.canvas.width,e.canvas.height]),e.uniform4f(H.uniforms["leftTopWidthHeight"],t[0],t[1],t[2],t[3]),e.drawArrays(e.TRIANGLE_STRIP,5,4)}}function me(t,n){for(var a=0,i=new e(n),o=0;o<n.length;o++)a+=t*X[i[o]].xadv;return a}function ge(e,t,n,a){var i=X[a],o=t[0]+n*i.lbwh[0],r=-n*i.lbwh[1],l=n*i.lbwh[2],s=n*i.lbwh[3],c=t[1]+(r-s)+n;return e.uniform4f(I.uniforms["leftTopWidthHeight"],o,c,l,s),e.uniform4fv(I.uniforms["uvLeftTopWidthHeight"],i.uv_lbwh),e.drawArrays(e.TRIANGLE_STRIP,5,4),n*i.xadv}function xe(t,n,a){if(!(u<=0)){I.use(t);var i=u*t.canvas.height;t.uniform2f(I.uniforms["canvasWidthHeight"],t.canvas.width,t.canvas.height),t.uniform4fv(I.uniforms["fontColor"],R);var o=i/X.size*X.distanceRange;o=Math.max(o,1),t.uniform1f(I.uniforms["screenPxRange"],o);for(var r=new e(a),l=0;l<a.length;l++)n[0]+=ge(t,n,i,r[l])}}function ye(e,t,n){u<=0||(I.use(e),t[1]-=.5*u*e.canvas.height,xe(e,t,n))}function Te(e,t,n){if(!(u<=0)){I.use(e);var a=u*e.canvas.height;t[0]-=.5*me(a,n),xe(e,t,n)}}function be(e,t,n){var a=[E[0],E[1],E[2]];n===h&&(a=[E[0],E[2],E[1]]),n===m&&(a=[E[1],E[2],E[0]]);var i=P&&n<m;if(V.use(e),e.uniform1f(V.uniforms["opacity"],B),e.uniform1i(V.uniforms["axCorSag"],n),e.uniform1f(V.uniforms["slice"],a[2]),e.uniform2fv(V.uniforms["canvasWidthHeight"],[e.canvas.width,e.canvas.height]),i&&(e.disable(e.CULL_FACE),t[2]=-t[2],t[0]=t[0]-t[2]),e.uniform4f(V.uniforms["leftTopWidthHeight"],t[0],t[1],t[2],t[3]),e.drawArrays(e.TRIANGLE_STRIP,5,4),z[F].leftTopWidthHeight=t,z[F].axCorSag=n,F+=1,!(d<=0)){L.use(e),e.uniform4fv(L.uniforms["lineColor"],R),e.uniform2fv(L.uniforms["canvasWidthHeight"],[e.canvas.width,e.canvas.height]);var o=t[0]+t[2]*a[0];e.uniform4f(L.uniforms["leftTopWidthHeight"],o-.5*d,t[1],d,t[3]),e.drawArrays(e.TRIANGLE_STRIP,5,4);var r=t[1]+t[3]*(1-a[1]);e.uniform4f(L.uniforms["leftTopWidthHeight"],t[0],r-.5*d,t[2],d),e.drawArrays(e.TRIANGLE_STRIP,5,4),e.enable(e.CULL_FACE),i?ye(e,[t[0]+t[2]+1,t[1]+.5*t[3]],"R"):n<m&&ye(e,[t[0]+1,t[1]+.5*t[3]],"L"),n===p&&Te(e,[t[0]+.5*t[2],t[1]+1],"A"),n>p&&Te(e,[t[0]+.5*t[2],t[1]+1],"S")}}function Ee(e,t){var n=ve(e,t),a=n.volScale,i=n.vox;U.use(e),e.canvas.width<e.canvas.height?e.viewport(0,.5*(e.canvas.height-e.canvas.width),e.canvas.width,e.canvas.width):e.viewport(.5*(e.canvas.width-e.canvas.height),0,e.canvas.height,e.canvas.height),e.clearColor(.2,0,0,1);var o=l["b"].create(),r=-.54;l["b"].translate(o,o,[0,0,r]);var s=(90-b-a[0])*Math.PI/180;l["b"].rotate(o,o,s,[-1,0,0]),s=T*Math.PI/180,l["b"].rotate(o,o,s,[0,0,1]),l["b"].scale(o,o,a);var u=l["b"].create();l["b"].invert(u,o);var f=l["d"].fromValues(0,0,-1,1);l["d"].transformMat4(f,f,u);var d=l["c"].fromValues(f[0],f[1],f[2]);l["c"].normalize(d,d);var v=1e-5;Math.abs(d[0])<v&&(d[0]=v),Math.abs(d[1])<v&&(d[1]=v),Math.abs(d[2])<v&&(d[2]=v),e.uniformMatrix4fv(U.uniforms["mvpMtx"],!1,o),e.uniform1f(U.uniforms["overlays"],w),e.uniform4fv(U.uniforms["clipPlane"],_),e.uniform3fv(U.uniforms["rayDir"],d),e.uniform3fv(U.uniforms["texVox"],i),e.drawArrays(e.TRIANGLE_STRIP,0,14);var p="azimuth: "+T.toFixed(0)+" elevation: "+b.toFixed(0);return c["a"].$emit("crosshair-pos-change",p),p}function we(e){var t=l["d"].fromValues(E[0],E[1],E[2],1),n=e.volume.hdr.dims,a=l["d"].fromValues(n[1],n[2],n[3],1),i=e.volume.hdr.affine,o=l["b"].fromValues(i[0][0],i[1][0],i[2][0],i[3][0],i[0][1],i[1][1],i[2][1],i[3][1],i[0][2],i[1][2],i[2][2],i[3][2],i[0][3],i[1][3],i[2][3],i[3][3]);l["d"].mul(t,t,a);var r=l["d"].fromValues(-.5,-.5,-.5,0);return l["d"].add(t,t,r),l["d"].transformMat4(t,t,o),t}function _e(e,t,n){var a=e.canvas.clientWidth/t;n*a>e.canvas.clientHeight&&(a=e.canvas.clientHeight/n);var i=t*a,o=n*a,r=[.5*(e.canvas.clientWidth-i),.5*(e.canvas.clientHeight-o),i,o];return r}function Pe(e,t){if(e.clearColor(v[0],v[1],v[2],v[3]),e.clear(e.COLOR_BUFFER_BIT),y===x)return Ee(e,t);var n=ve(e,t),a=n.volScale;if(e.viewport(0,0,e.canvas.width,e.canvas.height),F=0,y===p){var i=_e(e,a[0],a[1]);be(e,i,0)}else if(y===h){var o=_e(e,a[0],a[2]);be(e,o,1)}else if(y===m){var r=_e(e,a[1],a[2]);be(e,r,2)}else{var l=_e(e,a[0]+a[1],a[1]+a[2]),s=l[2]*a[0]/(a[0]+a[1]),u=l[2]-s,d=l[3]*a[1]/(a[1]+a[2]),g=l[3]-d;be(e,[l[0],l[1]+g,s,d],0),be(e,[l[0],l[1],s,g],1),be(e,[l[0]+s,l[1],u,g],2);var T=D*d;he(e,[l[0]+s+T,l[1]+g+T,u-T-T,d*f])}e.finish();var b=we(t),E=b[0].toFixed(2)+"×"+b[1].toFixed(2)+"×"+b[2].toFixed(2);return c["a"].$emit("crosshair-pos-change",E),E}}).call(this,n("b639").Buffer)},b42f:function(e,t,n){},d72e:function(e,t,n){"use strict";n("2c88")},f5ef:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n("2b0e"),i=new a["a"]}});
//# sourceMappingURL=app.36d95f42.js.map