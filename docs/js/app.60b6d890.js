(function(e){function t(t){for(var a,r,l=t[0],s=t[1],c=t[2],u=0,f=[];u<l.length;u++)r=l[u],Object.prototype.hasOwnProperty.call(o,r)&&o[r]&&f.push(o[r][0]),o[r]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a]);v&&v(t);while(f.length)f.shift()();return i.push.apply(i,c||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,l=1;l<n.length;l++){var s=n[l];0!==o[s]&&(a=!1)}a&&(i.splice(t--,1),e=r(r.s=n[0]))}return e}var a={},o={app:0},i=[];function r(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=a,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var l=window["webpackJsonp"]=window["webpackJsonp"]||[],s=l.push.bind(l);l.push=t,l=l.slice();for(var c=0;c<l.length;c++)t(l[c]);var v=s;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var a=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("v-app-bar",{attrs:{app:""}},[n("v-tabs",{model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[n("v-tabs-slider",{attrs:{color:"black"}}),e._l(e.appTabs,(function(t){return n("v-tab",{key:t},[e._v(" "+e._s(t)+" ")])}))],2),n("v-spacer"),n("v-btn",{on:{click:function(t){return e.setSliceType(0)}}},[e._v("A")]),n("v-btn",{on:{click:function(t){return e.setSliceType(2)}}},[e._v("S")]),n("v-btn",{on:{click:function(t){return e.setSliceType(1)}}},[e._v("C")]),n("v-btn",{on:{click:function(t){return e.setSliceType(4)}}},[e._v("R")]),n("v-btn",{on:{click:function(t){return e.setSliceType(3)}}},[e._v("MP")])],1),n("v-main",[n("v-row",{staticStyle:{height:"100%"}},[n("v-col",{attrs:{sm:"12",md:"12",lg:"4"}},[n("controls",{attrs:{overlays:e.overlayList}})],1),n("v-col",{attrs:{sm:"12",md:"12",lg:"8"}},[n("glviewer",{attrs:{overlays:e.overlayList}})],1)],1)],1),n("v-footer",{attrs:{app:""}},[n("v-row",[n("v-col",{attrs:{align:"center",justify:"center"}},[n("span",{staticClass:"text-caption"},[e._v(e._s(e.coordinateString))])])],1)],1)],1)},i=[],r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"mt-5",attrs:{id:"controls"}},[n("v-row",{staticClass:"my-2 mx-2 align-center"},[n("h3",[e._v("Layers")]),n("v-spacer"),n("v-btn",{staticClass:"mx-2",attrs:{small:""},on:{click:e.onAddOverlay}},[e._v("Add overlay")])],1),n("v-row",{attrs:{"no-gutters":""}},[n("v-expansion-panels",[n("draggable",{staticClass:"row mx-2 my-2",attrs:{handle:".drag-handle"},model:{value:e.overlays,callback:function(t){e.overlays=t},expression:"overlays"}},e._l(e.overlays,(function(t,a){return n("v-expansion-panel",{key:a},[n("v-expansion-panel-header",[n("v-row",{staticClass:"align-center",attrs:{"no-gutters":""}},[n("v-icon",{staticClass:"mx-2 drag-handle"},[e._v(" mdi-drag-horizontal-variant ")]),n("v-icon",{staticClass:"mx-2",on:{click:function(t){return t.stopPropagation(),e.toggleEye(t)}}},[e._v(" "+e._s(e.eyeIcon)+" ")]),e._v(e._s(t.name)+" ")],1)],1),n("v-expansion-panel-content",[n("v-row",[n("v-select",{attrs:{items:e.colorMaps,label:"Color map"},on:{change:e.onColorChange},model:{value:e.selectedColorMap,callback:function(t){e.selectedColorMap=t},expression:"selectedColorMap"}})],1),n("v-row",[n("v-col",{staticClass:"px-4"},[n("p",[e._v("Intensity range")]),n("v-range-slider",{staticClass:"align-center",attrs:{max:t.intensityMax,min:t.intensityMin,"hide-details":""},scopedSlots:e._u([{key:"prepend",fn:function(){return[n("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{value:t.intensityRange[0],"hide-details":"","single-line":"",type:"number"},on:{input:function(n){return e.$set(t.intensityRange,0,n)}}})]},proxy:!0},{key:"append",fn:function(){return[n("v-text-field",{staticClass:"mt-0 pt-0",staticStyle:{width:"60px"},attrs:{value:t.intensityRange[1],"hide-details":"","single-line":"",type:"number"},on:{input:function(n){return e.$set(t.intensityRange,1,n)}}})]},proxy:!0}],null,!0),model:{value:t.intensityRange,callback:function(n){e.$set(t,"intensityRange",n)},expression:"overlay.intensityRange"}})],1)],1),n("v-row",[n("v-col",[n("p",[e._v("Opacity")]),n("v-slider",{attrs:{step:"0.01",max:"1",min:"0","thumb-label":"",ticks:""},on:{input:e.onOpacityChange},model:{value:e.opacity,callback:function(t){e.opacity=t},expression:"opacity"}})],1)],1)],1)],1)})),1)],1)],1)],1)},l=[],s=n("b76a"),c=n.n(s),v=new a["a"],u={props:{overlays:Array},name:"controls",components:{draggable:c.a},data:function(){return{colorSelected:"gray",colorMaps:["gray","Winter","Warm","Plasma","Viridis","Inferno"],selectedColorMap:"gray",eyeIcon:"mdi-eye",overlays_:this.overlays,draggable:!0,opacity:1}},methods:{toggleEye:function(){this.eyeIcon="mdi-eye"==this.eyeIcon?"mdi-eye-off":"mdi-eye"},onColorChange:function(){v.$emit("colormap-change",this.selectedColorMap)},onOpacityChange:function(){v.$emit("opacity-change",this.opacity)},onAddOverlay:function(){alert("adding overlays in this demo is not implemented yet! :)")}}},f=u,d=(n("f5fd"),n("2877")),m=n("6544"),h=n.n(m),p=n("8336"),g=n("62ad"),y=n("cd55"),x=n("49e2"),_=n("c865"),b=n("0393"),E=n("132d"),T=n("5963"),C=n("0fd9"),w=n("b974"),S=n("ba0d"),R=n("2fa4"),P=n("8654"),A=Object(d["a"])(f,r,l,!1,null,"0cd7d8e6",null),W=A.exports;h()(A,{VBtn:p["a"],VCol:g["a"],VExpansionPanel:y["a"],VExpansionPanelContent:x["a"],VExpansionPanelHeader:_["a"],VExpansionPanels:b["a"],VIcon:E["a"],VRangeSlider:T["a"],VRow:C["a"],VSelect:w["a"],VSlider:S["a"],VSpacer:R["a"],VTextField:P["a"]});var D=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"viewer",attrs:{id:"viewer"}},[n("v-dialog",{attrs:{"max-width":"400"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[n("v-color-picker",{attrs:{width:"400",mode:"rgba"},on:{input:e.onCrosshairColorChange},model:{value:e.crosshairColor,callback:function(t){e.crosshairColor=t},expression:"crosshairColor"}})],1)],1)},H=[],L=(n("d81d"),n("fb6a"),n("b680"),n("d3b7"),n("cfc3"),n("8b09"),n("5cc6"),n("8a59"),n("84c3"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("0037")),B=(n("4160"),n("ac1f"),n("466d"),n("159b"),function(e,t,n){var a=this;this.program=I(e,t,n);var o=/uniform[^;]+[ ](\w+);/g,i=/uniform[^;]+[ ](\w+);/;this.uniforms={};var r=t.match(o),l=n.match(o);for(var s in r&&r.forEach((function(e){var t=e.match(i);a.uniforms[t[1]]=-1})),l&&l.forEach((function(e){var t=e.match(i);a.uniforms[t[1]]=-1})),this.uniforms)this.uniforms[s]=e.getUniformLocation(this.program,s)});B.prototype.use=function(e){e.useProgram(this.program)};var I=function(e,t,n){var a=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(a,t),e.compileShader(a),!e.getShaderParameter(a,e.COMPILE_STATUS))return alert("Vertex shader failed to compile, see console for log"),console.log(e.getShaderInfoLog(a)),null;var o=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(o,n),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))return alert("Fragment shader failed to compile, see console for log"),console.log(e.getShaderInfoLog(o)),null;var i=e.createProgram();return e.attachShader(i,a),e.attachShader(i,o),e.linkProgram(i),e.getProgramParameter(i,e.LINK_STATUS)?i:(alert("Shader failed to link, see console for log"),console.log(e.getProgramInfoLog(i)),null)},M=n("20e7"),V="#version 300 es\n#line 4\nlayout(location=0) in vec3 pos;\nuniform mat4 mvpMtx;\nout vec3 vColor;\nvoid main(void) {\n\tgl_Position = mvpMtx * vec4(2.0 * (pos.xyz - 0.5), 1.0);\n\tvColor = pos;\n}",U="#version 300 es\n#line 15\nprecision highp int;\nprecision highp float;\nuniform vec3 rayDir;\nuniform vec3 texVox;\nuniform highp sampler3D volume;\nuniform highp sampler2D colormap;\nin vec3 vColor;\nout vec4 fColor;\nvec3 GetBackPosition (vec3 startPosition) {\n vec3 invR = 1.0 / rayDir;\n vec3 tbot = invR * (vec3(0.0)-startPosition);\n vec3 ttop = invR * (vec3(1.0)-startPosition);\n vec3 tmax = max(ttop, tbot);\n vec2 t = min(tmax.xx, tmax.yz);\n return startPosition + (rayDir * min(t.x, t.y));\n}\nvoid main() {\n    fColor = vec4(0.0,0.0,0.0,0.0);\n\tvec3 start = vColor;\n\t//fColor = vec4(start, 1.0); return;\n\tvec3 backPosition = GetBackPosition(start);\n\t//fColor = vec4(backPosition, 1.0); return;\n    vec3 dir = backPosition - start;\n    float len = length(dir);\n\tfloat lenVox = length((texVox * start) - (texVox * backPosition));\n\tfloat sliceSize = len / lenVox; //e.g. if ray length is 1.0 and traverses 50 voxels, each voxel is 0.02 in unit cube\n\tfloat stepSize = sliceSize; //quality: larger step is faster traversal, but fewer samples\n\tfloat opacityCorrection = stepSize/sliceSize;\n    dir = normalize(dir);\n\tvec4 deltaDir = vec4(dir.xyz * stepSize, stepSize);\n\tvec4 samplePos = vec4(start.xyz, 0.0); //ray position\n\t//start: OPTIONAL fast pass: rapid traversal until first hit\n\tfloat stepSizeFast = sliceSize * 1.9;\n\tvec4 deltaDirFast = vec4(dir.xyz * stepSizeFast, stepSizeFast);\n\twhile (samplePos.a <= len) {\n\t\tfloat val = texture(volume, samplePos.xyz).r;\n\t\tif (val > 0.01) break;\n\t\tsamplePos += deltaDirFast; //advance ray position\n\t}\n\tif (samplePos.a > len) return;\n\tsamplePos -= deltaDirFast;\n\tif (samplePos.a < 0.0)\n\t\tvec4 samplePos = vec4(start.xyz, 0.0); //ray position\n\t//end: fast pass\n\tvec4 colAcc = vec4(0.0,0.0,0.0,0.0);\n\tconst float earlyTermination = 0.95;\n    float ran = fract(sin(gl_FragCoord.x * 12.9898 + gl_FragCoord.y * 78.233) * 43758.5453);\n    samplePos += deltaDir * ran; //jitter ray\n\twhile (samplePos.a <= len) {\n\t\tfloat val = texture(volume, samplePos.xyz).r;\n\t\tsamplePos += deltaDir; //advance ray position\n\t\tif (val < 0.01) continue;\n\t\tvec4 colorSample = texture(colormap, vec2(val, 0.5)).rgba;\n\t\tcolorSample.a = 1.0-pow((1.0 - colorSample.a), opacityCorrection);\n\t\tcolorSample.rgb *= colorSample.a;\n\t\tcolAcc= (1.0 - colAcc.a) * colorSample + colAcc;\n\t\tif ( colAcc.a > earlyTermination )\n\t\t\tbreak;\n\t}\n\tcolAcc.a = colAcc.a / earlyTermination;\n\tfColor = colAcc;\n}",k="#version 300 es\n#line 81\nlayout(location=0) in vec3 pos;\nuniform int axCorSag;\nuniform float slice;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftBottomWidthHeight;\nout vec3 texPos;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftBottomWidthHeight.x + (pos.x * leftBottomWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftBottomWidthHeight.y - leftBottomWidthHeight.w +((1.0 - pos.y) * leftBottomWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n\tif (axCorSag == 1)\n\t\ttexPos = vec3(pos.x, slice, pos.y);\n\telse if (axCorSag == 2)\n\t\ttexPos = vec3(slice, pos.x, pos.y);\n\telse\n\t\ttexPos = vec3(pos.xy, slice);\n}",F="#version 300 es\n#line 105\nprecision highp int;\nprecision highp float;\nuniform highp sampler3D volume;\nuniform highp sampler2D colormap;\nuniform float opacity;\nin vec3 texPos;\nout vec4 color;\nvoid main() {\n\tcolor = vec4(texture(colormap, vec2(texture(volume, texPos).r, 0.5)).rgb, opacity);\n}",z="#version 300 es\n#line 119\nprecision highp int;\nprecision highp float;\nuniform vec4 lineColor;\nout vec4 color;\nvoid main() {\n\tcolor = lineColor;\n}",O="#version 300 es\n#line 130\nlayout(location=0) in vec3 pos;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftBottomWidthHeight;\nout float vColor;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftBottomWidthHeight.x + (pos.x * leftBottomWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftBottomWidthHeight.y - leftBottomWidthHeight.w +((1.0 - pos.y) * leftBottomWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n\tvColor = pos.x;\n}",X="#version 300 es\n#line 147\nprecision highp int;\nprecision highp float;\nuniform highp sampler2D colormap;\nin float vColor;\nout vec4 color;\nvoid main() {\n\tcolor = vec4(texture(colormap, vec2(vColor, 0.5)).rgb, 1.0);\n}",N="#version 300 es\n#line 159\nlayout(location=0) in vec3 pos;\nuniform vec2 canvasWidthHeight;\nuniform vec4 leftBottomWidthHeight;\nvoid main(void) {\n\t//convert pixel x,y space 1..canvasWidth,1..canvasHeight to WebGL 1..-1,-1..1\n\tvec2 frac;\n\tfrac.x = (leftBottomWidthHeight.x + (pos.x * leftBottomWidthHeight.z)) / canvasWidthHeight.x; //0..1\n\tfrac.y = 1.0 - ((leftBottomWidthHeight.y - leftBottomWidthHeight.w +((1.0 - pos.y) * leftBottomWidthHeight.w)) / canvasWidthHeight.y); //1..0\n\tfrac = (frac * 2.0) - 1.0;\n\tgl_Position = vec4(frac, 0.0, 1.0);\n}",G=.05,$=1,j=[0,0,0,1],Y=0,q=1,J=2,K=3,Q=4,Z=K,ee=120,te=15,ne=[1,0,0,1],ae=[.5,.5,.5],oe=1,ie=null,re=.05,le=null,se=null,ce=null,ve=null,ue=null,fe=null,de=[0,0],me=0,he=[{leftBottomWidthHeight:[1,0,0,1],axCorSag:Y},{leftBottomWidthHeight:[1,0,0,1],axCorSag:Y},{leftBottomWidthHeight:[1,0,0,1],axCorSag:Y},{leftBottomWidthHeight:[1,0,0,1],axCorSag:Y}],pe=1;function ge(e,t){Z==Q&&(de=[e,t])}function ye(e,t){Z==Q&&(ee+=e-de[0],te+=t-de[1],de=[e,t],Ue(Te(),ie))}function xe(e){ne=e,Ue(Te(),ie)}function _e(e){Z=e,Ue(Te(),ie)}function be(e){pe=e,Ue(Te(),ie)}function Ee(e){oe=e,Ue(Te(),ie)}function Te(){var e=document.querySelector("#gl").getContext("webgl2");return e||null}function Ce(e,t){var n,a=t.volume,o=a.hdr.cal_min,i=a.hdr.cal_max,r=e.length,l=new Uint8ClampedArray(r),s=1;for(i>o&&(s=255/(i-o)),n=0;n<r-1;n++){var c=e[n];c=c*a.hdr.scl_slope+a.hdr.scl_inter,l[n]=(c-o)*s}return l}function we(e,t){var n,a=t.volume,o=e.length,i=1/0,r=-1/0;for(n=0;n<o-1;n++)isFinite(e[n])&&(e[n]<i&&(i=e[n]),e[n]>r&&(r=e[n]));isFinite(a.hdr.scl_slope)&&isFinite(a.hdr.scl_inter)&&0!==a.hdr.scl_slope?(i=i*a.hdr.scl_slope+a.hdr.scl_inter,r=r*a.hdr.scl_slope+a.hdr.scl_inter):(a.hdr.scl_slope=1,a.hdr.scl_inter=0),a.hdr.global_min=i,a.hdr.global_max=r,(!isFinite(a.hdr.cal_min)||!isFinite(a.hdr.cal_max)||a.hdr.cal_min>=a.hdr.cal_max)&&(a.hdr.cal_min=i,a.hdr.cal_max=r)}function Se(e){var t=null,n=null,a=e.volumeURL,o=new XMLHttpRequest;o.open("GET",a,!0),o.responseType="arraybuffer",o.onerror=function(){console.log="Error Loading Volume"},o.onload=function(){var a=o.response;a?(t=L["readHeader"](a),n=L["isCompressed"](a)?L["readImage"](t,L["decompress"](a)):L["readImage"](t,a)):(alert("Unable to load buffer properly from volume?"),console.log("no buffer?")),e.volume.hdr=t,e.volume.img=n,ie=e,Ae(Te(),e.colorMap),Pe(Te(),e)},o.send()}function Re(e){ce=new B(e,k,F),ce.use(e),e.uniform1i(ce.uniforms["volume"],0),e.uniform1i(ce.uniforms["colormap"],1),ve=new B(e,N,z),ue=new B(e,V,U),ue.use(e),e.uniform1i(ue.uniforms["volume"],0),e.uniform1i(ue.uniforms["colormap"],1),fe=new B(e,O,X),fe.use(e),e.uniform1i(fe.uniforms["colormap"],1)}function Pe(e,t){var n=[0,1,0,1,1,0,0,1,1,1,1,1,1,0,1,1,1,0,1,0,0,0,1,0,0,0,0,0,1,1,0,0,1,1,0,1,0,0,0,1,0,0],a=e.createVertexArray();e.bindVertexArray(a);var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,new Float32Array(n),e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,3,e.FLOAT,!1,0,0);var i=t.volume.hdr,r=t.volume.img,l=null;2===i.datatypeCode?l=new Uint8Array(r):4===i.datatypeCode?l=new Int16Array(r):16===i.datatypeCode?l=new Float32Array(r):512===i.datatypeCode&&(l=new Uint16Array(r)),we(l,t);var s=Ce(l,t);se&&e.deleteTexture(se),se=e.createTexture(),e.activeTexture(e.TEXTURE0),e.bindTexture(e.TEXTURE_3D,se),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_3D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texStorage3D(e.TEXTURE_3D,1,e.R8,i.dims[1],i.dims[2],i.dims[3]),e.texSubImage3D(e.TEXTURE_3D,0,0,0,0,i.dims[1],i.dims[2],i.dims[3],e.RED,e.UNSIGNED_BYTE,s),Ue(e,t)}function Ae(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=We([0,255],[0,255],[0,255],[0,128],[0,255]);"Winter"===t&&(n=We([0,0,0],[0,128,255],[255,196,128],[0,64,128],[0,128,255])),"Warm"===t&&(n=We([255,255,255],[127,196,254],[0,0,0],[0,64,128],[0,128,255])),"Plasma"===t&&(n=We([13,156,237,240],[8,23,121,249],[135,158,83,33],[0,56,80,88],[0,64,192,255])),"Viridis"===t&&(n=We([68,49,53,253],[1,104,183,231],[84,142,121,37],[0,56,80,88],[0,65,192,255])),"Inferno"===t&&(n=We([0,120,237,240],[0,28,105,249],[4,109,37,33],[0,56,80,88],[0,64,192,255])),null!==le&&e.deleteTexture(le),le=e.createTexture(),e.activeTexture(e.TEXTURE1),e.bindTexture(e.TEXTURE_2D,le),e.texStorage2D(e.TEXTURE_2D,1,e.RGBA8,256,1),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_R,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,256,1,e.RGBA,e.UNSIGNED_BYTE,n),console.log("set colormap",t)}function We(e,t,n,a,o){for(var i=new Uint8ClampedArray(1024),r=0;r<o.length-1;r++)for(var l=o[r],s=o[r+1],c=s-l,v=4*l,u=l;u<=s;u++){var f=(u-l)/c;i[v]=e[r]+f*(e[r+1]-e[r]),v++,i[v]=t[r]+f*(t[r+1]-t[r]),v++,i[v]=n[r]+f*(n[r+1]-n[r]),v++,i[v]=a[r]+f*(a[r+1]-a[r]),v++}return i}function De(e,t){var n=t.volume.hdr,a=[1,n.dims[1]*n.pixDims[1],n.dims[2]*n.pixDims[2],n.dims[3]*n.pixDims[3]],o=Math.max(a[1],Math.max(a[2],a[3])),i=[a[1]/o,a[2]/o,a[3]/o];i=i.map((function(e){return e*oe}));var r=[n.dims[1],n.dims[2],n.dims[3]];return{volScale:i,vox:r}}function He(e,t,n,a){if(Z!==Q&&!(me<1||e.canvas.height<1||e.canvas.width<1))for(var o=0;o<me;o++){var i=he[o].axCorSag;if(!(i>J)){var r=he[o].leftBottomWidthHeight,l=(n-r[0])/r[2],s=(r[1]-a)/r[3];if(l>=0&&l<1&&s>=0&&s<1)return i===Y&&(ae[0]=l,ae[1]=s),i===q&&(ae[0]=l,ae[2]=s),i===J&&(ae[1]=l,ae[2]=s),void Ue(e,t)}}}function Le(e,t){if(!(t[2]<=0||t[3]<=0)){if($>0){ve.use(e),e.uniform4fv(ve.uniforms["lineColor"],ne),e.uniform2fv(ve.uniforms["canvasWidthHeight"],[e.canvas.width,e.canvas.height]);var n=[t[0]-1,t[1]+1,t[2]+2,t[3]+2];e.uniform4f(ve.uniforms["leftBottomWidthHeight"],n[0],n[1],n[2],n[3]),e.drawArrays(e.TRIANGLE_STRIP,5,4)}fe.use(e),e.uniform2fv(fe.uniforms["canvasWidthHeight"],[e.canvas.width,e.canvas.height]),e.uniform4f(fe.uniforms["leftBottomWidthHeight"],t[0],t[1],t[2],t[3]),e.drawArrays(e.TRIANGLE_STRIP,5,4)}}function Be(e,t,n){var a=[ae[0],ae[1],ae[2]];if(1===n&&(a=[ae[0],ae[2],ae[1]]),2===n&&(a=[ae[1],ae[2],ae[0]]),ce.use(e),e.uniform1f(ce.uniforms["opacity"],pe),e.uniform1i(ce.uniforms["axCorSag"],n),e.uniform1f(ce.uniforms["slice"],a[2]),e.uniform2fv(ce.uniforms["canvasWidthHeight"],[e.canvas.width,e.canvas.height]),e.uniform4f(ce.uniforms["leftBottomWidthHeight"],t[0],t[1],t[2],t[3]),e.drawArrays(e.TRIANGLE_STRIP,5,4),he[me].leftBottomWidthHeight=t,he[me].axCorSag=n,me+=1,!($<=0)){ve.use(e),e.uniform4fv(ve.uniforms["lineColor"],ne),e.uniform2fv(ve.uniforms["canvasWidthHeight"],[e.canvas.width,e.canvas.height]);var o=t[0]+t[2]*a[0];e.uniform4f(ve.uniforms["leftBottomWidthHeight"],o-$,t[1],$,t[3]),e.drawArrays(e.TRIANGLE_STRIP,5,4);var i=t[1]-t[3]*a[1];e.uniform4f(ve.uniforms["leftBottomWidthHeight"],t[0],i-$,t[2],$),e.drawArrays(e.TRIANGLE_STRIP,5,4)}}function Ie(e,t){var n=De(e,t),a=n.volScale,o=n.vox;ue.use(e),e.canvas.width<e.canvas.height?e.viewport(0,.5*(e.canvas.height-e.canvas.width),e.canvas.width,e.canvas.width):e.viewport(.5*(e.canvas.width-e.canvas.height),0,e.canvas.height,e.canvas.height),e.clearColor(.2,0,0,1);var i=M["a"].create(),r=-.54;M["a"].translate(i,i,[0,0,r]);var l=(90-te-a[0])*Math.PI/180;M["a"].rotate(i,i,l,[-1,0,0]),l=ee*Math.PI/180,M["a"].rotate(i,i,l,[0,0,1]),M["a"].scale(i,i,a);var s=M["a"].create();M["a"].invert(s,i);var c=M["c"].fromValues(0,0,-1,1);M["c"].transformMat4(c,c,s);var u=M["b"].fromValues(c[0],c[1],c[2]);M["b"].normalize(u,u);var f=1e-5;Math.abs(u[0])<f&&(u[0]=f),Math.abs(u[1])<f&&(u[1]=f),Math.abs(u[2])<f&&(u[2]=f),e.uniformMatrix4fv(ue.uniforms["mvpMtx"],!1,i),e.uniform3fv(ue.uniforms["rayDir"],u),e.uniform3fv(ue.uniforms["texVox"],o),e.drawArrays(e.TRIANGLE_STRIP,0,14);var d="azimuth: "+ee.toFixed(0)+" elevation: "+te.toFixed(0);return v.$emit("crosshair-pos-change",d),d}function Me(e){var t=M["c"].fromValues(ae[0],ae[1],ae[2],1),n=e.volume.hdr.dims,a=M["c"].fromValues(n[1],n[2],n[3],1),o=e.volume.hdr.affine,i=M["a"].fromValues(o[0][0],o[1][0],o[2][0],o[3][0],o[0][1],o[1][1],o[2][1],o[3][1],o[0][2],o[1][2],o[2][2],o[3][2],o[0][3],o[1][3],o[2][3],o[3][3]);M["c"].mul(t,t,a);var r=M["c"].fromValues(-.5,-.5,-.5,0);return M["c"].add(t,t,r),M["c"].transformMat4(t,t,i),t}function Ve(e,t,n){var a=e.canvas.clientWidth/t;n*a>e.canvas.clientHeight&&(a=e.canvas.clientHeight/n);var o=t*a,i=n*a,r=[.5*(e.canvas.clientWidth-o),e.canvas.clientHeight-.5*(e.canvas.clientHeight-i),o,i];return r}function Ue(e,t){if(e.clearColor(j[0],j[1],j[2],j[3]),e.clear(e.COLOR_BUFFER_BIT),Z===Q)return Ie(e,t);var n=De(e,t),a=n.volScale;if(e.viewport(0,0,e.canvas.width,e.canvas.height),me=0,Z===Y){var o=Ve(e,a[0],a[1]);Be(e,o,0)}else if(Z===q){var i=Ve(e,a[0],a[2]);Be(e,i,1)}else if(Z===J){var r=Ve(e,a[1],a[2]);Be(e,r,2)}else{var l=Ve(e,a[0]+a[1],a[1]+a[2]),s=l[2]*a[0]/(a[0]+a[1]),c=l[2]-s,u=l[3]*a[1]/(a[1]+a[2]),f=l[3]-u;Be(e,[l[0],l[1],s,u],0),Be(e,[l[0],l[1]-u,s,f],1),Be(e,[l[0]+s,l[1]-u,c,f],2);var d=re*u;Le(e,[l[0]+s+d,l[1]-d,c-d-d,u*G])}e.finish();var m=Me(t),h=m[0].toFixed(2)+"×"+m[1].toFixed(2)+"×"+m[2].toFixed(2);return v.$emit("crosshair-pos-change",h),h}v.$on("colormap-change",(function(e){Ae(Te(),e),Ue(Te(),ie)}));var ke={name:"glviewer",props:{overlays:Array,shader:String},created:function(){v.$on("slice-type-change",(function(e){_e(e)}))},data:function(){return{selectedOverlay:0,mouseDown:!1,zDown:!1,scale:1,dialog:!1,crosshairColor:{r:255,g:0,b:0,a:1}}},watch:{overlays:{deep:!0,handler:function(){}}},methods:{onWindowResize:function(){var e=100,t=document.querySelector("#gl"),n=document.querySelector("#viewer");t.width=n.clientWidth,t.height=n.clientHeight,n.getBoundingClientRect().bottom>document.documentElement.clientHeight&&(n.style.height=document.documentElement.clientHeight-e,t.height=document.documentElement.clientHeight-e),Ue(this.gl,this.overlays[this.selectedOverlay])},onCrosshairColorChange:function(){var e=[this.crosshairColor.r/255,this.crosshairColor.g/255,this.crosshairColor.b/255,this.crosshairColor.a];xe(e)}},mounted:function(){var e=this,t=document.createElement("canvas");t.classList.add("fillParent");var n=document.querySelector("#viewer");t.id="gl",t.width=n.clientWidth,t.height=n.clientHeight,n.appendChild(t);var a=document.querySelector("#gl"),o=a.getContext("webgl2");o.canvas.addEventListener("mousedown",(function(t){t.preventDefault(),e.dialog=!1,e.mouseDown=!0;var n=a.getBoundingClientRect();He(e.gl,e.overlays[0],t.clientX-n.left,t.clientY-n.top),ge(t.clientX-n.left,t.clientY-n.top)})),o.canvas.addEventListener("mousemove",(function(t){if(e.mouseDown){var n=a.getBoundingClientRect();He(e.gl,e.overlays[0],t.clientX-n.left,t.clientY-n.top),ye(t.clientX-n.left,t.clientY-n.top)}})),o.canvas.addEventListener("wheel",(function(t){e.zDown&&(t.preventDefault(),e.scale+=-.01*t.deltaY,Ee(e.scale))})),o.canvas.addEventListener("mouseup",(function(){e.mouseDown=!1})),o.canvas.addEventListener("contextmenu",(function(t){t.preventDefault(),e.dialog=!0})),window.addEventListener("keypress",(function(t){"z"===t.key&&(e.zDown=!0)})),window.addEventListener("keyup",(function(t){"z"===t.key&&(e.zDown=!1)})),window.addEventListener("resize",this.onWindowResize),this.gl=o,this.gl.enable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.FRONT),this.gl.enable(this.gl.BLEND),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),Re(this.gl),Se(this.overlays[this.selectedOverlay]),v.$on("opacity-change",(function(e){be(e)}))}},Fe=ke,ze=(n("7091"),n("03a4")),Oe=n("169a"),Xe=Object(d["a"])(Fe,D,H,!1,null,"6e3c2b0a",null),Ne=Xe.exports;h()(Xe,{VColorPicker:ze["a"],VDialog:Oe["a"]});var Ge={name:"App",components:{controls:W,glviewer:Ne},created:function(){var e=this;v.$on("crosshair-pos-change",(function(t){e.coordinateString=t}))},data:function(){return{tab:null,appTabs:["Menu","Draw","Edit","Scripting"],coordinateString:"0x0x0",overlayList:[{volumeURL:"./mni152.nii.gz",volume:{hdr:null,img:null},name:"mni152.nii.gz",intensityMin:0,intensityMax:100,intensityRange:[0,100],colorMap:"gray",opacity:100}]}},methods:{setSliceType:function(e){v.$emit("slice-type-change",e)}}},$e=Ge,je=n("7496"),Ye=n("40dc"),qe=n("553a"),Je=n("f6c4"),Ke=n("71a3"),Qe=n("fe57"),Ze=n("9a96"),et=Object(d["a"])($e,o,i,!1,null,null,null),tt=et.exports;h()(et,{VApp:je["a"],VAppBar:Ye["a"],VBtn:p["a"],VCol:g["a"],VFooter:qe["a"],VMain:Je["a"],VRow:C["a"],VSpacer:R["a"],VTab:Ke["a"],VTabs:Qe["a"],VTabsSlider:Ze["a"]});var nt=n("f309");n("bf40");a["a"].use(nt["a"]);var at=new nt["a"]({});a["a"].config.productionTip=!1,new a["a"]({vuetify:at,render:function(e){return e(tt)}}).$mount("#app")},7091:function(e,t,n){"use strict";n("eb5d")},dc92:function(e,t,n){},eb5d:function(e,t,n){},f5fd:function(e,t,n){"use strict";n("dc92")}});
//# sourceMappingURL=app.60b6d890.js.map